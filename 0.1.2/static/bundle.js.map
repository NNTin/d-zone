{
  "version": 3,
  "sources": ["../../node_modules/quick-format-unescaped/index.js", "../../node_modules/pino/browser.js", "../../src/gameLogger.ts", "../../node_modules/events/events.js", "../../src/script/common/util.ts", "../../src/script/common/geometry.ts", "../../src/script/engine/entity.ts", "../../src/script/common/bettercanvas.ts", "../../src/script/common/textblotter.ts", "../../src/script/common/textbox.ts", "../../src/script/engine/worldobject.ts", "../../src/script/actors/pathfinder.ts", "../../src/script/actors/behaviors/goto.ts", "../../src/script/actors/behaviors/wander.ts", "../../src/script/actors/placeholder.ts", "../../src/script/actors/sheet.ts", "../../src/script/actors/actor.ts", "../../src/script/environment/slab.ts", "../../src/script/environment/sheet2.ts", "../../src/script/environment/tile.ts", "../../src/script/props/sheet.ts", "../../src/script/props/beacon.ts", "../../src/script/props/seed.ts", "../../src/main.ts", "../../src/script/actors/users.ts", "../../src/script/auth/discord-oauth.ts", "../../src/script/engine/canvas.ts", "../../src/script/engine/game.ts", "../../src/script/engine/input.ts", "../../src/script/engine/preloader.ts", "../../src/script/engine/renderer.ts", "../../src/script/common/colorutil.ts", "../../src/script/environment/world.ts", "../../src/script/props/decorator.ts", "../../src/script/ui/ui.ts", "../../src/script/ui/uielement.ts", "../../src/script/ui/button.ts", "../../src/script/ui/panel.ts", "../../src/script/ui/input.ts", "../../src/script/ui/label.ts", "../../package.json"],
  "sourcesContent": ["'use strict'\nfunction tryStringify (o) {\n  try { return JSON.stringify(o) } catch(e) { return '\"[Circular]\"' }\n}\n\nmodule.exports = format\n\nfunction format(f, args, opts) {\n  var ss = (opts && opts.stringify) || tryStringify\n  var offset = 1\n  if (typeof f === 'object' && f !== null) {\n    var len = args.length + offset\n    if (len === 1) return f\n    var objects = new Array(len)\n    objects[0] = ss(f)\n    for (var index = 1; index < len; index++) {\n      objects[index] = ss(args[index])\n    }\n    return objects.join(' ')\n  }\n  if (typeof f !== 'string') {\n    return f\n  }\n  var argLen = args.length\n  if (argLen === 0) return f\n  var str = ''\n  var a = 1 - offset\n  var lastPos = -1\n  var flen = (f && f.length) || 0\n  for (var i = 0; i < flen;) {\n    if (f.charCodeAt(i) === 37 && i + 1 < flen) {\n      lastPos = lastPos > -1 ? lastPos : 0\n      switch (f.charCodeAt(i + 1)) {\n        case 100: // 'd'\n        case 102: // 'f'\n          if (a >= argLen)\n            break\n          if (args[a] == null)  break\n          if (lastPos < i)\n            str += f.slice(lastPos, i)\n          str += Number(args[a])\n          lastPos = i + 2\n          i++\n          break\n        case 105: // 'i'\n          if (a >= argLen)\n            break\n          if (args[a] == null)  break\n          if (lastPos < i)\n            str += f.slice(lastPos, i)\n          str += Math.floor(Number(args[a]))\n          lastPos = i + 2\n          i++\n          break\n        case 79: // 'O'\n        case 111: // 'o'\n        case 106: // 'j'\n          if (a >= argLen)\n            break\n          if (args[a] === undefined) break\n          if (lastPos < i)\n            str += f.slice(lastPos, i)\n          var type = typeof args[a]\n          if (type === 'string') {\n            str += '\\'' + args[a] + '\\''\n            lastPos = i + 2\n            i++\n            break\n          }\n          if (type === 'function') {\n            str += args[a].name || '<anonymous>'\n            lastPos = i + 2\n            i++\n            break\n          }\n          str += ss(args[a])\n          lastPos = i + 2\n          i++\n          break\n        case 115: // 's'\n          if (a >= argLen)\n            break\n          if (lastPos < i)\n            str += f.slice(lastPos, i)\n          str += String(args[a])\n          lastPos = i + 2\n          i++\n          break\n        case 37: // '%'\n          if (lastPos < i)\n            str += f.slice(lastPos, i)\n          str += '%'\n          lastPos = i + 2\n          i++\n          a--\n          break\n      }\n      ++a\n    }\n    ++i\n  }\n  if (lastPos === -1)\n    return f\n  else if (lastPos < flen) {\n    str += f.slice(lastPos)\n  }\n\n  return str\n}\n", "'use strict'\n\nconst format = require('quick-format-unescaped')\n\nmodule.exports = pino\n\nconst _console = pfGlobalThisOrFallback().console || {}\nconst stdSerializers = {\n  mapHttpRequest: mock,\n  mapHttpResponse: mock,\n  wrapRequestSerializer: passthrough,\n  wrapResponseSerializer: passthrough,\n  wrapErrorSerializer: passthrough,\n  req: mock,\n  res: mock,\n  err: asErrValue,\n  errWithCause: asErrValue\n}\nfunction levelToValue (level, logger) {\n  return level === 'silent'\n    ? Infinity\n    : logger.levels.values[level]\n}\nconst baseLogFunctionSymbol = Symbol('pino.logFuncs')\nconst hierarchySymbol = Symbol('pino.hierarchy')\n\nconst logFallbackMap = {\n  error: 'log',\n  fatal: 'error',\n  warn: 'error',\n  info: 'log',\n  debug: 'log',\n  trace: 'log'\n}\n\nfunction appendChildLogger (parentLogger, childLogger) {\n  const newEntry = {\n    logger: childLogger,\n    parent: parentLogger[hierarchySymbol]\n  }\n  childLogger[hierarchySymbol] = newEntry\n}\n\nfunction setupBaseLogFunctions (logger, levels, proto) {\n  const logFunctions = {}\n  levels.forEach(level => {\n    logFunctions[level] = proto[level] ? proto[level] : (_console[level] || _console[logFallbackMap[level] || 'log'] || noop)\n  })\n  logger[baseLogFunctionSymbol] = logFunctions\n}\n\nfunction shouldSerialize (serialize, serializers) {\n  if (Array.isArray(serialize)) {\n    const hasToFilter = serialize.filter(function (k) {\n      return k !== '!stdSerializers.err'\n    })\n    return hasToFilter\n  } else if (serialize === true) {\n    return Object.keys(serializers)\n  }\n\n  return false\n}\n\nfunction pino (opts) {\n  opts = opts || {}\n  opts.browser = opts.browser || {}\n\n  const transmit = opts.browser.transmit\n  if (transmit && typeof transmit.send !== 'function') { throw Error('pino: transmit option must have a send function') }\n\n  const proto = opts.browser.write || _console\n  if (opts.browser.write) opts.browser.asObject = true\n  const serializers = opts.serializers || {}\n  const serialize = shouldSerialize(opts.browser.serialize, serializers)\n  let stdErrSerialize = opts.browser.serialize\n\n  if (\n    Array.isArray(opts.browser.serialize) &&\n    opts.browser.serialize.indexOf('!stdSerializers.err') > -1\n  ) stdErrSerialize = false\n\n  const customLevels = Object.keys(opts.customLevels || {})\n  const levels = ['error', 'fatal', 'warn', 'info', 'debug', 'trace'].concat(customLevels)\n\n  if (typeof proto === 'function') {\n    levels.forEach(function (level) {\n      proto[level] = proto\n    })\n  }\n  if (opts.enabled === false || opts.browser.disabled) opts.level = 'silent'\n  const level = opts.level || 'info'\n  const logger = Object.create(proto)\n  if (!logger.log) logger.log = noop\n\n  setupBaseLogFunctions(logger, levels, proto)\n  // setup root hierarchy entry\n  appendChildLogger({}, logger)\n\n  Object.defineProperty(logger, 'levelVal', {\n    get: getLevelVal\n  })\n  Object.defineProperty(logger, 'level', {\n    get: getLevel,\n    set: setLevel\n  })\n\n  const setOpts = {\n    transmit,\n    serialize,\n    asObject: opts.browser.asObject,\n    asObjectBindingsOnly: opts.browser.asObjectBindingsOnly,\n    formatters: opts.browser.formatters,\n    levels,\n    timestamp: getTimeFunction(opts),\n    messageKey: opts.messageKey || 'msg',\n    onChild: opts.onChild || noop\n  }\n  logger.levels = getLevels(opts)\n  logger.level = level\n\n  logger.isLevelEnabled = function (level) {\n    if (!this.levels.values[level]) {\n      return false\n    }\n\n    return this.levels.values[level] >= this.levels.values[this.level]\n  }\n  logger.setMaxListeners = logger.getMaxListeners =\n  logger.emit = logger.addListener = logger.on =\n  logger.prependListener = logger.once =\n  logger.prependOnceListener = logger.removeListener =\n  logger.removeAllListeners = logger.listeners =\n  logger.listenerCount = logger.eventNames =\n  logger.write = logger.flush = noop\n  logger.serializers = serializers\n  logger._serialize = serialize\n  logger._stdErrSerialize = stdErrSerialize\n  logger.child = function (...args) { return child.call(this, setOpts, ...args) }\n\n  if (transmit) logger._logEvent = createLogEventShape()\n\n  function getLevelVal () {\n    return levelToValue(this.level, this)\n  }\n\n  function getLevel () {\n    return this._level\n  }\n  function setLevel (level) {\n    if (level !== 'silent' && !this.levels.values[level]) {\n      throw Error('unknown level ' + level)\n    }\n    this._level = level\n\n    set(this, setOpts, logger, 'error') // <-- must stay first\n    set(this, setOpts, logger, 'fatal')\n    set(this, setOpts, logger, 'warn')\n    set(this, setOpts, logger, 'info')\n    set(this, setOpts, logger, 'debug')\n    set(this, setOpts, logger, 'trace')\n\n    customLevels.forEach((level) => {\n      set(this, setOpts, logger, level)\n    })\n  }\n\n  function child (setOpts, bindings, childOptions) {\n    if (!bindings) {\n      throw new Error('missing bindings for child Pino')\n    }\n    childOptions = childOptions || {}\n    if (serialize && bindings.serializers) {\n      childOptions.serializers = bindings.serializers\n    }\n    const childOptionsSerializers = childOptions.serializers\n    if (serialize && childOptionsSerializers) {\n      var childSerializers = Object.assign({}, serializers, childOptionsSerializers)\n      var childSerialize = opts.browser.serialize === true\n        ? Object.keys(childSerializers)\n        : serialize\n      delete bindings.serializers\n      applySerializers([bindings], childSerialize, childSerializers, this._stdErrSerialize)\n    }\n    function Child (parent) {\n      this._childLevel = (parent._childLevel | 0) + 1\n\n      // make sure bindings are available in the `set` function\n      this.bindings = bindings\n\n      if (childSerializers) {\n        this.serializers = childSerializers\n        this._serialize = childSerialize\n      }\n      if (transmit) {\n        this._logEvent = createLogEventShape(\n          [].concat(parent._logEvent.bindings, bindings)\n        )\n      }\n    }\n    Child.prototype = this\n    const newLogger = new Child(this)\n\n    // must happen before the level is assigned\n    appendChildLogger(this, newLogger)\n    newLogger.child = function (...args) { return child.call(this, setOpts, ...args) }\n    // required to actually initialize the logger functions for any given child\n    newLogger.level = childOptions.level || this.level // allow level to be set by childOptions\n    setOpts.onChild(newLogger)\n\n    return newLogger\n  }\n  return logger\n}\n\nfunction getLevels (opts) {\n  const customLevels = opts.customLevels || {}\n\n  const values = Object.assign({}, pino.levels.values, customLevels)\n  const labels = Object.assign({}, pino.levels.labels, invertObject(customLevels))\n\n  return {\n    values,\n    labels\n  }\n}\n\nfunction invertObject (obj) {\n  const inverted = {}\n  Object.keys(obj).forEach(function (key) {\n    inverted[obj[key]] = key\n  })\n  return inverted\n}\n\npino.levels = {\n  values: {\n    fatal: 60,\n    error: 50,\n    warn: 40,\n    info: 30,\n    debug: 20,\n    trace: 10\n  },\n  labels: {\n    10: 'trace',\n    20: 'debug',\n    30: 'info',\n    40: 'warn',\n    50: 'error',\n    60: 'fatal'\n  }\n}\n\npino.stdSerializers = stdSerializers\npino.stdTimeFunctions = Object.assign({}, { nullTime, epochTime, unixTime, isoTime })\n\nfunction getBindingChain (logger) {\n  const bindings = []\n  if (logger.bindings) {\n    bindings.push(logger.bindings)\n  }\n\n  // traverse up the tree to get all bindings\n  let hierarchy = logger[hierarchySymbol]\n  while (hierarchy.parent) {\n    hierarchy = hierarchy.parent\n    if (hierarchy.logger.bindings) {\n      bindings.push(hierarchy.logger.bindings)\n    }\n  }\n\n  return bindings.reverse()\n}\n\nfunction set (self, opts, rootLogger, level) {\n  // override the current log functions with either `noop` or the base log function\n  Object.defineProperty(self, level, {\n    value: (levelToValue(self.level, rootLogger) > levelToValue(level, rootLogger)\n      ? noop\n      : rootLogger[baseLogFunctionSymbol][level]),\n    writable: true,\n    enumerable: true,\n    configurable: true\n  })\n\n  if (self[level] === noop) {\n    if (!opts.transmit) return\n\n    const transmitLevel = opts.transmit.level || self.level\n    const transmitValue = levelToValue(transmitLevel, rootLogger)\n    const methodValue = levelToValue(level, rootLogger)\n    if (methodValue < transmitValue) return\n  }\n\n  // make sure the log format is correct\n  self[level] = createWrap(self, opts, rootLogger, level)\n\n  // prepend bindings if it is not the root logger\n  const bindings = getBindingChain(self)\n  if (bindings.length === 0) {\n    // early exit in case for rootLogger\n    return\n  }\n  self[level] = prependBindingsInArguments(bindings, self[level])\n}\n\nfunction prependBindingsInArguments (bindings, logFunc) {\n  return function () {\n    return logFunc.apply(this, [...bindings, ...arguments])\n  }\n}\n\nfunction createWrap (self, opts, rootLogger, level) {\n  return (function (write) {\n    return function LOG () {\n      const ts = opts.timestamp()\n      const args = new Array(arguments.length)\n      const proto = (Object.getPrototypeOf && Object.getPrototypeOf(this) === _console) ? _console : this\n      for (var i = 0; i < args.length; i++) args[i] = arguments[i]\n\n      var argsIsSerialized = false\n      if (opts.serialize) {\n        applySerializers(args, this._serialize, this.serializers, this._stdErrSerialize)\n        argsIsSerialized = true\n      }\n      if (opts.asObject || opts.formatters) {\n        write.call(proto, ...asObject(this, level, args, ts, opts))\n      } else write.apply(proto, args)\n\n      if (opts.transmit) {\n        const transmitLevel = opts.transmit.level || self._level\n        const transmitValue = levelToValue(transmitLevel, rootLogger)\n        const methodValue = levelToValue(level, rootLogger)\n        if (methodValue < transmitValue) return\n        transmit(this, {\n          ts,\n          methodLevel: level,\n          methodValue,\n          transmitLevel,\n          transmitValue: rootLogger.levels.values[opts.transmit.level || self._level],\n          send: opts.transmit.send,\n          val: levelToValue(self._level, rootLogger)\n        }, args, argsIsSerialized)\n      }\n    }\n  })(self[baseLogFunctionSymbol][level])\n}\n\nfunction asObject (logger, level, args, ts, opts) {\n  const {\n    level: levelFormatter,\n    log: logObjectFormatter = (obj) => obj\n  } = opts.formatters || {}\n  const argsCloned = args.slice()\n  let msg = argsCloned[0]\n  const logObject = {}\n\n  let lvl = (logger._childLevel | 0) + 1\n  if (lvl < 1) lvl = 1\n\n  if (ts) {\n    logObject.time = ts\n  }\n\n  if (levelFormatter) {\n    const formattedLevel = levelFormatter(level, logger.levels.values[level])\n    Object.assign(logObject, formattedLevel)\n  } else {\n    logObject.level = logger.levels.values[level]\n  }\n\n  if (opts.asObjectBindingsOnly) {\n    if (msg !== null && typeof msg === 'object') {\n      while (lvl-- && typeof argsCloned[0] === 'object') {\n        Object.assign(logObject, argsCloned.shift())\n      }\n    }\n\n    const formattedLogObject = logObjectFormatter(logObject)\n    return [formattedLogObject, ...argsCloned]\n  } else {\n    // deliberate, catching objects, arrays\n    if (msg !== null && typeof msg === 'object') {\n      while (lvl-- && typeof argsCloned[0] === 'object') {\n        Object.assign(logObject, argsCloned.shift())\n      }\n      msg = argsCloned.length ? format(argsCloned.shift(), argsCloned) : undefined\n    } else if (typeof msg === 'string') msg = format(argsCloned.shift(), argsCloned)\n    if (msg !== undefined) logObject[opts.messageKey] = msg\n\n    const formattedLogObject = logObjectFormatter(logObject)\n    return [formattedLogObject]\n  }\n}\n\nfunction applySerializers (args, serialize, serializers, stdErrSerialize) {\n  for (const i in args) {\n    if (stdErrSerialize && args[i] instanceof Error) {\n      args[i] = pino.stdSerializers.err(args[i])\n    } else if (typeof args[i] === 'object' && !Array.isArray(args[i]) && serialize) {\n      for (const k in args[i]) {\n        if (serialize.indexOf(k) > -1 && k in serializers) {\n          args[i][k] = serializers[k](args[i][k])\n        }\n      }\n    }\n  }\n}\n\nfunction transmit (logger, opts, args, argsIsSerialized = false) {\n  const send = opts.send\n  const ts = opts.ts\n  const methodLevel = opts.methodLevel\n  const methodValue = opts.methodValue\n  const val = opts.val\n  const bindings = logger._logEvent.bindings\n\n  if (!argsIsSerialized) {\n    applySerializers(\n      args,\n      logger._serialize || Object.keys(logger.serializers),\n      logger.serializers,\n      logger._stdErrSerialize === undefined ? true : logger._stdErrSerialize\n    )\n  }\n\n  logger._logEvent.ts = ts\n  logger._logEvent.messages = args.filter(function (arg) {\n    // bindings can only be objects, so reference equality check via indexOf is fine\n    return bindings.indexOf(arg) === -1\n  })\n\n  logger._logEvent.level.label = methodLevel\n  logger._logEvent.level.value = methodValue\n\n  send(methodLevel, logger._logEvent, val)\n\n  logger._logEvent = createLogEventShape(bindings)\n}\n\nfunction createLogEventShape (bindings) {\n  return {\n    ts: 0,\n    messages: [],\n    bindings: bindings || [],\n    level: { label: '', value: 0 }\n  }\n}\n\nfunction asErrValue (err) {\n  const obj = {\n    type: err.constructor.name,\n    msg: err.message,\n    stack: err.stack\n  }\n  for (const key in err) {\n    if (obj[key] === undefined) {\n      obj[key] = err[key]\n    }\n  }\n  return obj\n}\n\nfunction getTimeFunction (opts) {\n  if (typeof opts.timestamp === 'function') {\n    return opts.timestamp\n  }\n  if (opts.timestamp === false) {\n    return nullTime\n  }\n  return epochTime\n}\n\nfunction mock () { return {} }\nfunction passthrough (a) { return a }\nfunction noop () {}\n\nfunction nullTime () { return false }\nfunction epochTime () { return Date.now() }\nfunction unixTime () { return Math.round(Date.now() / 1000.0) }\nfunction isoTime () { return new Date(Date.now()).toISOString() } // using Date.now() for testability\n\n/* eslint-disable */\n/* istanbul ignore next */\nfunction pfGlobalThisOrFallback () {\n  function defd (o) { return typeof o !== 'undefined' && o }\n  try {\n    if (typeof globalThis !== 'undefined') return globalThis\n    Object.defineProperty(Object.prototype, 'globalThis', {\n      get: function () {\n        delete Object.prototype.globalThis\n        return (this.globalThis = this)\n      },\n      configurable: true\n    })\n    return globalThis\n  } catch (e) {\n    return defd(self) || defd(window) || defd(this) || {}\n  }\n}\n/* eslint-enable */\n\nmodule.exports.default = pino\nmodule.exports.pino = pino\n", "/**\n * Game Logger Module for E2E Testing\n * \n * This module provides structured logging for the D-Zone game to enable\n * comprehensive E2E testing through log-based verification.\n * \n * Features:\n * - Structured logging with pino for consistent format\n * - Game-specific event categories (actor, nametag, websocket, etc.)\n * - Environment-aware logging (disabled in production)\n * - E2E test integration through structured events\n * - Performance tracking and metrics\n */\n\nimport pino from 'pino';\n\n// Environment detection\nconst isProduction = typeof process !== 'undefined' && process.env.NODE_ENV === 'production';\nconst isTesting = typeof process !== 'undefined' && (process.env.NODE_ENV === 'test' || process.env.CI === 'true');\nconst isE2ETesting = typeof window !== 'undefined' && window.location.search.includes('e2e-test=true');\nconst isDebugMode = typeof window !== 'undefined' && window.location.search.includes('debug=true');\n\n// Logger configuration\nconst logger = pino({\n  level: isProduction ? 'warn' : 'debug',\n  browser: {\n    serialize: true,\n    transmit: {\n      level: 'debug',\n      send: function (level, logEvent) {\n        // In browser, emit structured logs for E2E test capture or debug mode\n        if (typeof window !== 'undefined' && (isTesting || isE2ETesting || isDebugMode)) {\n          console.log(`[GAME_LOG] ${JSON.stringify(logEvent)}`);\n        }\n      }\n    }\n  },\n  formatters: {\n    level: (label) => {\n      return { level: label };\n    }\n  }\n});\n\n/**\n * Game-specific logger with structured event categories\n */\nclass GameLogger {\n  private enabled: boolean = !isProduction;\n  \n  constructor(private baseLogger: pino.Logger) {}\n\n  /**\n   * Enable or disable logging (useful for production)\n   */\n  setEnabled(enabled: boolean): void {\n    this.enabled = enabled;\n  }\n\n  /**\n   * Check if logging is enabled\n   */\n  isEnabled(): boolean {\n    return this.enabled;\n  }\n\n  /**\n   * Check if debug mode is enabled\n   */\n  isDebugMode(): boolean {\n    return isDebugMode;\n  }\n\n  // ===========================================\n  // GAME LIFECYCLE EVENTS\n  // ===========================================\n\n  /**\n   * Game initialization event\n   */\n  gameInitialized(data: { width: number; height: number; version?: string }): void {\n    if (!this.enabled) return;\n    this.baseLogger.info({\n      category: 'game',\n      event: 'initialized',\n      timestamp: Date.now(),\n      ...data\n    }, 'Game initialized');\n  }\n\n  /**\n   * Initial canvas draw complete\n   */\n  initialDraw(): void {\n    if (!this.enabled) return;\n    this.baseLogger.info({\n      category: 'game',\n      event: 'initial_draw',\n      timestamp: Date.now()\n    }, 'Initial draw complete');\n  }\n\n  /**\n   * Game reset event\n   */\n  gameReset(): void {\n    if (!this.enabled) return;\n    this.baseLogger.info({\n      category: 'game',\n      event: 'reset',\n      timestamp: Date.now()\n    }, 'Game reset');\n  }\n\n  // ===========================================\n  // WORLD GENERATION EVENTS\n  // ===========================================\n\n  /**\n   * World generation completed\n   */\n  worldGenerated(data: {\n    totalTiles: number;\n    spawnablePositions: number;\n    worldSize: number;\n    worldRadius: number;\n    mapBounds: { xl: number; yl: number; xh: number; yh: number };\n    mainIslandSize?: number;\n    totalIslands?: number;\n    spawnPositions?: string[];\n  }): void {\n    if (!this.enabled) return;\n    this.baseLogger.info({\n      category: 'world',\n      event: 'generated',\n      timestamp: Date.now(),\n      ...data\n    }, `World generated: ${data.totalTiles} tiles, ${data.spawnablePositions} spawn positions`);\n  }\n\n  /**\n   * World spawn position analysis completed\n   */\n  worldSpawnAnalysis(data: {\n    totalPositions: number;\n    validSpawnPositions: number;\n    invalidSpawnPositions: number;\n    validPositions: string[];\n    invalidPositions: string[];\n  }): void {\n    if (!this.enabled) return;\n    this.baseLogger.info({\n      category: 'world',\n      event: 'spawn_analysis',\n      timestamp: Date.now(),\n      ...data\n    }, `Spawn analysis: ${data.validSpawnPositions} valid, ${data.invalidSpawnPositions} invalid positions`);\n  }\n\n  /**\n   * World tile map created\n   */\n  worldTileMap(data: {\n    totalTiles: number;\n    uniqueTileCodes: number;\n    tilesByCode: Record<string, number>;\n    gridTileTypes: Record<string, string>;\n    tileMap: Record<string, { \n      tileCode: string; \n      x: number; \n      y: number; \n      z: number;\n      grid: string;\n    }>;\n  }): void {\n    if (!this.enabled) return;\n    this.baseLogger.info({\n      category: 'world',\n      event: 'tile_map',\n      timestamp: Date.now(),\n      ...data\n    }, `Tile map created: ${data.totalTiles} tiles, ${data.uniqueTileCodes} unique tile codes`);\n  }\n\n  // ===========================================\n  // ACTOR SYSTEM EVENTS\n  // ===========================================\n\n  /**\n   * Actor spawned in the world\n   */\n  actorSpawned(data: { \n    uid: string; \n    username: string; \n    x: number; \n    y: number; \n    z?: number;\n    roleColor?: string;\n    presence?: string;\n  }): void {\n    if (!this.enabled) return;\n    this.baseLogger.info({\n      category: 'actor',\n      event: 'spawned',\n      timestamp: Date.now(),\n      ...data\n    }, `Actor spawned: ${data.username} at (${data.x}, ${data.y})`);\n  }\n\n  /**\n   * Actor movement event\n   */\n  actorMoved(data: { \n    uid: string; \n    username: string;\n    fromX: number;\n    fromY: number;\n    fromZ: number;\n    toX: number; \n    toY: number; \n    toZ: number;\n    movementType: 'relative' | 'absolute';\n    facing?: string;\n  }): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'actor',\n      event: 'moved',\n      timestamp: Date.now(),\n      ...data\n    }, `Actor moved: ${data.username} from (${data.fromX}, ${data.fromY}, ${data.fromZ}) to (${data.toX}, ${data.toY}, ${data.toZ})`);\n  }\n\n  /**\n   * Actor goto command issued\n   */\n  actorGoto(data: {\n    uid?: string;\n    username: string;\n    targetX: number;\n    targetY: number;\n  }): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'actor',\n      event: 'goto',\n      timestamp: Date.now(),\n      ...data\n    }, `Actor goto command: ${data.username} -> (${data.targetX}, ${data.targetY})`);\n  }\n\n  /**\n   * Actor removed from world\n   */\n  actorRemoved(data: { uid: string; username?: string }): void {\n    if (!this.enabled) return;\n    this.baseLogger.info({\n      category: 'actor',\n      event: 'removed',\n      timestamp: Date.now(),\n      ...data\n    }, `Actor removed: ${data.username || data.uid}`);\n  }\n\n  /**\n   * Actor status/presence update\n   */\n  actorUpdated(data: { \n    uid: string; \n    username?: string;\n    presence?: string;\n    roleColor?: string;\n    changes?: string[];\n  }): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'actor',\n      event: 'updated',\n      timestamp: Date.now(),\n      ...data\n    }, `Actor updated: ${data.username || data.uid}`);\n  }\n\n  /**\n   * Actor animation started\n   */\n  actorAnimationStarted(data: {\n    uid: string;\n    username: string;\n    animationType: 'hopping' | 'talking' | 'idle' | 'wander';\n    state: string;\n    facing: string;\n    frame: number;\n    destination?: { x: number; y: number; z: number };\n  }): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'actor',\n      event: 'animationStarted',\n      timestamp: Date.now(),\n      ...data\n    }, `Actor animation started: ${data.username} - ${data.animationType} (${data.state})`);\n  }\n\n  /**\n   * Actor animation finished\n   */\n  actorAnimationFinished(data: {\n    uid: string;\n    username: string;\n    animationType: 'hopping' | 'talking' | 'idle' | 'wander';\n    state: string;\n    facing: string;\n    finalFrame: number;\n    position: { x: number; y: number; z: number };\n  }): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'actor',\n      event: 'animationFinished',\n      timestamp: Date.now(),\n      ...data\n    }, `Actor animation finished: ${data.username} - ${data.animationType} at (${data.position.x}, ${data.position.y})`);\n  }\n\n  /**\n   * Actor sprite rendered to canvas\n   */\n  actorSpriteRendered(data: {\n    uid: string;\n    username: string;\n    state: string;\n    facing: string;\n    frame: number;\n    spriteMetrics: {\n      x: number;\n      y: number;\n      w: number;\n      h: number;\n      ox: number;\n      oy: number;\n    };\n    image: string | string[];\n    presence: string;\n    talking: boolean;\n    moving: boolean;\n  }): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'actor',\n      event: 'spriteRendered',\n      timestamp: Date.now(),\n      ...data\n    }, `Actor sprite rendered: ${data.username} - ${data.state}/${data.facing} (${data.presence})`);\n  }\n\n  // ===========================================\n  // NAMETAG SYSTEM EVENTS\n  // ===========================================\n\n  /**\n   * Nametag shown for actor\n   */\n  nametagShow(actorUid: string, username?: string): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'nametag',\n      event: 'show',\n      timestamp: Date.now(),\n      actorUid,\n      username\n    }, `Nametag shown: ${username || actorUid}`);\n  }\n\n  /**\n   * Nametag hidden for actor\n   */\n  nametagHide(actorUid: string, username?: string): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'nametag',\n      event: 'hide',\n      timestamp: Date.now(),\n      actorUid,\n      username\n    }, `Nametag hidden: ${username || actorUid}`);\n  }\n\n  /**\n   * Multiple nametags resolved (only one shown)\n   */\n  nametagResolved(visibleActorUid: string, hiddenActorUids: string[]): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'nametag',\n      event: 'resolved',\n      timestamp: Date.now(),\n      visibleActorUid,\n      hiddenActorUids,\n      totalCount: hiddenActorUids.length + 1\n    }, `Nametag conflict resolved: showing ${visibleActorUid}, hiding ${hiddenActorUids.length} others`);\n  }\n\n  // ===========================================\n  // WEBSOCKET EVENTS\n  // ===========================================\n\n  /**\n   * WebSocket connection established\n   */\n  websocketConnected(url?: string): void {\n    if (!this.enabled) return;\n    this.baseLogger.info({\n      category: 'websocket',\n      event: 'connected',\n      timestamp: Date.now(),\n      url\n    }, `WebSocket connected: ${url || 'unknown'}`);\n  }\n\n  /**\n   * WebSocket disconnected\n   */\n  websocketDisconnected(reason?: string): void {\n    if (!this.enabled) return;\n    this.baseLogger.warn({\n      category: 'websocket',\n      event: 'disconnected',\n      timestamp: Date.now(),\n      reason\n    }, `WebSocket disconnected: ${reason || 'unknown'}`);\n  }\n\n  /**\n   * WebSocket message received\n   */\n  websocketMessageReceived(data: { type: string; [key: string]: any }): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'websocket',\n      event: 'message_received',\n      timestamp: Date.now(),\n      messageType: data.type,\n      dataSize: JSON.stringify(data).length\n    }, `WebSocket message: ${data.type}`);\n  }\n\n  /**\n   * WebSocket message sent\n   */\n  websocketMessageSent(data: { type: string; [key: string]: any }): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'websocket',\n      event: 'message_sent',\n      timestamp: Date.now(),\n      messageType: data.type,\n      dataSize: JSON.stringify(data).length\n    }, `WebSocket sent: ${data.type}`);\n  }\n\n  /**\n   * Server joined successfully\n   */\n  serverJoined(serverId: string, serverName?: string): void {\n    if (!this.enabled) return;\n    this.baseLogger.info({\n      category: 'websocket',\n      event: 'server_joined',\n      timestamp: Date.now(),\n      serverId,\n      serverName\n    }, `Joined server: ${serverName || serverId}`);\n  }\n\n  // ===========================================\n  // UI EVENTS\n  // ===========================================\n\n  /**\n   * UI panel opened\n   */\n  uiPanelOpened(panelType: string): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'ui',\n      event: 'panel_opened',\n      timestamp: Date.now(),\n      panelType\n    }, `UI panel opened: ${panelType}`);\n  }\n\n  /**\n   * UI panel closed\n   */\n  uiPanelClosed(panelType: string): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'ui',\n      event: 'panel_closed',\n      timestamp: Date.now(),\n      panelType\n    }, `UI panel closed: ${panelType}`);\n  }\n\n  /**\n   * Button clicked\n   */\n  buttonClicked(buttonType: string, buttonText?: string): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'ui',\n      event: 'button_clicked',\n      timestamp: Date.now(),\n      buttonType,\n      buttonText\n    }, `Button clicked: ${buttonType} (${buttonText || 'no text'})`);\n  }\n\n  // ===========================================\n  // CANVAS INTERACTION EVENTS\n  // ===========================================\n\n  /**\n   * Canvas hover event\n   */\n  canvasHover(x: number, y: number, actorUid?: string): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'canvas',\n      event: 'hover',\n      timestamp: Date.now(),\n      x,\n      y,\n      actorUid\n    }, `Canvas hover: (${x}, ${y}) ${actorUid ? `on actor ${actorUid}` : ''}`);\n  }\n\n  /**\n   * Canvas click event\n   */\n  canvasClick(x: number, y: number, actorUid?: string): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'canvas',\n      event: 'click',\n      timestamp: Date.now(),\n      x,\n      y,\n      actorUid\n    }, `Canvas click: (${x}, ${y}) ${actorUid ? `on actor ${actorUid}` : ''}`);\n  }\n\n  /**\n   * Canvas resize event\n   */\n  canvasResize(width: number, height: number): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'canvas',\n      event: 'resize',\n      timestamp: Date.now(),\n      width,\n      height\n    }, `Canvas resized: ${width}x${height}`);\n  }\n\n  // ===========================================\n  // AUTHENTICATION EVENTS\n  // ===========================================\n\n  /**\n   * Discord OAuth login attempt\n   */\n  discordLoginAttempt(): void {\n    if (!this.enabled) return;\n    this.baseLogger.info({\n      category: 'auth',\n      event: 'discord_login_attempt',\n      timestamp: Date.now()\n    }, 'Discord login attempt started');\n  }\n\n  /**\n   * Discord OAuth login success\n   */\n  discordLoginSuccess(username: string): void {\n    if (!this.enabled) return;\n    this.baseLogger.info({\n      category: 'auth',\n      event: 'discord_login_success',\n      timestamp: Date.now(),\n      username\n    }, `Discord login successful: ${username}`);\n  }\n\n  /**\n   * Discord OAuth login error\n   */\n  discordLoginError(error: string): void {\n    if (!this.enabled) return;\n    this.baseLogger.error({\n      category: 'auth',\n      event: 'discord_login_error',\n      timestamp: Date.now(),\n      error\n    }, `Discord login failed: ${error}`);\n  }\n\n  /**\n   * Discord logout\n   */\n  discordLogout(): void {\n    if (!this.enabled) return;\n    this.baseLogger.info({\n      category: 'auth',\n      event: 'discord_logout',\n      timestamp: Date.now()\n    }, 'Discord logout');\n  }\n\n  // ===========================================\n  // PERFORMANCE EVENTS\n  // ===========================================\n\n  /**\n   * Performance timing measurement\n   */\n  performanceMetric(metric: string, value: number, unit: string = 'ms'): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'performance',\n      event: 'metric',\n      timestamp: Date.now(),\n      metric,\n      value,\n      unit\n    }, `Performance: ${metric} = ${value}${unit}`);\n  }\n\n  /**\n   * Frame rate measurement\n   */\n  frameRate(fps: number): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug({\n      category: 'performance',\n      event: 'frame_rate',\n      timestamp: Date.now(),\n      fps\n    }, `FPS: ${fps}`);\n  }\n\n  // ===========================================\n  // GENERIC LOGGING METHODS\n  // ===========================================\n\n  /**\n   * Info level logging\n   */\n  info(message: string, data?: any): void {\n    if (!this.enabled) return;\n    this.baseLogger.info(data || {}, message);\n  }\n\n  /**\n   * Debug level logging\n   */\n  debug(message: string, data?: any): void {\n    if (!this.enabled) return;\n    this.baseLogger.debug(data || {}, message);\n  }\n\n  /**\n   * Warning level logging\n   */\n  warn(message: string, data?: any): void {\n    if (!this.enabled) return;\n    this.baseLogger.warn(data || {}, message);\n  }\n\n  /**\n   * Error level logging\n   */\n  error(message: string, error?: any): void {\n    if (!this.enabled) return;\n    this.baseLogger.error(error || {}, message);\n  }\n}\n\n// Create and export the game logger instance\nexport const gameLogger = new GameLogger(logger);\n\n// Expose gameLogger on window for E2E tests and debug mode\nif (typeof window !== 'undefined' && ((window as any).__E2E_TEST_MODE || isDebugMode)) {\n  (window as any).gameLogger = gameLogger;\n  console.log('\u2705 [DEBUG/E2E] gameLogger exposed on window.gameLogger');\n}\n\n// Expose debug mode flag for easy access\nif (typeof window !== 'undefined' && isDebugMode) {\n  (window as any).__DEBUG_MODE = true;\n  console.log('\uD83D\uDC1B [DEBUG] Debug mode enabled - walkable tiles will be highlighted');\n}\n\n// Export the base logger for special cases\nexport { logger as baseLogger };\n\n// Export debug mode flag\n  export { isDebugMode };\n\n// Export types for TypeScript support\n    export type {\n    GameLogger\n  };\n\n", "// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar R = typeof Reflect === 'object' ? Reflect : null\nvar ReflectApply = R && typeof R.apply === 'function'\n  ? R.apply\n  : function ReflectApply(target, receiver, args) {\n    return Function.prototype.apply.call(target, receiver, args);\n  }\n\nvar ReflectOwnKeys\nif (R && typeof R.ownKeys === 'function') {\n  ReflectOwnKeys = R.ownKeys\n} else if (Object.getOwnPropertySymbols) {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target)\n      .concat(Object.getOwnPropertySymbols(target));\n  };\n} else {\n  ReflectOwnKeys = function ReflectOwnKeys(target) {\n    return Object.getOwnPropertyNames(target);\n  };\n}\n\nfunction ProcessEmitWarning(warning) {\n  if (console && console.warn) console.warn(warning);\n}\n\nvar NumberIsNaN = Number.isNaN || function NumberIsNaN(value) {\n  return value !== value;\n}\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nmodule.exports = EventEmitter;\nmodule.exports.once = once;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._eventsCount = 0;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nvar defaultMaxListeners = 10;\n\nfunction checkListener(listener) {\n  if (typeof listener !== 'function') {\n    throw new TypeError('The \"listener\" argument must be of type Function. Received type ' + typeof listener);\n  }\n}\n\nObject.defineProperty(EventEmitter, 'defaultMaxListeners', {\n  enumerable: true,\n  get: function() {\n    return defaultMaxListeners;\n  },\n  set: function(arg) {\n    if (typeof arg !== 'number' || arg < 0 || NumberIsNaN(arg)) {\n      throw new RangeError('The value of \"defaultMaxListeners\" is out of range. It must be a non-negative number. Received ' + arg + '.');\n    }\n    defaultMaxListeners = arg;\n  }\n});\n\nEventEmitter.init = function() {\n\n  if (this._events === undefined ||\n      this._events === Object.getPrototypeOf(this)._events) {\n    this._events = Object.create(null);\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || NumberIsNaN(n)) {\n    throw new RangeError('The value of \"n\" is out of range. It must be a non-negative number. Received ' + n + '.');\n  }\n  this._maxListeners = n;\n  return this;\n};\n\nfunction _getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return _getMaxListeners(this);\n};\n\nEventEmitter.prototype.emit = function emit(type) {\n  var args = [];\n  for (var i = 1; i < arguments.length; i++) args.push(arguments[i]);\n  var doError = (type === 'error');\n\n  var events = this._events;\n  if (events !== undefined)\n    doError = (doError && events.error === undefined);\n  else if (!doError)\n    return false;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    var er;\n    if (args.length > 0)\n      er = args[0];\n    if (er instanceof Error) {\n      // Note: The comments on the `throw` lines are intentional, they show\n      // up in Node's output if this results in an unhandled exception.\n      throw er; // Unhandled 'error' event\n    }\n    // At least give some kind of context to the user\n    var err = new Error('Unhandled error.' + (er ? ' (' + er.message + ')' : ''));\n    err.context = er;\n    throw err; // Unhandled 'error' event\n  }\n\n  var handler = events[type];\n\n  if (handler === undefined)\n    return false;\n\n  if (typeof handler === 'function') {\n    ReflectApply(handler, this, args);\n  } else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      ReflectApply(listeners[i], this, args);\n  }\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  checkListener(listener);\n\n  events = target._events;\n  if (events === undefined) {\n    events = target._events = Object.create(null);\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener !== undefined) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (existing === undefined) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] =\n        prepend ? [listener, existing] : [existing, listener];\n      // If we've already got an array, just append.\n    } else if (prepend) {\n      existing.unshift(listener);\n    } else {\n      existing.push(listener);\n    }\n\n    // Check for listener leak\n    m = _getMaxListeners(target);\n    if (m > 0 && existing.length > m && !existing.warned) {\n      existing.warned = true;\n      // No error code for this since it is a Warning\n      // eslint-disable-next-line no-restricted-syntax\n      var w = new Error('Possible EventEmitter memory leak detected. ' +\n                          existing.length + ' ' + String(type) + ' listeners ' +\n                          'added. Use emitter.setMaxListeners() to ' +\n                          'increase limit');\n      w.name = 'MaxListenersExceededWarning';\n      w.emitter = target;\n      w.type = type;\n      w.count = existing.length;\n      ProcessEmitWarning(w);\n    }\n  }\n\n  return target;\n}\n\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction onceWrapper() {\n  if (!this.fired) {\n    this.target.removeListener(this.type, this.wrapFn);\n    this.fired = true;\n    if (arguments.length === 0)\n      return this.listener.call(this.target);\n    return this.listener.apply(this.target, arguments);\n  }\n}\n\nfunction _onceWrap(target, type, listener) {\n  var state = { fired: false, wrapFn: undefined, target: target, type: type, listener: listener };\n  var wrapped = onceWrapper.bind(state);\n  wrapped.listener = listener;\n  state.wrapFn = wrapped;\n  return wrapped;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  checkListener(listener);\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      checkListener(listener);\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// Emits a 'removeListener' event if and only if the listener was removed.\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      checkListener(listener);\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      list = events[type];\n      if (list === undefined)\n        return this;\n\n      if (list === listener || list.listener === listener) {\n        if (--this._eventsCount === 0)\n          this._events = Object.create(null);\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length - 1; i >= 0; i--) {\n          if (list[i] === listener || list[i].listener === listener) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (position === 0)\n          list.shift();\n        else {\n          spliceOne(list, position);\n        }\n\n        if (list.length === 1)\n          events[type] = list[0];\n\n        if (events.removeListener !== undefined)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.off = EventEmitter.prototype.removeListener;\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events, i;\n\n      events = this._events;\n      if (events === undefined)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (events.removeListener === undefined) {\n        if (arguments.length === 0) {\n          this._events = Object.create(null);\n          this._eventsCount = 0;\n        } else if (events[type] !== undefined) {\n          if (--this._eventsCount === 0)\n            this._events = Object.create(null);\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        var key;\n        for (i = 0; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = Object.create(null);\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners !== undefined) {\n        // LIFO order\n        for (i = listeners.length - 1; i >= 0; i--) {\n          this.removeListener(type, listeners[i]);\n        }\n      }\n\n      return this;\n    };\n\nfunction _listeners(target, type, unwrap) {\n  var events = target._events;\n\n  if (events === undefined)\n    return [];\n\n  var evlistener = events[type];\n  if (evlistener === undefined)\n    return [];\n\n  if (typeof evlistener === 'function')\n    return unwrap ? [evlistener.listener || evlistener] : [evlistener];\n\n  return unwrap ?\n    unwrapListeners(evlistener) : arrayClone(evlistener, evlistener.length);\n}\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  return _listeners(this, type, true);\n};\n\nEventEmitter.prototype.rawListeners = function rawListeners(type) {\n  return _listeners(this, type, false);\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events !== undefined) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener !== undefined) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? ReflectOwnKeys(this._events) : [];\n};\n\nfunction arrayClone(arr, n) {\n  var copy = new Array(n);\n  for (var i = 0; i < n; ++i)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction spliceOne(list, index) {\n  for (; index + 1 < list.length; index++)\n    list[index] = list[index + 1];\n  list.pop();\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n\nfunction once(emitter, name) {\n  return new Promise(function (resolve, reject) {\n    function errorListener(err) {\n      emitter.removeListener(name, resolver);\n      reject(err);\n    }\n\n    function resolver() {\n      if (typeof emitter.removeListener === 'function') {\n        emitter.removeListener('error', errorListener);\n      }\n      resolve([].slice.call(arguments));\n    };\n\n    eventTargetAgnosticAddListener(emitter, name, resolver, { once: true });\n    if (name !== 'error') {\n      addErrorHandlerIfEventEmitter(emitter, errorListener, { once: true });\n    }\n  });\n}\n\nfunction addErrorHandlerIfEventEmitter(emitter, handler, flags) {\n  if (typeof emitter.on === 'function') {\n    eventTargetAgnosticAddListener(emitter, 'error', handler, flags);\n  }\n}\n\nfunction eventTargetAgnosticAddListener(emitter, name, listener, flags) {\n  if (typeof emitter.on === 'function') {\n    if (flags.once) {\n      emitter.once(name, listener);\n    } else {\n      emitter.on(name, listener);\n    }\n  } else if (typeof emitter.addEventListener === 'function') {\n    // EventTarget does not have `error` event semantics like Node\n    // EventEmitters, we do not listen for `error` events here.\n    emitter.addEventListener(name, function wrapListener(arg) {\n      // IE does not have builtin `{ once: true }` support so we\n      // have to do it manually.\n      if (flags.once) {\n        emitter.removeEventListener(name, wrapListener);\n      }\n      listener(arg);\n    });\n  } else {\n    throw new TypeError('The \"emitter\" argument must be of type EventEmitter. Received type ' + typeof emitter);\n  }\n}\n", "'use strict';\n\nexport const util = {\n    randomIntRange(min: number, max: number): number {\n        return Math.floor(Math.random() * (+max - +min + 1)) + +min;\n    },\n    \n    pickInArray<T>(arr: T[]): T {\n        return arr[this.randomIntRange(0, arr.length - 1)];\n    },\n    \n    pickInObject(obj: Record<string, any>): string {\n        return this.pickInArray(Object.keys(obj));\n    },\n    \n    findAndRemove<T>(elem: T, arr: T[]): void {\n        for (let i = 0; i < arr.length; i++) {\n            if (arr[i] === elem) { \n                arr.splice(i, 1);\n                i--;\n            }\n        }\n    },\n    \n    right(text: string, length: number): string { \n        return text.substring(text.length - length, text.length); \n    },\n    \n    clamp(val: number, min: number, max: number): number { \n        return Math.min(max, Math.max(min, val)); \n    },\n    \n    clampWrap(val: number, min: number, max: number): number {\n        const wrap = (val - min) % (max + 1 - min);\n        return wrap >= 0 ? min + wrap : max + 1 + wrap;\n    },\n    \n    fractionalArrayIndex(arr: number[], index: number): number {\n        const floorX = Math.floor(index);\n        const lower = arr[floorX];\n        if (floorX === index) return lower;\n        const upper = arr[Math.ceil(index)];\n        const fraction = index - Math.floor(index);\n        return (lower + ((upper - lower) * fraction)); \n    },\n    \n    getURLParameter(name: string): string | null {\n        return decodeURIComponent(\n            (new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)')\n                .exec(location.search) || [,\"\"])[1].replace(/\\+/g, '%20')) || null;\n    },\n    \n    abbreviate(text: string, blacklist?: string[]): string {\n        const split = text.split(' ');\n        const alpha = /[a-z0-9]/i;\n        let result = '';\n        for (let w = 0; w < split.length; w++) {\n            for (let l = 0; l < split[w].length; l++) {\n                if (alpha.test(split[w][l])) {\n                    result += split[w][l];\n                    break;\n                }\n            }\n        }\n        if (result.trim() === '') result = '1';\n        if (blacklist && blacklist.indexOf(result) >= 0) {\n            let variation = 0;\n            result += variation;\n            do {\n                variation++;\n                result = result.substring(0, result.length - 1) + variation;\n            } while (blacklist.indexOf(result) >= 0);\n        }\n        return result;\n    },\n    \n    alphabet: ['a','b','c','d','e','f','g','h','i','j','k','l','m',\n        'n','o','p','q','r','s','t','u','v','w','x','y','z'] as const,\n    vowels: ['a','e','i','o','u'] as const,\n    consonants: ['b','c','d','f','g','h','j','k','l','m','n','p','q','r','s','t','v','w','x','y','z'] as const,\n    hex: ['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'] as const\n};\n\nexport default util;", "'use strict';\n\nimport { util } from './util.js';\n\nconst closestGrids: [number, number][] = [];\n\ninterface Direction {\n    x: number;\n    y: number;\n}\n\ninterface Neighbors {\n    n: string;\n    e: string;\n    s: string;\n    w: string;\n}\n\ninterface Neighbors8 extends Neighbors {\n    nw: string;\n    ne: string;\n    sw: string;\n    se: string;\n}\n\ninterface Point {\n    x: number;\n    y: number;\n}\n\nexport const geometry = {\n    generateClosestGrids: function(size: number): void {\n        for(let sx = size*-1; sx <= size; sx++) { \n            for(let sy = size*-1; sy <= size; sy++) {\n                closestGrids.push([sx, sy]);\n            }\n        }\n        closestGrids.sort(function(a, b) {\n            return (Math.abs(a[0]) + Math.abs(a[1])) - (Math.abs(b[0]) + Math.abs(b[1]));\n        });\n    },\n    closestGrids: closestGrids,\n    DIRECTIONS: {\n        north: { x: 0, y: -1 },\n        east: { x: 1, y: 0 },\n        south: { x: 0, y: 1 },\n        west: { x: -1, y: 0 }\n    } as Record<string, Direction>,\n    randomDirection: function(): Direction {\n        return this.DIRECTIONS[util.pickInObject(this.DIRECTIONS)];\n    },\n    getNeighbors: function(grid: string): Neighbors {\n        const x = +grid.split(':')[0];\n        const y = +grid.split(':')[1];\n        return { \n            n: x+':'+(y-1), \n            e: (x+1)+':'+y, \n            s: x+':'+(y+1), \n            w: (x-1)+':'+y \n        };\n    },\n    get8Neighbors: function(grid: string): Neighbors8 {\n        const x = +grid.split(':')[0];\n        const y = +grid.split(':')[1];\n        return { \n            n: x+':'+(y-1), e: (x+1)+':'+y, s: x+':'+(y+1), w: (x-1)+':'+y,\n            nw: (x-1)+':'+(y-1), ne: (x+1)+':'+(y-1), sw: (x-1)+':'+(y+1), se: (x+1)+':'+(y+1)\n        };\n    },\n    getDistance: function(a: Point, b: Point): number {\n        return Math.abs(a.x - b.x) + Math.abs(a.y - b.y);\n    },\n    intervalOverlaps: function(a1: number, a2: number, b1: number, b2: number): boolean {\n        return a1 >= b1 && a1 < b2 || b1 >= a1 && b1 < a2;\n    },\n    buildNoiseMap: function(width: number, height: number): number[][] {\n        const map: number[][] = [];\n        for(let x = 0; x < width; x++) {\n            map.push([]);\n            for(let y = 0; y < height; y++) {\n                map[x].push(Math.random());\n            }\n        }\n        return map;\n    },\n    getNoiseMapPoint: function(map: number[][], x: number, y: number): number {\n        const floorX = Math.floor(x);\n        const lowerXArray = map[floorX];\n        if(floorX == x) return util.fractionalArrayIndex(lowerXArray, y);\n        const ceilX = Math.ceil(x);\n        const upperXArray = map[ceilX];\n        const floorY = Math.floor(y);\n        if(floorY == y) {\n            return util.fractionalArrayIndex([lowerXArray[floorY], upperXArray[floorY]], x - floorX);\n        }\n        const lowerXY = util.fractionalArrayIndex(lowerXArray, y);\n        const upperXY = util.fractionalArrayIndex(upperXArray, y);\n        return util.fractionalArrayIndex([lowerXY, upperXY], x - floorX);\n    }\n};", "'use strict';\n\nimport { EventEmitter } from 'events';\nimport { util } from '../common/util.js';\nimport { gameLogger } from '../../gameLogger.js';\n\ninterface EntitySprite {\n    [key: string]: any;\n}\n\ninterface Game {\n    entities: Entity[];\n    world: {\n        addToWorld(entity: Entity): void;\n        removeFromWorld(entity: Entity): void;\n    };\n    renderer: {\n        addToZBuffer(sprite: EntitySprite, depth?: number): void;\n        removeFromZBuffer(sprite: EntitySprite, depth?: number): void;\n        overlay: EntitySprite[];\n    };\n    schedule: Array<{\n        type: string;\n        tick?: number;\n        start?: number;\n        count?: number;\n        cb: Function;\n        afterCB?: Function;\n        entity?: Entity;\n    }>;\n    ticks: number;\n}\n\nexport default class Entity extends EventEmitter {\n    sprite: EntitySprite = {};\n    game?: Game;\n    position?: any;\n    zDepth?: number;\n    invisible?: boolean;\n    exists?: boolean;\n\n    constructor() {\n        super();\n        this.sprite = {};\n    }\n\n    addToGame(game: Game): void {\n        this.game = game;\n        this.game.entities.push(this);\n        \n        if(this.position && typeof this.position.x === 'number' && typeof this.position.y === 'number' && typeof this.position.z === 'number') {\n            this.game.world.addToWorld(this);\n            if(!this.invisible) this.game.renderer.addToZBuffer(this.sprite, this.zDepth);\n        } else {\n            this.game.renderer.overlay.push(this.sprite);\n        }\n        this.exists = true;\n    }\n\n    remove(): void {\n        this.exists = false;\n        if(this.position && typeof this.position.x === 'number' && typeof this.position.y === 'number' && typeof this.position.z === 'number') {\n            if(!this.invisible && this.game) this.game.renderer.removeFromZBuffer(this.sprite, this.zDepth);\n            if(this.game) this.game.world.removeFromWorld(this);\n        } else {\n            if(this.game) util.findAndRemove(this, this.game.renderer.overlay);\n        }\n        if(this.game) util.findAndRemove(this, this.game.entities);\n    }\n\n    tickDelay(cb: Function, ticks: number): void { // Execute callback after X ticks\n        if(!this.game) return;\n        this.game.schedule.push({ type: 'once', tick: this.game.ticks + ticks, cb: cb, entity: this });\n    }\n\n    tickRepeat(cb: Function, ticks: number, afterCB?: Function): void { // Execute callback every tick for X ticks\n        if(!this.game) return;\n        \n        // Validate ticks parameter to prevent NaN in progress.percent calculation\n        if (!isFinite(ticks) || ticks <= 0) {\n            gameLogger.error('Entity tickRepeat: Invalid ticks parameter', {\n                ticks,\n                entity: this.constructor.name,\n                isFinite: isFinite(ticks),\n                isPositive: ticks > 0\n            });\n            return;\n        }\n        \n        this.game.schedule.push({ type: 'repeat', start: this.game.ticks, count: ticks, cb: cb, afterCB: afterCB, entity: this });\n    }\n\n    removeFromSchedule(cb: Function): void {\n        if(!this.game) return;\n        for(let i = 0; i < this.game.schedule.length; i++) {\n            if(this.game.schedule[i].entity === this && this.game.schedule[i].cb === cb) {\n                this.game.schedule[i].type = 'deleted';\n                break;\n            }\n        }\n    }\n}", "'use strict';\n\nimport { gameLogger } from '../../gameLogger.js';\n\nfunction isNumeric(n: any): n is number {\n    return !isNaN(parseFloat(n)) && isFinite(n);\n}\n\nexport class BetterCanvas {\n    canvas: HTMLCanvasElement;\n    context: CanvasRenderingContext2D;\n\n    constructor(width: number, height: number) {\n        if (!isNumeric(width) || !isNumeric(height)) {\n            gameLogger.error('BetterCanvas: Invalid canvas size', { width, height });\n        }\n        this.canvas = document.createElement('canvas');\n        this.canvas.width = width;\n        this.canvas.height = height;\n        const context = this.canvas.getContext('2d');\n        if (!context) {\n            throw new Error('Could not get 2D context from canvas');\n        }\n        this.context = context;\n    }\n\n    drawImage(\n        img: CanvasImageSource, \n        sx: number, \n        sy: number, \n        sw: number, \n        sh: number, \n        dx: number, \n        dy: number, \n        dw: number, \n        dh: number, \n        opacity?: number\n    ): void {\n        if (!img || !(sx >= 0) || !(sy >= 0) || !(sw >= 0) || !(sh >= 0)\n            || !isNumeric(dx) || !isNumeric(dy) || !(dw >= 0) || !(dh >= 0)) {\n            gameLogger.error('BetterCanvas drawImage: Invalid parameters', { \n                hasImg: !!img, sx, sy, sw, sh, dx, dy, dw, dh \n            });\n            if ((window as any).pause) {\n                (window as any).pause();\n            }\n        }\n        if (opacity !== undefined) {\n            this.context.save();\n            this.context.globalAlpha = opacity;\n        }\n        this.context.drawImage(img, sx, sy, sw, sh, dx, dy, dw, dh);\n        if (opacity !== undefined) {\n            this.context.restore();\n        }\n    }\n\n    fill(color: string): void {\n        this.context.fillStyle = color;\n        this.context.fillRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    clear(): void {\n        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n    fillRect(color: string, x: number, y: number, w: number, h: number): void {\n        if (!isNumeric(x) || !isNumeric(y) || !isNumeric(w) || !isNumeric(h)) {\n            gameLogger.error('BetterCanvas fillRect: Invalid parameters', { color, x, y, w, h });\n            if ((window as any).pause) {\n                (window as any).pause();\n            }\n        }\n        this.context.fillStyle = color;\n        this.context.fillRect(Math.round(x), Math.round(y), Math.round(w), Math.round(h));\n    }\n\n    clearRect(x: number, y: number, w: number, h: number): void {\n        if (!isNumeric(x) || !isNumeric(y) || !isNumeric(w) || !isNumeric(h)) {\n            gameLogger.error('BetterCanvas clearRect: Invalid parameters', { x, y, w, h });\n            if ((window as any).pause) {\n                (window as any).pause();\n            }\n        }\n        this.context.clearRect(Math.round(x), Math.round(y), Math.round(w), Math.round(h));\n    }\n}\n\nexport default BetterCanvas;", "'use strict';\n\nimport BetterCanvas from './bettercanvas.js';\n\ninterface CharInfo {\n    x: number;\n    y: number;\n    w: number;\n    h: number;\n    char: string;\n    oy?: number;\n}\n\ninterface CharSet {\n    y: number;\n    height: number;\n    xSpacing?: number;\n    oy?: number;\n    count?: number;\n    chars: Array<[string, number]>;\n}\n\ninterface CharMap {\n    x: number;\n    char: CharInfo;\n    w: number;\n    oy?: number;\n}\n\ninterface LineInfo {\n    w: number;\n    chars: CharMap[];\n}\n\ninterface TextMetrics {\n    lines: LineInfo[];\n    text: string;\n    w: number;\n}\n\ninterface BlotOptions {\n    text: string;\n    x?: number;\n    y?: number;\n    maxWidth?: number;\n    maxChars?: number;\n    lineStart?: number;\n    lineCount?: number;\n    canvas?: BetterCanvas;\n    bg?: string;\n    metrics?: TextMetrics;\n}\n\ninterface TransitionOptions {\n    progress: number;\n    bg: string;\n    canvas?: BetterCanvas;\n    lineCount?: number;\n    metrics?: TextMetrics;\n    text?: string;\n    maxWidth?: number;\n}\n\nconst charSets: Record<string, CharSet> = {\n    upper: { y: 0, height: 8, xSpacing: 1, chars: [\n        ['A',5], ['B',5], ['C',5], ['D',5], ['E',4], ['F',4], ['G',5], ['H',5], ['I',3], ['J',5],\n        ['K',5], ['L',4], ['M',5], ['N',5], ['O',5], ['P',5], ['Q',5], ['R',5], ['S',5], ['T',5],\n        ['U',5], ['V',5], ['W',5], ['X',5], ['Y',5], ['Z',5]\n    ] },\n    lower: { y: 8, height: 11, xSpacing: 1, chars: [\n        ['a',5], ['b',4], ['c',4], ['d',4], ['e',4], ['f',4], ['g',4], ['h',4], ['i',1], ['j',2],\n        ['k',4], ['l',1], ['m',5], ['n',4], ['o',4], ['p',4], ['q',4], ['r',4], ['s',4], ['t',4],\n        ['u',4], ['v',5], ['w',5], ['x',4], ['y',4], ['z',4], [' ',4]\n    ] },\n    numsAndSymbols: { y: 19, xSpacing: 1, height: 8, chars: [\n        ['0',4], ['1',3], ['2',4], ['3',4], ['4',4], ['5',4], ['6',4], ['7',4], ['8',4], ['9',4],\n        ['`',2],['~',6],['!',1],['@',7],['#',7],['$',4],['%',5],['^',5],['&',6],['*',3],['(',2],\n        [')',2],['_',5],['=',5],['-',5],['+',5],['|',1],[',',2],['.',1],['<',5],['>',5],['?',4],\n        ['/',3],['\\\\',3],[';',1],[':',1],[\"'\",1],['\"',3],['[',2],[']',2],['{',3],['}',3]\n    ] },\n    icons: { count: 4, y: 27, height: 12, chars: [\n        [':icon-npm:',12],[':icon-github:',12],[':icon-lock:',12],[':icon-lock-small:',12]\n    ] },\n    accented1: { y: 39, xSpacing: 1, height: 13, oy: -2, chars: [\n        ['\u00E1',5], ['\u00C1',5], ['\u00E0',5], ['\u00C0',5], ['\u00E2',5], ['\u00C2',5], ['\u00E4',5], ['\u00C4',5], ['\u00E3',5], ['\u00C3',5], ['\u00E5',5], ['\u00C5',5],\n        ['\u00E6',7], ['\u00C6',7], ['\u00E7',4], ['\u00C7',5], ['\u00E9',4], ['\u00C9',4], ['\u00E8',4], ['\u00C8',4], ['\u00EA',4], ['\u00CA',4], ['\u00EB',4], ['\u00CB',4],\n        ['\u00ED',2], ['\u00CD',3], ['\u00EC',2], ['\u00CC',3], ['\u00EE',3], ['\u00CE',3], ['\u00EF',3], ['\u00CF',3]\n    ] },\n    accented2: { y: 52, xSpacing: 1, height: 10, oy: -2, chars: [\n        ['\u00F1',4], ['\u00D1',5], ['\u00F3',4], ['\u00D3',5], ['\u00F2',4], ['\u00D2',5], ['\u00F4',4], ['\u00D4',5], ['\u00F6',4], ['\u00D6',5],\n        ['\u00F5',4], ['\u00D5',5], ['\u00F8',4], ['\u00D8',5], ['\u0153',7], ['\u0152',8], ['\u00DF',5], ['\u00FA',4], ['\u00DA',5], ['\u00F9',4],\n        ['\u00D9',5], ['\u00FB',4], ['\u00DB',5], ['\u00FC',4], ['\u00DC',5]\n    ] }\n};\n\nconst fontMap: Record<string, CharInfo> = {};\n\nfor(const csKey in charSets) { \n    if(!charSets.hasOwnProperty(csKey)) continue;\n    const charSet = charSets[csKey];\n    let rx = 0;\n    for(let c = 0; c < charSet.chars.length; c++) {\n        const char = charSet.chars[c][0];\n        const width = charSet.chars[c][1] + (charSet.xSpacing || 0);\n        fontMap[char] = { \n            x: rx, \n            y: charSet.y, \n            w: width, \n            h: charSet.height, \n            char: char, \n            oy: charSet.oy \n        };\n        rx += width;\n    }\n}\n\nconst padding = { x: 4, y: 3 };\nconst vertOffset = 1;\nlet image: HTMLImageElement | HTMLCanvasElement;\n\nexport const TextBlotter = {\n    loadImage: function(img: HTMLImageElement | HTMLCanvasElement): void { \n        image = img; \n    },\n    blot: function(options: BlotOptions): HTMLCanvasElement {\n        const x = options.x || 0;\n        const y = options.y || 0;\n        const metrics = options.metrics || this.calculateMetrics(options);\n        const lineStart = options.lineStart ? options.lineStart : 0;\n        const lineCount = options.lineCount ? Math.min(metrics.lines.length, options.lineCount) \n            : metrics.lines.length;\n        const canvas = options.canvas || new BetterCanvas(\n                padding.x * 2 + x + metrics.w - 1,\n                padding.y * 2 + y + lineCount * 10\n            );\n        if(options.bg) canvas.fill(options.bg);\n        let charCount = 0;\n        for(let l = lineStart; l < Math.min(metrics.lines.length, lineStart + lineCount); l++) {\n            let maxChars = metrics.lines[l].chars.length;\n            if(options.maxChars) maxChars = Math.min(maxChars, options.maxChars - charCount);\n            for(let c = 0; c < maxChars; c++) {\n                const char = metrics.lines[l].chars[c];\n                if(char.char.char == ' ') continue;\n                canvas.drawImage(image, char.char.x, char.char.y, char.w, char.char.h,\n                    padding.x + x + char.x, padding.y + y + (l - lineStart) * 10 + (char.oy || 0) + vertOffset, \n                    char.w, char.char.h);\n            }\n            charCount += metrics.lines[l].chars.length;\n        }\n        return canvas.canvas;\n    },\n    transition: function(options: TransitionOptions): HTMLCanvasElement {\n        const metrics = options.metrics || (options.text ? this.calculateMetrics(options as BlotOptions) : { lines: [], text: '', w: 0 });\n        const canvas = options.canvas || new BetterCanvas(\n                metrics.w + padding.x * 2, \n                (options.lineCount || metrics.lines.length) * 10 + padding.y * 2\n            );\n        const fillWidth = Math.max(2, Math.max(0, options.progress - 0.25) / 0.75 * canvas.canvas.width);\n        const fillHeight = Math.min(1, options.progress * 4) * canvas.canvas.height * -1;\n        canvas.fillRect(options.bg, (canvas.canvas.width - fillWidth) / 2, canvas.canvas.height, \n            fillWidth, fillHeight);\n        return canvas.canvas;\n    },\n    calculateMetrics: function(options: BlotOptions): TextMetrics {\n        // TODO: Normalize line lengths so there are no single-word remainders\n        const text = options.text;\n        const lines: LineInfo[] = [];\n        const words = text.split(' ');\n        const space = fontMap[' '];\n        let lineWidth = 0;\n        let lineChars: CharMap[] = [];\n        let maxLineWidth = 0;\n        \n        for(let w = 0; w < words.length; w++) {\n            const word = words[w];\n            if(word == '') continue; // Skip empty words\n            let wordWidth = 0;\n            let wordChars: CharMap[] = [];\n            \n            if(lineChars.length > 0) { // Add space before word unless starting a line\n                wordChars.push({ x: lineWidth, char: space, w: space.w });\n                wordWidth += space.w;\n            }\n            if(word.length > 1 && fontMap[word]) { // Icon codes\n                wordChars.push({ \n                    x: lineWidth + wordWidth, char: fontMap[word], w: fontMap[word].w, oy: -2 \n                });\n                wordWidth += fontMap[word].w;\n            } else {\n                for(let a = 0; a < word.length; a++) {\n                    const ltr = fontMap[word[a]] || space;\n                    wordChars.push({ \n                        x: lineWidth + wordWidth, char: ltr, w: ltr.w, oy: ltr.oy \n                    });\n                    wordWidth += ltr.w;\n                }\n            }\n            if(options.maxWidth && lineWidth + wordWidth > options.maxWidth) {\n                if(wordWidth > options.maxWidth) { // Word is longer than maxWidth, won't fit any line\n                    if(lineWidth > 0) {\n                        lines.push({ w: lineWidth, chars: lineChars });\n                        maxLineWidth = Math.max(lineWidth, maxLineWidth);\n                        lineWidth = 0; \n                        lineChars = [];\n                    }\n                    wordChars = [];\n                    wordWidth = 0;\n                    for(let b = 0; b < word.length; b++) {\n                        const ltrB = fontMap[word[b]] || space;\n                        if(lineWidth + wordWidth + ltrB.w < options.maxWidth) {\n                            wordChars.push({ \n                                x: lineWidth + wordWidth, char: ltrB, w: ltrB.w, oy: ltrB.oy \n                            });\n                            wordWidth += ltrB.w;\n                        } else {\n                            const trimWidth = (lineWidth + wordWidth + ltrB.w) - options.maxWidth;\n                            wordChars.push({ \n                                x: lineWidth + wordWidth, char: ltrB, w: ltrB.w - trimWidth, oy: ltrB.oy \n                            });\n                            wordWidth += ltrB.w - trimWidth;\n                            break;\n                        }\n                    }\n                    lineWidth += wordWidth;\n                    lineChars = lineChars.concat(wordChars);\n                } else { // Word can be pushed to next line\n                    w--;\n                }\n                lines.push({ w: lineWidth, chars: lineChars });\n                maxLineWidth = Math.max(lineWidth, maxLineWidth);\n                lineWidth = 0; \n                lineChars = [];\n            } else { // Word fits on line\n                lineWidth += wordWidth;\n                lineChars = lineChars.concat(wordChars);\n                if(w == words.length - 1) {\n                    lines.push({ w: lineWidth, chars: lineChars });\n                    maxLineWidth = Math.max(lineWidth, maxLineWidth);\n                }\n            }\n        }\n        return { lines: lines, text: text, w: maxLineWidth };\n    },\n    fontMap: fontMap\n};", "'use strict';\n\nimport { gameLogger } from '../../gameLogger.js';\nimport Entity from '../engine/entity.js';\nimport { TextBlotter } from './textblotter.js';\n\nconst TEXTBOX_MAX_WIDTH = 96;\nconst TEXTBOX_LINES_PER_PAGE = 4;\nconst TEXTBOX_SCROLL_SPEEDS: Array<[number, number]> = [ [0, 3], [75, 2], [150, 1] ];\nconst TEXTBOX_PAGE_DELAY = 5;\nconst TEXTBOX_FINAL_DELAY = 60;\nconst TEXTBOX_OPEN_TIME = 10;\nconst TEXTBOX_CLOSE_TIME = 8;\nconst TEXTBOX_BG_COLOR = 'rgba(0, 0, 0, 0.7)';\n\ninterface TextBoxParent {\n    preciseScreen: { x: number; y: number };\n    pixelSize: { x: number; y: number };\n    username?: string;\n}\n\ninterface TextBoxSprite {\n    keepOnScreen: boolean;\n    screen: { x: number; y: number };\n    parent: TextBoxParent;\n    stay: boolean;\n    metrics: { x: number; y: number; w: number; h: number };\n    image?: HTMLCanvasElement;\n    hidden?: boolean;\n}\n\nfunction cleanString(text: string): string {\n    if(!text) return text;\n    for(let i = 0; i < text.length; i++) {\n        if(!TextBlotter.fontMap[text[i]]) {\n            const charArray = text.split('');\n            charArray.splice(i, 1);\n            text = charArray.join('');\n            i--;\n        }\n    }\n    return text;\n}\n\nfunction calcScrollSpeed(text: string): number {\n    let speed = 1;\n    for(let i = 0; i < TEXTBOX_SCROLL_SPEEDS.length; i++) {\n        if(text.length >= TEXTBOX_SCROLL_SPEEDS[i][0]) speed = TEXTBOX_SCROLL_SPEEDS[i][1];\n        else if(text.length < TEXTBOX_SCROLL_SPEEDS[i][0]) break;\n    }\n    return speed;\n}\n\nexport default class TextBox extends Entity {\n    parent: TextBoxParent;\n    text: string;\n    screen: { x: number; y: number };\n    sprite: TextBoxSprite;\n    canvas?: HTMLCanvasElement;\n    textMetrics?: any;\n\n    constructor(parent: TextBoxParent, text: string, stay: boolean) {\n        super();\n        this.parent = parent;\n        this.text = text;\n        this.screen = { x: 0, y: 0 };\n        this.sprite = { \n            keepOnScreen: true,\n            screen: this.screen, \n            parent: this.parent, \n            stay: stay, \n            metrics: { x: 0, y: 0, w: 0, h: 0 }\n        };\n    }\n\n    updateScreen(): void {\n        if(!this.canvas) return;\n        \n        // Check if parent still exists and has valid preciseScreen\n        if (!this.parent || !this.parent.preciseScreen) {\n            gameLogger.warn('TextBox updateScreen: Parent or preciseScreen missing', {\n                hasParent: !!this.parent,\n                hasPreciseScreen: this.parent && !!this.parent.preciseScreen,\n                textboxText: this.text\n            });\n            // Use fallback coordinates and mark for removal\n            this.screen.x = 0;\n            this.screen.y = 0;\n            if (this.sprite) {\n                this.sprite.screen = this.screen;\n                this.sprite.hidden = true;\n            }\n            // Remove this TextBox as it's orphaned\n            this.remove();\n            return;\n        }\n        \n        // Validate parent coordinates to prevent NaN propagation\n        const parentX = isFinite(this.parent.preciseScreen.x) ? this.parent.preciseScreen.x : 0;\n        const parentY = isFinite(this.parent.preciseScreen.y) ? this.parent.preciseScreen.y : 0;\n        \n        if (parentX !== this.parent.preciseScreen.x || parentY !== this.parent.preciseScreen.y) {\n            gameLogger.warn('TextBox updateScreen: NaN detected in parent preciseScreen', {\n                originalX: this.parent.preciseScreen.x,\n                originalY: this.parent.preciseScreen.y,\n                fallbackX: parentX,\n                fallbackY: parentY,\n                parentType: this.parent.constructor?.name || 'unknown'\n            });\n        }\n        \n        this.screen.x = parentX - this.canvas.width/2 + this.parent.pixelSize.x;\n        this.screen.y = parentY - this.canvas.height + 2;\n        \n        // Ensure sprite screen is synchronized\n        if (this.sprite) {\n            this.sprite.screen = this.screen;\n        }\n    }\n\n    updateSprite(): void {\n        this.sprite.image = this.canvas;\n        if (this.sprite.image) {\n            this.sprite.metrics.w = this.sprite.image.width;\n            this.sprite.metrics.h = this.sprite.image.height;\n        }\n    }\n\n    blotText(options?: any): void {\n        if(!options) options = {};\n        options.bg = options.bg || TEXTBOX_BG_COLOR;\n        options.text = options.text || this.text;\n        if(!options.text) return;\n        this.canvas = TextBlotter.blot(options);\n        this.updateScreen();\n        this.updateSprite();\n    }\n\n    scrollMessage(cb: () => void): void {\n        const self = this;\n        function complete() {\n            self.remove();\n            cb();\n        }\n        \n        // Validate parent before starting animation\n        if (!this.parent || !this.parent.preciseScreen) {\n            gameLogger.warn('TextBox scrollMessage: Parent invalid at start');\n            complete();\n            return;\n        }\n        this.textMetrics = TextBlotter.calculateMetrics({ text: this.text, maxWidth: TEXTBOX_MAX_WIDTH });\n        if(this.text.trim() === '' || this.textMetrics.lines.length === 0 \n            || this.textMetrics.lines[0].chars.length === 0) { // No message to show\n            complete();\n            return;\n        }\n        const scrollSpeed = calcScrollSpeed(this.text);\n        let lineNumber = 0;\n        let lineChar = 0;\n        let lineChars = self.textMetrics.lines[lineNumber].chars.length;\n        for(let nl = 1; nl < TEXTBOX_LINES_PER_PAGE; nl++) {\n            const nextLine = self.textMetrics.lines[lineNumber + nl];\n            if(nextLine) lineChars += nextLine.chars.length; else break;\n        }\n        const addLetter = function(): void {\n            // Check if parent is still valid before continuing animation\n            if (!self.parent || !self.parent.preciseScreen) {\n                gameLogger.warn('TextBox scrollMessage: Parent became invalid during animation');\n                complete();\n                return;\n            }\n            \n            lineChar++;\n            self.blotText({ \n                text: self.text, metrics: self.textMetrics, maxChars: lineChar,\n                lineStart: lineNumber, lineCount: TEXTBOX_LINES_PER_PAGE\n            });\n            if(lineChar === lineChars) { // Line set finished?\n                lineNumber += TEXTBOX_LINES_PER_PAGE;\n                if(lineNumber >= self.textMetrics.lines.length) { // Last line complete?\n                    self.tickDelay(function() {\n                        self.tickRepeat(function(progress: any) {\n                            // Check if parent is still valid before updating\n                            if (!self.parent || !self.parent.preciseScreen) {\n                                gameLogger.warn('TextBox scrollMessage: Parent became invalid during closing animation');\n                                complete();\n                                return;\n                            }\n                            \n                            self.canvas = TextBlotter.transition({\n                                bg: TEXTBOX_BG_COLOR, metrics: self.textMetrics, progress: 1 - progress.percent, \n                                lineCount : Math.min(self.textMetrics.lines.length, TEXTBOX_LINES_PER_PAGE)\n                            });\n                            self.updateScreen();\n                            self.updateSprite();\n                        }, TEXTBOX_CLOSE_TIME, complete);\n                    }, scrollSpeed * TEXTBOX_FINAL_DELAY);\n                } else { // Still more lines\n                    lineChar = 0;\n                    lineChars = self.textMetrics.lines[lineNumber].chars.length;\n                    for(let nl = 1; nl < TEXTBOX_LINES_PER_PAGE; nl++) {\n                        const nextLine = self.textMetrics.lines[lineNumber + nl];\n                        if(nextLine) lineChars += nextLine.chars.length; else break;\n                    }\n                    self.tickDelay(addLetter, scrollSpeed * TEXTBOX_PAGE_DELAY); // Begin next line\n                }\n            } else { // Line not finished, continue\n                self.tickDelay(addLetter, scrollSpeed);\n            }\n        };\n        this.tickRepeat(function(progress: any) {\n            // Check if parent is still valid before updating\n            if (!self.parent || !self.parent.preciseScreen) {\n                gameLogger.warn('TextBox scrollMessage: Parent became invalid during opening animation');\n                complete();\n                return;\n            }\n            \n            self.canvas = TextBlotter.transition({\n                bg: TEXTBOX_BG_COLOR, metrics: self.textMetrics, progress: progress.percent,\n                lineCount : Math.min(self.textMetrics.lines.length, TEXTBOX_LINES_PER_PAGE)\n            });\n            self.updateScreen();\n            self.updateSprite();\n        }, TEXTBOX_OPEN_TIME, function() {\n            self.tickDelay(addLetter, scrollSpeed);\n        })\n    }\n\n    remove(): void {\n        // Cancel any ongoing scroll animations by clearing scheduled tasks\n        if (this.game && this.game.schedule) {\n            for (let i = this.game.schedule.length - 1; i >= 0; i--) {\n                const task = this.game.schedule[i];\n                if (task.entity === this) {\n                    task.type = 'deleted';\n                }\n            }\n        }\n        \n        // Call parent remove method\n        super.remove();\n    }\n}", "'use strict';\n\nimport Entity from './entity.js';\n\ninterface WorldObjectOptions {\n    position: {\n        x: number;\n        y: number;\n        z: number;\n    };\n    height: number;\n    pixelSize: {\n        x: number;\n        y: number;\n        z: number;\n    };\n}\n\ninterface Position {\n    x: number;\n    y: number;\n    z: number;\n    fakeZ: number;\n}\n\ninterface PixelSize {\n    x: number;\n    y: number;\n    z: number;\n}\n\ninterface Screen {\n    x: number;\n    y: number;\n}\n\ninterface WorldObjectGame {\n    entities: Entity[];\n    world: {\n        addToWorld(entity: Entity): void;\n        removeFromWorld(entity: Entity): void;\n        moveObject(obj: WorldObject, x: number, y: number, z: number): void;\n        objectAtXYZ(x: number, y: number, z: number): WorldObject | null;\n    };\n    renderer: {\n        addToZBuffer(sprite: any, depth?: number): void;\n        removeFromZBuffer(sprite: any, depth?: number): void;\n        overlay: any[];\n        updateZBuffer(oldDepth: number, sprite: any, newDepth: number): void;\n    };\n    schedule: Array<{\n        type: string;\n        tick?: number;\n        start?: number;\n        count?: number;\n        cb: Function;\n        afterCB?: Function;\n        entity?: Entity;\n    }>;\n    ticks: number;\n}\n\nexport default class WorldObject extends Entity {\n    declare position: Position;\n    height: number;\n    zDepth: number;\n    pixelSize: PixelSize;\n    screen: Screen;\n    declare game: WorldObjectGame;\n\n    constructor(options: WorldObjectOptions) {\n        super();\n        this.position = {\n            x: options.position.x,\n            y: options.position.y,\n            z: options.position.z,\n            fakeZ: 0\n        };\n        this.height = options.height;\n        this.zDepth = this.calcZDepth();\n        this.pixelSize = {\n            x: options.pixelSize.x,\n            y: options.pixelSize.y,\n            z: options.pixelSize.z\n        };\n        this.screen = { x: 0, y: 0 };\n        this.updateScreen();\n        this.sprite.screen = this.screen;\n        this.sprite.position = this.position;\n    }\n\n    move(x: number, y: number, z: number): void {\n        const newX = this.position.x + x;\n        const newY = this.position.y + y;\n        const newZ = this.position.z + z;\n        this.game.world.moveObject(this, newX, newY, newZ);\n        this.updateScreen();\n        const newZDepth = this.calcZDepth();\n        if(newZDepth != this.zDepth) {\n            this.game.renderer.updateZBuffer(this.zDepth, this.sprite, newZDepth);\n            this.zDepth = newZDepth;\n        }\n    }\n\n    underneath(): WorldObject | null {\n        return this.game.world.objectAtXYZ(this.position.x, this.position.y, this.position.z + this.height);\n    }\n\n    calcZDepth(): number {\n        return this.position.x + this.position.y;\n    }\n\n    updateScreen(): void {\n        this.screen.x = (this.position.x - this.position.y) * 16 - this.pixelSize.x;\n        this.screen.y = (this.position.x + this.position.y) * 8 - (this.position.z + this.height) * 16;\n    }\n}", "'use strict';\n\ninterface Point {\n    x: number;\n    y: number;\n}\n\ninterface PathPoint extends Point {\n    z: number;\n}\n\ninterface PathNode extends Point {\n    grid: string;\n    g: number;\n    h: number;\n    f: number;\n    parent?: string;\n}\n\ninterface PathfindingOptions {\n    start: Point;\n    end: Point;\n}\n\nlet map: Record<string, number>;\n\nconst calcH = (a: Point, b: Point): number => {\n    const x = Math.abs(a.x - b.x);\n    const y = Math.abs(a.y - b.y);\n    if (x > y) return 8 * y + 5 * x;\n    else return 8 * x + 5 * y;\n};\n\nconst getBest = (list: Record<string, PathNode>): PathNode | undefined => {\n    let best: PathNode | undefined;\n    for (const key in list) {\n        if (!list.hasOwnProperty(key)) continue;\n        if (!best || best.f > list[key].f) best = list[key];\n    }\n    return best;\n};\n\nconst constructPath = (start: Point, current: PathNode, closed: Record<string, PathNode>): PathPoint[] => {\n    const path: PathPoint[] = [];\n    let cur = current;\n    while (true) {\n        if (cur.x == start.x && cur.y == start.y) break;\n        path.push({ x: cur.x, y: cur.y, z: map[cur.x + ':' + cur.y] });\n        cur = closed[cur.parent!];\n    }\n    return path.reverse();\n};\n\nexport default {\n    loadMap: function(m: Record<string, number>): void { \n        map = m; \n    },\n    \n    findPath: function(options: PathfindingOptions): PathPoint[] {\n        const start = options.start;\n        const end = options.end;\n        \n        if (start.x == end.x && start.y == end.y || !(map[end.x + ':' + end.y] >= 0)) {\n            return [];\n        }\n        \n        const startH = calcH(end, start);\n        let current: PathNode = { \n            x: start.x, \n            y: start.y, \n            grid: start.x + ':' + start.y, \n            g: 0, \n            h: startH, \n            f: startH \n        };\n        \n        let startIsCurrent = true;\n        let openCount = 0;\n        const open: Record<string, PathNode> = {};\n        const closed: Record<string, PathNode> = {};\n        \n        // Add starting grid to open list\n        open[current.grid] = current;\n        openCount++;\n        \n        while (openCount > 0) {\n            closed[current.grid] = current;\n            delete open[current.grid];\n            openCount--;\n            \n            // Check if ending reached\n            if (current.x == end.x && current.y == end.y) {\n                return constructPath(start, current, closed);\n            }\n            \n            // Check neighbors\n            for (let xDir = -1; xDir <= 1; xDir++) {\n                for (let yDir = -1; yDir <= 1; yDir++) {\n                    if (xDir == 0 && yDir == 0) continue;\n                    \n                    const neighborX = current.x + xDir;\n                    const neighborY = current.y + yDir;\n                    const neighborGrid = neighborX + ':' + neighborY;\n                    \n                    // Skip if neighbor is blocked or closed\n                    if (!(map[neighborGrid] >= 0) || closed[neighborGrid]) continue;\n                    \n                    const moveCost = (xDir == 0 || yDir == 0) ? 5 : 8;\n                    const neighborG = current.g + moveCost;\n                    \n                    if (open[neighborGrid]) { // Neighbor already in open list\n                        const existing = open[neighborGrid];\n                        if (neighborG < existing.g) { // This path is better\n                            existing.g = neighborG;\n                            existing.f = existing.g + existing.h;\n                            existing.parent = current.grid;\n                        }\n                    } else { // Neighbor is a new square\n                        const neighbor: PathNode = {\n                            x: neighborX,\n                            y: neighborY,\n                            grid: neighborGrid,\n                            g: neighborG,\n                            h: calcH(end, { x: neighborX, y: neighborY }),\n                            f: 0,\n                            parent: current.grid\n                        };\n                        neighbor.f = neighbor.g + neighbor.h;\n                        open[neighbor.grid] = neighbor;\n                        openCount++;\n                    }\n                }\n            }\n            \n            const nextCurrent = getBest(open);\n            if (!nextCurrent) break;\n            current = nextCurrent;\n            startIsCurrent = false;\n        }\n        \n        return [];\n    }\n};", "'use strict';\n\nimport { gameLogger } from '../../../gameLogger.js';\nimport { geometry } from '../../common/geometry.js';\nimport { util } from '../../common/util.js';\nimport Pathfinder from '../pathfinder.js';\n\ninterface Position {\n    x: number;\n    y: number;\n    z?: number;\n}\n\nexport default class GoTo {\n    actor: any;\n    target: any;\n    attempt: number;\n    boundResetAttempt: () => void;\n    boundStartGoTo: () => void;\n    destination?: Position;\n    path?: Position[];\n\n    constructor(actor: any, target: any) {\n        this.actor = actor;\n        this.target = target;\n        this.attempt = util.randomIntRange(1, 4);\n        this.boundResetAttempt = this.resetAttempt.bind(this);\n        this.target.on('movecomplete', this.boundResetAttempt); // Reset adjacent attempts if target moves\n        this.boundStartGoTo = this.startGoTo.bind(this);\n        \n        gameLogger.info('GoTo behavior created', {\n            actor: this.actor.username,\n            target: this.target.username,\n            attempt: this.attempt,\n            closestGridsLength: geometry.closestGrids?.length || 0\n        });\n        \n        if (this.actor.destination) {\n            this.actor.once('movecomplete', this.boundStartGoTo);\n        } else {\n            this.startGoTo();\n        }\n    }\n\n    startGoTo(): void {\n        if (!this.actor || this.actor.presence != 'online' || this.actor.underneath()) return;\n        \n        // Add a small delay between movements to prevent visual \"skipping\"\n        this.actor.tickDelay(() => {\n            this.performMove();\n        }, 2); // 2 tick delay for smoother transitions\n    }\n    \n    performMove(): void {\n        if (!this.actor || this.actor.presence != 'online' || this.actor.underneath()) return;\n        \n        // Defensive check for closestGrids array bounds\n        if (!geometry.closestGrids || this.attempt >= geometry.closestGrids.length) {\n            gameLogger.error('GoTo: Invalid attempt index for closestGrids', {\n                attempt: this.attempt,\n                closestGridsLength: geometry.closestGrids?.length || 0,\n                actor: this.actor.username\n            });\n            this.actor.stopGoTo(this);\n            return;\n        }\n        \n        const adjacent = geometry.closestGrids[this.attempt]; // Pick grid next to target\n        const targetDistance = geometry.getDistance(this.actor.position, this.target.position);\n        \n        if (targetDistance <= Math.abs(adjacent[0]) + Math.abs(adjacent[1])) {\n            this.actor.stopGoTo(this);\n            return;\n        }\n        \n        this.destination = {\n            x: this.target.position.x + adjacent[0], \n            y: this.target.position.y + adjacent[1]\n        };\n        \n        const destDelta = { \n            x: this.destination.x - this.actor.position.x, \n            y: this.destination.y - this.actor.position.y \n        };\n        \n        // Calculate movement direction - ensure only cardinal movement\n        var moveDir = { x: 0, y: 0 };\n        const absX = Math.abs(destDelta.x);\n        const absY = Math.abs(destDelta.y);\n        \n        if (absX > absY) {\n            // X-axis movement is dominant\n            moveDir.x = Math.max(-1, Math.min(1, destDelta.x));\n            moveDir.y = 0;\n        } else if (absY > absX) {\n            // Y-axis movement is dominant\n            moveDir.x = 0;\n            moveDir.y = Math.max(-1, Math.min(1, destDelta.y));\n        } else if (absX === absY && absX > 0) {\n            // Equal magnitude - prefer X-axis for consistency\n            moveDir.x = Math.max(-1, Math.min(1, destDelta.x));\n            moveDir.y = 0;\n        }\n        // If both deltas are 0, moveDir remains {x: 0, y: 0}\n        var moveAttempt = this.actor.tryMove(moveDir.x,moveDir.y);\n        if(moveAttempt) { // Try to move in the general direction of our target\n            this.actor.destination = moveAttempt;\n            this.actor.startMove();\n            this.actor.once('movecomplete', this.boundStartGoTo);\n        } else { // If moving toward target is blocked, find a path\n            this.path = Pathfinder.findPath({ start: this.actor.position, end: this.destination });\n            if(this.path && this.path.length > 0 && this.path[0]) { // If there is a path\n                const pathDelta = {\n                    x: this.path[0].x - this.actor.position.x,\n                    y: this.path[0].y - this.actor.position.y\n                };\n                \n                // Ensure pathfinder result is cardinal movement only\n                let finalDestination = { x: this.path[0].x, y: this.path[0].y, z: this.path[0].z };\n                if (Math.abs(pathDelta.x) > 0 && Math.abs(pathDelta.y) > 0) {\n                    // Break diagonal into cardinal movement - prefer the larger magnitude\n                    if (Math.abs(pathDelta.x) >= Math.abs(pathDelta.y)) {\n                        // Move in X direction first\n                        finalDestination = {\n                            x: this.actor.position.x + Math.sign(pathDelta.x),\n                            y: this.actor.position.y,\n                            z: this.path[0].z\n                        };\n                    } else {\n                        // Move in Y direction first\n                        finalDestination = {\n                            x: this.actor.position.x,\n                            y: this.actor.position.y + Math.sign(pathDelta.y),\n                            z: this.path[0].z\n                        };\n                    }\n                }\n                \n                //this.attempt = util.randomIntRange(1,4); // Reset adjacent attempts\n                this.actor.destination = finalDestination;\n                this.actor.startMove();\n                this.actor.once('movecomplete', this.boundStartGoTo);\n            } else { // If no path, try next closest tile\n                this.attempt++;\n                if (this.attempt > 8) { // Prevent infinite recursion\n                    gameLogger.info('GoTo behavior giving up after maximum attempts', {\n                        actor: this.actor.username,\n                        attempts: this.attempt,\n                        target: this.target\n                    });\n                    this.actor.stopGoTo(this);\n                    return;\n                }\n                this.startGoTo();\n            }\n        }\n    }\n\n    resetAttempt(): void {\n        this.attempt = util.randomIntRange(1, 4);\n    }\n\n    detach(): void { // Detach behavior from actor\n        if (this.actor) this.actor.removeListener('movecomplete', this.boundStartGoTo);\n        if (this.target) this.target.removeListener('movecomplete', this.boundResetAttempt);\n        delete this.actor;\n        delete this.target;\n    }\n}\n\n// Export to window for E2E testing\nif (typeof window !== 'undefined') {\n    (window as any).GoTo = GoTo;\n}", "'use strict';\n\nimport { gameLogger } from '../../../gameLogger.js';\nimport { geometry } from '../../common/geometry.js';\nimport { util } from '../../common/util.js';\n\nexport default class Wander {\n    actor: any;\n    state: string = 'idle';\n    impulseCompleteBound: () => void;\n    impulseInterval: number = 300;\n    impulseBound: () => void;\n\n    constructor(actor: any) {\n        this.actor = actor;\n        this.impulseCompleteBound = this.impulseComplete.bind(this);\n        this.impulseBound = this.impulse.bind(this);\n        this.wait();\n    }\n\n    wait(): void {\n        if (!this.actor) return;\n        this.actor.tickDelay(this.impulseBound, 20 + Math.round(Math.random() * this.impulseInterval));\n    }\n\n    impulse(): void {\n        if (!this.actor || this.actor.presence != 'online') return;\n        if (this.actor.destination) { // Busy\n            this.wait();\n        } else {\n            const direction = util.pickInObject(geometry.DIRECTIONS);\n            //direction = util.pickInArray(['east','south']);\n            const moveXY = geometry.DIRECTIONS[direction];\n            const canMove = this.actor.tryMove(moveXY.x, moveXY.y);\n            if (canMove) {\n                // Validate destination coordinates\n                if (isNaN(canMove.x) || isNaN(canMove.y) || isNaN(canMove.z)) {\n                    gameLogger.error('Wander behavior: tryMove returned NaN destination', {\n                        actor: this.actor.username,\n                        canMove: canMove,\n                        direction: direction,\n                        moveXY: moveXY,\n                        currentPosition: this.actor.position\n                    });\n                    this.wait();\n                    return;\n                }\n                this.actor.destination = canMove;\n                this.actor.startMove();\n                this.actor.once('movecomplete', this.impulseCompleteBound);\n            } else {\n                this.wait();\n            }\n        }\n    }\n\n    impulseComplete(): void {\n        this.wait();\n    }\n\n    detach(): void { // Detach behavior from actor\n        this.actor.removeListener('movecomplete', this.impulseCompleteBound);\n        this.actor.removeFromSchedule(this.impulseBound);\n        delete this.actor;\n    }\n}", "'use strict';\n\nimport WorldObject from '../engine/worldobject.js';\n\ninterface PlaceholderOptions {\n    x: number;\n    y: number;\n    z: number;\n}\n\ninterface WorldObjectOptions {\n    position: { x: number; y: number; z: number };\n    pixelSize: { x: number; y: number; z: number };\n    height: number;\n}\n\nexport default class Placeholder extends WorldObject {\n    parent: any;\n    invisible: boolean = true;\n    unWalkable: boolean = true;\n\n    constructor(parent: any, options: PlaceholderOptions) {\n        const worldObjectOptions: WorldObjectOptions = {\n            position: { x: options.x, y: options.y, z: options.z },\n            pixelSize: { x: 0, y: 0, z: 0 },\n            height: 0.5\n        };\n        super(worldObjectOptions);\n        \n        this.parent = parent;\n        this.addToGame(this.parent.game);\n    }\n}", "'use strict';\n\ninterface SpriteMetrics {\n    x: number;\n    y: number;\n    w: number;\n    h: number;\n    ox: number;\n    oy: number;\n}\n\ninterface AnimatedSpriteMetrics extends SpriteMetrics {\n    animation?: {\n        frames: number;\n        zStartFrame: number;\n    };\n}\n\ninterface ActorSpriteMap {\n    north: SpriteMetrics | AnimatedSpriteMetrics;\n    south: SpriteMetrics | AnimatedSpriteMetrics;\n    east: SpriteMetrics | AnimatedSpriteMetrics;\n    west: SpriteMetrics | AnimatedSpriteMetrics;\n    animation?: {\n        frames: number;\n        zStartFrame: number;\n    };\n}\n\ninterface SheetMap {\n    [spriteName: string]: {\n        [state: string]: ActorSpriteMap;\n    };\n}\n\nconst map: SheetMap = {\n    actor: {\n        online: {\n            north: { x: 28, y: 0, w: 14, h: 14, ox: 0, oy: 5 },\n            south: { x: 0, y: 0, w: 14, h: 14, ox: 0, oy: 5 },\n            east: { x: 14, y: 0, w: 14, h: 14, ox: 0, oy: 5 },\n            west: { x: 28, y: 0, w: 14, h: 14, ox: 0, oy: 5 }\n        },\n        idle: {\n            north: { x: 56, y: 0, w: 14, h: 14, ox: 0, oy: 5 },\n            south: { x: 42, y: 0, w: 14, h: 14, ox: 0, oy: 5 },\n            east: { x: 56, y: 0, w: 14, h: 14, ox: 0, oy: 5 },\n            west: { x: 42, y: 0, w: 14, h: 14, ox: 0, oy: 5 }\n        },\n        offline: {\n            north: { x: 84, y: 0, w: 14, h: 14, ox: 0, oy: 5 },\n            south: { x: 70, y: 0, w: 14, h: 14, ox: 0, oy: 5 },\n            east: { x: 84, y: 0, w: 14, h: 14, ox: 0, oy: 5 },\n            west: { x: 70, y: 0, w: 14, h: 14, ox: 0, oy: 5 }\n        },\n        hopping: {\n            animation: { frames: 13, zStartFrame: 3 },\n            north: { x: 0, y: 83, w: 35, h: 27, ox: -2, oy: -6 },\n            south: { x: 0, y: 137, w: 35, h: 27, ox: -19, oy: 3 },\n            east: { x: 0, y: 56, w: 35, h: 27, ox: -2, oy: 3 },\n            west: { x: 0, y: 110, w: 35, h: 27, ox: -19, oy: -6 }\n        }\n    }\n};\n\nexport default class Sheet {\n    map: any;\n\n    constructor(spriteName: string) {\n        this.map = JSON.parse(JSON.stringify(map[spriteName]));\n    }\n}", "'use strict';\n\nimport { gameLogger } from '../../gameLogger.js';\nimport { geometry } from '../common/geometry.js';\nimport TextBox from '../common/textbox.js';\nimport { util } from '../common/util.js';\nimport WorldObject from '../engine/worldobject.js';\nimport GoTo from './behaviors/goto.js';\nimport Wander from './behaviors/wander.js';\nimport Placeholder from './placeholder.js';\nimport Sheet from './sheet.js';\n\ninterface ActorOptions {\n    x: number;\n    y: number;\n    z: number;\n    maxListeners?: number;\n    uid: string;\n    username: string;\n    roleColor?: string;\n}\n\ninterface WorldObjectOptions {\n    position: { x: number; y: number; z: number };\n    pixelSize: { x: number; y: number; z: number };\n    height: number;\n}\n\nexport default class Actor extends WorldObject {\n    preciseScreen: any;\n    uid: string;\n    username: string;\n    nametag?: TextBox;\n    sheet: Sheet;\n    presence: string = 'online';\n    talking: boolean = false;\n    destination: any = false;\n    facing: string;\n    behaviors: any[] = [];\n    boundOnMessage: (message: any) => void;\n    roleColor?: string;\n    placeholder?: Placeholder;\n    moveTick?: any;\n    talkBox?: any;\n    talkTimeLeft?: number;\n    frame: number = 0; // Add frame property for animation\n    lastMessage?: { channel?: string; time: number };\n    messageBox?: TextBox;\n    moveStart?: number; // Track when movement started\n    movePlaceholder?: Placeholder; // Placeholder during movement\n    destDelta?: { x: number; y: number; z: number }; // Movement deltas\n    unWalkable?: boolean; // Prevent others from walking on this tile during movement\n\n    constructor(options: ActorOptions) {\n        // Validate input coordinates\n        if (isNaN(options.x) || isNaN(options.y) || isNaN(options.z)) {\n            gameLogger.error('Actor constructor: Invalid coordinates provided', {\n                username: options.username,\n                uid: options.uid,\n                coordinates: { x: options.x, y: options.y, z: options.z }\n            });\n            // Use fallback coordinates\n            options.x = isNaN(options.x) ? 0 : options.x;\n            options.y = isNaN(options.y) ? 0 : options.y;\n            options.z = isNaN(options.z) ? 0 : options.z;\n        }\n        \n        const worldObjectOptions: WorldObjectOptions = {\n            position: { x: options.x, y: options.y, z: options.z },\n            pixelSize: { x: 7, y: 7, z: 8 },\n            height: 0.5\n        };\n        super(worldObjectOptions);\n        \n        this.preciseScreen = this.toScreenPrecise();\n        if (options.maxListeners) this.setMaxListeners(options.maxListeners);\n        this.uid = options.uid;\n        this.username = options.username;\n        this.nametag = new TextBox(this as any, this.username, true);\n        this.nametag.blotText();\n        this.sheet = new Sheet('actor');\n        this.frame = 0; // Initialize frame\n        \n        if (this.sprite) {\n            this.sprite.image = 'actors';\n            // Ensure sprite screen is properly initialized\n            this.sprite.screen = this.screen;\n        }\n        \n        this.facing = util.pickInObject(geometry.DIRECTIONS);\n        this.boundOnMessage = this.onMessage.bind(this);\n        this.roleColor = options.roleColor;\n        \n        this.updateSprite();\n    }\n\n    onUpdate(): void {\n        if (this.talking) this.updateSprite();\n        const game = this.game as any;\n        if (game.mouseOut || (game.mouseOver\n            && (game.mouseOver.zDepth > this.zDepth // Don't override closer objects\n            || game.mouseOver.position.z > this.position.z)) // Don't override higher objects\n        || game.ui.mouseOnElement) return; // Ignore if mouse on UI element\n        \n        const mouse = {\n            x: game.centerMouseX - game.renderer.canvases[0].panning.panned.x,\n            y: game.centerMouseY - game.renderer.canvases[0].panning.panned.y\n        };\n        const metrics = this.sheet.map.online.north;\n        if (mouse.x >= this.preciseScreen.x + metrics.ox\n            && mouse.x < this.preciseScreen.x + metrics.w + metrics.ox\n            && mouse.y >= this.preciseScreen.y + metrics.oy\n            && mouse.y < this.preciseScreen.y + metrics.h + metrics.oy) {\n            game.mouseOver = this;\n            // Show nametag when mouse is over this actor (unless talking)\n            if (this.nametag && !this.talking) {\n                this.nametag.sprite.hidden = false;\n            }\n        } else if (game.mouseOver === this) {\n            game.mouseOver = false;\n            // Hide nametag when mouse leaves this actor (unless talking)\n            if (this.nametag && !this.talking) {\n                this.nametag.sprite.hidden = true;\n            }\n        }\n    }\n\n    addToGame(game: any): void {\n        super.addToGame(game);\n        \n        // Log actor spawning\n        gameLogger.actorSpawned({\n            uid: this.uid,\n            username: this.username,\n            x: this.position.x,\n            y: this.position.y,\n            z: this.position.z,\n            roleColor: this.roleColor,\n            presence: this.presence\n        });\n        \n        // Add role color sheet if needed\n        if (this.roleColor) {\n            game.renderer.addColorSheet({\n                sheet: 'actors', \n                color: this.roleColor, \n                alpha: 0.8,\n                regions: [{ alpha: 0.4, x: 70, y: 0, w: 28, h: 14 }] // Less colorizing for offline sprites\n            });\n        }\n        \n        // Add nametag to game\n        if (this.nametag) {\n            this.nametag.addToGame(game);\n            // Initially hide nametag - it will be shown on mouse hover\n            this.nametag.sprite.hidden = true;\n        }\n        \n        // Set up update listener\n        game.on('update', this.onUpdate.bind(this));\n        \n        // Connect to users message events (moved from users.ts)\n        if (game.users) {\n            game.users.on('message', this.boundOnMessage);\n        }\n        \n        // Initialize default behavior\n        this.behaviors.push(new Wander(this));\n    }\n\n    updatePresence(presence: string): void {\n        this.presence = presence;\n        this.updateSprite();\n        \n        // Remove wandering behavior if going idle/offline\n        if (presence != 'online') {\n            for (let i = this.behaviors.length - 1; i >= 0; i--) {\n                if (this.behaviors[i] instanceof Wander) {\n                    this.behaviors[i].detach();\n                    this.behaviors.splice(i, 1);\n                }\n            }\n            if (this.destination) {\n                // Only cancel movement if no movement is in progress\n                if (this.moveTick) {\n                    gameLogger.info('Actor cancelling movement due to presence change', {\n                        username: this.username,\n                        newPresence: presence\n                    });\n                    this.removeFromSchedule(this.moveTick);\n                    delete this.moveTick;\n                    // Clean up movement state\n                    if (this.movePlaceholder) {\n                        this.movePlaceholder.remove();\n                        delete this.movePlaceholder;\n                    }\n                    this.unWalkable = false;\n                    delete this.moveStart;\n                    delete this.destDelta;\n                }\n                this.destination = false;\n            }\n        } else {\n            // Add wandering behavior if going online\n            let hasWander = false;\n            for (const behavior of this.behaviors) {\n                if (behavior instanceof Wander) {\n                    hasWander = true;\n                    break;\n                }\n            }\n            if (!hasWander) {\n                this.behaviors.push(new Wander(this));\n            }\n        }\n    }\n\n    toScreenPrecise(): any {\n        // Validate position coordinates before calculation\n        if (isNaN(this.position.x) || isNaN(this.position.y) || isNaN(this.position.z)) {\n            gameLogger.error('Actor toScreenPrecise: Position coordinates contain NaN', {\n                actor: this.username,\n                position: this.position,\n                uid: this.uid\n            });\n            // Return fallback coordinates to prevent further NaN propagation\n            return { x: 0, y: 0 };\n        }\n        \n        // Use delta-based interpolation if moving\n        if (this.destination && this.moveStart !== undefined) {\n            const game = this.game as any;\n            if (game && game.ticks !== undefined) {\n                const xDelta = this.destination.x - this.position.x;\n                const yDelta = this.destination.y - this.position.y;\n                const zDelta = this.destination.z - this.position.z;\n                const tick = game.ticks - this.moveStart;\n                const animation = this.sheet.map['hopping'].animation;\n                const totalTicks = 3 * animation.frames;\n                const progress = Math.min(tick / totalTicks, 1);\n                \n                const deltaScreen = {\n                    x: (xDelta - yDelta) * 16 * progress,\n                    y: (xDelta + yDelta) * 8 - zDelta * 16 * progress\n                };\n                \n                return {\n                    x: this.screen.x + deltaScreen.x,\n                    y: this.screen.y + deltaScreen.y\n                };\n            }\n        }\n        \n        // Fallback to standard screen calculation\n        const screen = {\n            x: (this.position.x - this.position.y) * 16 - 8,\n            y: (this.position.x + this.position.y) * 8 - (this.position.z) * 16 - 8\n        };\n        \n        // Validate calculated screen coordinates\n        if (isNaN(screen.x) || isNaN(screen.y)) {\n            gameLogger.error('Actor toScreenPrecise: Calculated screen coordinates are NaN', {\n                actor: this.username,\n                position: this.position,\n                screen: screen,\n                uid: this.uid\n            });\n            // Return fallback coordinates\n            return { x: 0, y: 0 };\n        }\n        \n        return screen;\n    }\n\n    updateSprite(): void {\n        if (!this.sprite) return;\n        \n        let facing = this.facing;\n        let state: string = this.destination ? 'hopping' : this.presence;\n        \n        if (!this.destination && this.talking) {\n            state = 'online';\n            facing = facing === 'north' ? 'east' : facing === 'west' ? 'south' : facing;\n        }\n        \n        // Get base metrics\n        if (!this.sheet.map[state] || !this.sheet.map[state][facing]) {\n            // Handle unknown presence states by mapping them to known states\n            if (!this.sheet.map[state]) {\n                switch (state) {\n                    case 'dnd':\n                    case 'busy':\n                        state = 'idle'; // DND/busy users appear idle\n                        break;\n                    case 'away':\n                    case 'invisible':\n                        state = 'offline'; // Away/invisible users appear offline\n                        break;\n                    default:\n                        state = 'online'; // Default fallback\n                        break;\n                }\n            }\n            \n            if (!this.sheet.map[state] || !this.sheet.map[state][facing]) {\n                gameLogger.error('Actor sprite not found', {\n                    actor: this.username,\n                    state: state,\n                    facing: facing,\n                    availableStates: Object.keys(this.sheet.map),\n                    availableFacingsForState: this.sheet.map[state] ? Object.keys(this.sheet.map[state]) : null\n                });\n                return;\n            }\n        }\n        \n        const baseMetrics = this.sheet.map[state][facing];\n        const metrics = {\n            x: baseMetrics.x,\n            y: baseMetrics.y,\n            w: baseMetrics.w,\n            h: baseMetrics.h,\n            ox: baseMetrics.ox || 0,\n            oy: baseMetrics.oy || 0\n        };\n        \n        // Apply animations\n        if (!this.destination && this.talking) {\n            // Talking animation: animate Y based on game ticks\n            const game = this.game as any;\n            if (game && game.ticks !== undefined) {\n                metrics.y += (Math.floor(game.ticks / 4) % 4) * metrics.h;\n            }\n        } else if (this.destination) {\n            // Moving animation: use frame offset\n            const baseX = metrics.x;\n            const baseY = metrics.y;\n            metrics.x += (this.frame || 0) * metrics.w;\n                        \n            // Z-level animation for hopping\n            const animation = this.sheet.map['hopping'].animation;\n            if (this.frame >= animation.zStartFrame) {\n                const zDiff = this.destination.z - this.position.z;\n                if (zDiff > 0) {\n                    metrics.oy -= Math.min(8, this.frame - animation.zStartFrame);\n                } else if (zDiff < 0) {\n                    metrics.oy += Math.min(8, this.frame - animation.zStartFrame);\n                }\n            }\n        }\n        \n        // Update messageBox screen when talking\n        if (this.talking && this.messageBox) {\n            this.messageBox.updateScreen();\n        }\n        \n        // Apply to sprite\n        this.sprite.metrics = metrics;\n        \n        // Set image with role color support\n        let finalImage: string | string[];\n        if (this.roleColor) {\n            // Ensure colored sprite exists\n            const game = this.game as any;\n            if (game && game.renderer && game.renderer.addColorSheet) {\n                game.renderer.addColorSheet({\n                    color: this.roleColor,\n                    sheet: 'actors',\n                    alpha: 1\n                });\n                finalImage = [this.roleColor, 'actors'];\n                this.sprite.image = finalImage;\n            } else {\n                // Game/renderer not available yet, use base image for now\n                // Will be updated when addToGame is called\n                finalImage = 'actors';\n                this.sprite.image = finalImage;\n            }\n        } else {\n            finalImage = 'actors';\n            this.sprite.image = finalImage;\n        }\n        \n        // Log sprite rendering\n        gameLogger.actorSpriteRendered({\n            uid: this.uid,\n            username: this.username,\n            state: state,\n            facing: facing,\n            frame: this.frame || 0,\n            spriteMetrics: metrics,\n            image: finalImage,\n            presence: this.presence,\n            talking: this.talking,\n            moving: !!this.destination\n        });\n    }\n\n    tryMove(x: number, y: number): any {\n        const game = this.game as any;\n        if (!game.world || !game.world.canWalk) return false;\n        \n        if (this.underneath()) {\n            gameLogger.debug('Actor movement blocked: object on top', { actor: this.username });\n            this.emit('getoffme');\n            return false; // Can't move with object on top\n        }\n        \n        // Validate movement deltas\n        if (isNaN(x) || isNaN(y)) {\n            gameLogger.error('Actor tryMove: Movement deltas contain NaN', {\n                actor: this.username,\n                deltaX: x,\n                deltaY: y,\n                currentPosition: this.position\n            });\n            return false;\n        }\n        \n        // Validate current position before calculating destination\n        if (isNaN(this.position.x) || isNaN(this.position.y)) {\n            gameLogger.error('Actor tryMove: Current position contains NaN', {\n                actor: this.username,\n                position: this.position,\n                movementDeltas: { x, y }\n            });\n            return false;\n        }\n        \n        const destination: any = { x: this.position.x + x, y: this.position.y + y };\n        \n        // Validate calculated destination\n        if (isNaN(destination.x) || isNaN(destination.y)) {\n            gameLogger.error('Actor tryMove: Calculated destination contains NaN', {\n                actor: this.username,\n                destination,\n                currentPosition: this.position,\n                movementDeltas: { x, y }\n            });\n            return false;\n        }\n\n        if (game.world.canWalk(destination.x, destination.y)) {\n            const walkable = game.world.getHeight(destination.x, destination.y);\n            if (walkable >= 0 && Math.abs(this.position.z - walkable) <= 0.5) {\n                return { x: destination.x, y: destination.y, z: walkable };\n            }\n            gameLogger.error('Actor tryMove: Destination not walkable or invalid height', {\n                actor: this.username,\n                destination,\n                walkable,\n                currentPosition: this.position,\n                movementDeltas: { x, y }\n            });\n        }\n        return false;\n    }\n\n    startMove(): void {\n        if (!this.destination) return;\n        \n        // Prevent starting a new move if one is already in progress\n        if (this.moveTick) {\n            gameLogger.warn('Actor startMove: Movement already in progress', {\n                actor: this.username,\n                currentDestination: this.destination,\n                frame: this.frame,\n                moveStart: this.moveStart\n            });\n            return;\n        }\n        \n        const game = this.game as any;\n        if (!game || !game.world) {\n            gameLogger.error('Actor startMove: Game or world not available', {\n                actor: this.username\n            });\n            return;\n        }\n        \n        // Set up movement tracking\n        this.moveStart = game.ticks;\n        \n        // Check if destination coordinates are actually free before creating placeholder\n        const existingObject = game.world.objectAtXYZ(this.destination.x, this.destination.y, this.destination.z);\n        if (existingObject) {\n            // Actor.startMove: Destination already occupied, cancelling movement\n            this.destination = false;\n            return;\n        }\n        \n        // Create placeholder at destination\n        this.movePlaceholder = new Placeholder(this as any, {\n            x: this.destination.x,\n            y: this.destination.y, \n            z: this.destination.z\n        });\n        \n        // Make current position unwalkable during movement\n        this.unWalkable = true;\n        delete game.world.walkable[this.position.x + ':' + this.position.y];\n        \n        // Calculate movement deltas\n        this.destDelta = {\n            x: this.destination.x - this.position.x,\n            y: this.destination.y - this.position.y,\n            z: this.destination.z - this.position.z\n        };\n        \n        // Update facing direction based on the actual movement direction\n        // Movement should always be exactly 1 tile in a cardinal direction\n        if (this.destDelta.x > 0) {\n            this.facing = 'east';\n        } else if (this.destDelta.x < 0) {\n            this.facing = 'west';\n        } else if (this.destDelta.y > 0) {\n            this.facing = 'south';\n        } else if (this.destDelta.y < 0) {\n            this.facing = 'north';\n        }\n        // If no X/Y movement, keep current facing direction\n        \n        // Validate that movement is cardinal (not diagonal)\n        if (this.destDelta.x !== 0 && this.destDelta.y !== 0) {\n            gameLogger.warn('Actor diagonal movement detected', {\n                actor: this.username,\n                destDelta: this.destDelta,\n                destination: this.destination,\n                position: this.position\n            });\n        }\n        \n        // Initialize frame animation\n        this.frame = 0;\n        \n        // Log animation start\n        gameLogger.actorAnimationStarted({\n            uid: this.uid,\n            username: this.username,\n            animationType: 'hopping',\n            state: 'hopping',\n            facing: this.facing,\n            frame: this.frame,\n            destination: this.destination\n        });\n        \n        const animation = this.sheet.map['hopping'].animation;\n        const halfZDepth = (this.position.x + this.position.y + (this.destDelta.x + this.destDelta.y) / 2);\n        \n        this.moveTick = this.tickRepeat((progress: any) => {\n            if (!this.exists) {\n                if (this.movePlaceholder) {\n                    this.movePlaceholder.remove();\n                    delete this.movePlaceholder;\n                }\n                return;\n            }\n            \n            let newFrame = false;\n            if (progress.ticks > 0 && progress.ticks % 3 === 0) {\n                this.frame++;\n                newFrame = true;\n            }\n            \n            // Handle Z-depth changes during movement\n            if (newFrame && this.frame === 6) {\n                // Move zDepth half-way between tiles\n                game.renderer.updateZBuffer(this.zDepth, this.sprite, halfZDepth);\n                this.zDepth = halfZDepth;\n            } else if (newFrame && this.frame === 8) {\n                // Move zDepth all the way\n                const newZDepth = this.destination.x + this.destination.y;\n                game.renderer.updateZBuffer(halfZDepth, this.sprite, newZDepth);\n                this.zDepth = newZDepth;\n            }\n            \n            // Update visual position and sprite (always do this during animation)\n            this.preciseScreen = this.toScreenPrecise();\n            if (this.nametag) {\n                this.nametag.updateScreen();\n            }\n            this.updateSprite();\n            \n            if (this.frame >= animation.frames) {\n                // Movement completed - update actual position\n                if (this.movePlaceholder) {\n                    this.movePlaceholder.remove();\n                    delete this.movePlaceholder;\n                }\n                this.unWalkable = false;\n                \n                // Log animation finished\n                gameLogger.actorAnimationFinished({\n                    uid: this.uid,\n                    username: this.username,\n                    animationType: 'hopping',\n                    state: 'hopping',\n                    facing: this.facing,\n                    finalFrame: this.frame,\n                    position: { x: this.destination.x, y: this.destination.y, z: this.destination.z }\n                });\n                \n                // Move to destination (absolute positioning)\n                this.move(this.destination.x, this.destination.y, this.destination.z, true);\n                this.destination = false;\n                this.frame = 0; // Reset frame instead of delete\n                delete this.moveStart;\n                delete this.destDelta;\n                \n                // Update sprite to reflect current presence state after movement\n                this.updateSprite();\n                this.emit('movecomplete');\n                delete this.moveTick;\n            }\n        }, 3 * animation.frames);\n        \n        this.updateSprite();\n    }\n\n    move(x: number, y: number, z?: number, absolute?: boolean): void {\n        // Store previous position for logging\n        const previousPosition = {\n            x: this.position.x,\n            y: this.position.y,\n            z: this.position.z\n        };\n        \n        // Validate input parameters\n        if (isNaN(x) || isNaN(y) || (typeof z !== 'undefined' && isNaN(z))) {\n            gameLogger.error('Actor move: Invalid coordinates provided', {\n                actor: this.username,\n                parameters: { x, y, z, absolute },\n                currentPosition: this.position\n            });\n            return;\n        }\n        \n        if (absolute) {\n            // For absolute positioning, use world.moveObject to ensure walkable updates\n            const game = this.game as any;\n            if (game && game.world && game.world.moveObject) {\n                game.world.moveObject(this, x, y, z !== undefined ? z : this.position.z);\n            } else {\n                // Fallback if world not available\n                this.position.x = x;\n                this.position.y = y;\n                if (typeof z !== 'undefined') this.position.z = z;\n            }\n        } else {\n            // For relative movement, use WorldObject's move method which calls moveObject\n            if (typeof z !== 'undefined') {\n                super.move(x, y, z);\n            } else {\n                super.move(x, y, 0);\n            }\n            \n            // Log the movement for relative moves\n            gameLogger.actorMoved({\n                uid: this.uid,\n                username: this.username,\n                fromX: previousPosition.x,\n                fromY: previousPosition.y,\n                fromZ: previousPosition.z,\n                toX: this.position.x,\n                toY: this.position.y,\n                toZ: this.position.z,\n                movementType: 'relative',\n                facing: this.facing\n            });\n            return; // super.move handles everything including screen updates\n        }\n        \n        // Log the movement for absolute moves\n        gameLogger.actorMoved({\n            uid: this.uid,\n            username: this.username,\n            fromX: previousPosition.x,\n            fromY: previousPosition.y,\n            fromZ: previousPosition.z,\n            toX: this.position.x,\n            toY: this.position.y,\n            toZ: this.position.z,\n            movementType: 'absolute',\n            facing: this.facing\n        });\n        \n        // Validate final position\n        if (isNaN(this.position.x) || isNaN(this.position.y) || isNaN(this.position.z)) {\n            gameLogger.error('Actor move: Final position contains NaN after movement', {\n                actor: this.username,\n                finalPosition: this.position,\n                movement: { x, y, z, absolute }\n            });\n            return;\n        }\n        \n        this.zDepth = this.calcZDepth();\n        this.updateScreen();\n        this.preciseScreen = this.toScreenPrecise();\n    }\n\n    startTalking(message: any, channel?: string, onStop?: () => void): void {\n        this.talking = true;\n        this.lastMessage = { channel, time: Date.now() };\n        if (this.nametag) {\n            this.nametag.sprite.hidden = true;\n        }\n        this.messageBox = new TextBox(this as any, message, true);\n        this.messageBox.addToGame(this.game);\n        \n        // Log talking animation start\n        gameLogger.actorAnimationStarted({\n            uid: this.uid,\n            username: this.username,\n            animationType: 'talking',\n            state: 'online',\n            facing: this.facing,\n            frame: 0\n        });\n        \n        const self = this;\n        this.messageBox.scrollMessage(function() {\n            // Log talking animation finished\n            gameLogger.actorAnimationFinished({\n                uid: self.uid,\n                username: self.username,\n                animationType: 'talking',\n                state: 'online',\n                facing: self.facing,\n                finalFrame: 0,\n                position: { x: self.position.x, y: self.position.y, z: self.position.z }\n            });\n            \n            delete self.messageBox;\n            self.talking = false;\n            // Don't automatically show nametag after talking - let onUpdate handle visibility based on mouse hover\n            self.updateSprite();\n            self.emit('donetalking');\n            //if(!self.lastSeed || self.game.ticks - self.lastSeed > 60*60) {\n            //    self.lastSeed = self.game.ticks;\n            //    self.game.decorator.sewSeed({ origin: self.position });\n            //}\n            if (onStop) onStop();\n        });\n    }\n\n    onMessage(message: any): void {\n        const lastMessage = this.lastMessage as { channel?: string; time: number } || { time: 0 };\n        if (message.channel !== lastMessage.channel) return; // Not my active channel\n        if (lastMessage.time < Date.now() - 3 * 60 * 1000) return; // Haven't spoken in 3 minutes\n        if (message.user === this || this.presence !== 'online') return; // Ignore if self or not online\n        \n        const self = this;\n        function readyToMove() {\n            for (let i = 0; i < self.behaviors.length; i++) {\n                self.behaviors[i].detach();\n            }\n            self.behaviors = [new GoTo(self, message.user)];\n        }\n        \n        this.tickDelay(function() {\n            if (geometry.getDistance(self.position, message.user.position) < 3 // If already nearby\n                || self.underneath()) return; // Or if something on top of actor\n            if (self.destination) {\n                self.once('movecomplete', readyToMove);\n            } else {\n                readyToMove();\n            }\n        }, util.randomIntRange(0, 60)); // To prevent everyone pathfinding on the same tick\n    }\n\n    goto(x: number, y: number): void {\n        const target = { position: { x: x, y: y, z: (this.game as any).world.getHeight(x, y) } };\n        \n        // Remove existing GoTo behaviors\n        for (let i = this.behaviors.length - 1; i >= 0; i--) {\n            if (this.behaviors[i] instanceof GoTo) {\n                this.behaviors[i].detach();\n                this.behaviors.splice(i, 1);\n            }\n        }\n        \n        gameLogger.actorGoto({\n            username: this.username,\n            targetX: x,\n            targetY: y\n        });\n        \n        // Add new GoTo behavior\n        this.behaviors.push(new GoTo(this, target));\n    }\n\n    stopGoTo(gotoBehavior?: any): void {\n        for (let i = this.behaviors.length - 1; i >= 0; i--) {\n            if (this.behaviors[i] instanceof GoTo) {\n                if (!gotoBehavior || this.behaviors[i] === gotoBehavior) {\n                    this.behaviors[i].detach();\n                    this.behaviors.splice(i, 1);\n                }\n            }\n        }\n    }\n\n    remove(): void {\n        // Disconnect from users message events\n        const game = this.game as any;\n        if (game && game.users) {\n            game.users.off('message', this.boundOnMessage);\n        }\n        \n        // Clean up behaviors\n        for (const behavior of this.behaviors) {\n            if (behavior.detach) behavior.detach();\n        }\n        this.behaviors = [];\n        \n        // Clean up movement placeholder\n        if (this.movePlaceholder) {\n            try {\n                this.movePlaceholder.remove();\n            } catch (error) {\n                gameLogger.error('Actor remove: Error removing movePlaceholder', {\n                    actor: this.username,\n                    error: error instanceof Error ? error.message : String(error)\n                });\n            }\n            delete this.movePlaceholder;\n        }\n        \n        // Clean up message box first (talking takes priority)\n        if (this.messageBox) {\n            try {\n                // Cancel any ongoing message animations before removal\n                this.messageBox.remove();\n            } catch (error) {\n                gameLogger.error('Actor remove: Error removing messageBox', {\n                    actor: this.username,\n                    error: error instanceof Error ? error.message : String(error)\n                });\n            }\n            delete this.messageBox;\n        }\n        \n        // Clean up talk box (legacy)\n        if (this.talkBox) {\n            try {\n                this.talkBox.remove();\n            } catch (error) {\n                gameLogger.error('Actor remove: Error removing talkBox', {\n                    actor: this.username,\n                    error: error instanceof Error ? error.message : String(error)\n                });\n            }\n            delete this.talkBox;\n        }\n        \n        // Clean up nametag\n        if (this.nametag) {\n            try {\n                this.nametag.remove();\n            } catch (error) {\n                gameLogger.error('Actor remove: Error removing nametag', {\n                    actor: this.username,\n                    error: error instanceof Error ? error.message : String(error)\n                });\n            }\n            delete this.nametag;\n        }\n        \n        // Clean up placeholder\n        if (this.placeholder) {\n            try {\n                this.placeholder.remove();\n            } catch (error) {\n                gameLogger.error('Actor remove: Error removing placeholder', {\n                    actor: this.username,\n                    error: error instanceof Error ? error.message : String(error)\n                });\n            }\n            delete this.placeholder;\n        }\n        \n        super.remove();\n    }\n}", "'use strict';\n\nimport { util } from '../common/util.js';\nimport WorldObject from '../engine/worldobject.js';\n\ninterface SlabOptions {\n    position: { x: number; y: number; z: number };\n    pixelSize: { x: number; y: number; z: number };\n    height: number;\n}\n\nexport default class Slab extends WorldObject {\n    invisible: boolean = true;\n    style: string;\n\n    constructor(style: string, x: number, y: number, z: number) {\n        const options: SlabOptions = {\n            position: { x: x, y: y, z: z },\n            pixelSize: { x: 16, y: 16, z: 1 },\n            height: 0.5\n        };\n        super(options);\n        this.style = style;\n    }\n}", "'use strict';\n\ninterface TileMetrics {\n    x: number;\n    y: number;\n    w: number;\n    h: number;\n    ox?: number;\n    oy?: number;\n}\n\ninterface TileMap {\n    [tileCode: string]: TileMetrics;\n}\n\ninterface SheetMap {\n    [spriteName: string]: TileMap;\n}\n\nconst map: SheetMap = {\n    tile: {\n        'G-G-G-G': { x: 0, y: 108, w: 32, h: 18, ox: -1, oy: -2 }, // Grass/Slab\n        'S-S-S-S': { x: 32, y: 90, w: 32, h: 18, ox: -1, oy: -2 },\n        'G-S-G-S': { x: 64, y: 90, w: 32, h: 18, ox: -1, oy: -2 },\n        'S-G-S-G': { x: 96, y: 90, w: 32, h: 18, ox: -1, oy: -2 },\n        'G-G-G-S': { x: 0, y: 18, w: 32, h: 18, ox: -1, oy: -2 },\n        'S-G-G-G': { x: 0, y: 36, w: 32, h: 18, ox: -1, oy: -2 },\n        'G-S-G-G': { x: 0, y: 54, w: 32, h: 18, ox: -1, oy: -2 },\n        'G-G-S-G': { x: 0, y: 72, w: 32, h: 18, ox: -1, oy: -2 },\n        'S-G-G-S': { x: 32, y: 18, w: 32, h: 18, ox: -1, oy: -2 },\n        'S-S-G-G': { x: 32, y: 36, w: 32, h: 18, ox: -1, oy: -2 },\n        'G-S-S-G': { x: 32, y: 54, w: 32, h: 18, ox: -1, oy: -2 },\n        'G-G-S-S': { x: 32, y: 72, w: 32, h: 18, ox: -1, oy: -2 },\n        'S-S-G-S': { x: 64, y: 18, w: 32, h: 18, ox: -1, oy: -2 },\n        'S-S-S-G': { x: 64, y: 36, w: 32, h: 18, ox: -1, oy: -2 },\n        'G-S-S-S': { x: 64, y: 54, w: 32, h: 18, ox: -1, oy: -2 },\n        'S-G-S-S': { x: 64, y: 72, w: 32, h: 18, ox: -1, oy: -2 },\n        \n        'F-F-F-F': { x: 64, y: 198, w: 32, h: 18, ox: -1, oy: -2 }, // Grass/Flower\n        'G-F-G-F': { x: 0, y: 198, w: 32, h: 18, ox: -1, oy: -2 },\n        'F-G-F-G': { x: 32, y: 198, w: 32, h: 18, ox: -1, oy: -2 },\n        'G-G-G-F': { x: 0, y: 126, w: 32, h: 18, ox: -1, oy: -2 },\n        'F-G-G-G': { x: 0, y: 144, w: 32, h: 18, ox: -1, oy: -2 },\n        'G-F-G-G': { x: 0, y: 162, w: 32, h: 18, ox: -1, oy: -2 },\n        'G-G-F-G': { x: 0, y: 180, w: 32, h: 18, ox: -1, oy: -2 },\n        'F-G-G-F': { x: 32, y: 126, w: 32, h: 18, ox: -1, oy: -2 },\n        'F-F-G-G': { x: 32, y: 144, w: 32, h: 18, ox: -1, oy: -2 },\n        'G-F-F-G': { x: 32, y: 162, w: 32, h: 18, ox: -1, oy: -2 },\n        'G-G-F-F': { x: 32, y: 180, w: 32, h: 18, ox: -1, oy: -2 },\n        'F-F-G-F': { x: 64, y: 126, w: 32, h: 18, ox: -1, oy: -2 },\n        'F-F-F-G': { x: 64, y: 144, w: 32, h: 18, ox: -1, oy: -2 },\n        'G-F-F-F': { x: 64, y: 162, w: 32, h: 18, ox: -1, oy: -2 },\n        'F-G-F-F': { x: 64, y: 180, w: 32, h: 18, ox: -1, oy: -2 },\n        \n        'E-E-S-E': { x: 96, y: 18, w: 32, h: 18, ox: -1, oy: -2 }, // Slab/Empty\n        'E-S-S-E': { x: 96, y: 36, w: 32, h: 18, ox: -1, oy: -2 },\n        'E-E-S-S': { x: 96, y: 54, w: 32, h: 18, ox: -1, oy: -2 },\n        'E-S-S-S': { x: 96, y: 72, w: 32, h: 18, ox: -1, oy: -2 },\n        'E-E-E-S': { x: 128, y: 0, w: 32, h: 18, ox: -1, oy: -2 },\n        'S-S-E-E': { x: 128, y: 18, w: 32, h: 18, ox: -1, oy: -2 },\n        'S-E-E-E': { x: 160, y: 0, w: 32, h: 18, ox: -1, oy: -2 },\n        'S-E-E-S': { x: 160, y: 18, w: 32, h: 18, ox: -1, oy: -2 },\n        'E-S-E-E': { x: 192, y: 0, w: 32, h: 18, ox: -1, oy: -2 },\n        'S-S-E-S': { x: 192, y: 18, w: 32, h: 18, ox: -1, oy: -2 },\n        'E-S-E-S': { x: 224, y: 0, w: 32, h: 18, ox: -1, oy: -2 },\n        'S-E-S-S': { x: 224, y: 18, w: 32, h: 18, ox: -1, oy: -2 },\n        'S-S-S-E': { x: 224, y: 36, w: 32, h: 18, ox: -1, oy: -2 },\n        'S-E-S-E': { x: 224, y: 54, w: 32, h: 18, ox: -1, oy: -2 }\n    }\n};\n\nexport default class Sheet {\n    map: TileMap;\n\n    constructor(spriteName: string) {\n        this.map = JSON.parse(JSON.stringify(map[spriteName]));\n    }\n}", "'use strict';\n\nimport { util } from '../common/util.js';\nimport Sheet from './sheet2.js';\n\ninterface TileOptions {\n    game: any;\n    grid: string;\n    tileCode: string;\n    position: { x: number; y: number; z: number };\n}\n\ninterface SpriteMetrics {\n    x: number;\n    y: number;\n    w: number;\n    h: number;\n    ox: number;\n    oy: number;\n}\n\ninterface Sprite {\n    metrics: SpriteMetrics;\n    image: string;\n    position: { x: number; y: number; z: number };\n    screen: { x: number; y: number };\n}\n\nexport default class Tile {\n    game: any;\n    grid: string;\n    tileCode: string;\n    position: { x: number; y: number; z: number };\n    zDepth: number;\n    screen: { x: number; y: number };\n    imageName: string;\n    sheet: any;\n    sprite: Sprite;\n\n    constructor(options: TileOptions) {\n        this.game = options.game;\n        this.grid = options.grid;\n        this.tileCode = options.tileCode;\n        this.position = options.position;\n        this.zDepth = this.position.x + this.position.y;\n        this.screen = {\n            x: (this.position.x - this.position.y) * 16 - 16,\n            y: (this.position.x + this.position.y) * 8 - (this.position.z) * 16 - 8\n        };\n        this.imageName = 'static-tiles';\n        \n        // Load sheet synchronously, doing with loadSheet caused errors\n        this.sheet = new Sheet('tile');\n        \n        // Get sprite metrics from the loaded sheet\n        const spriteMap = this.sheet.map[this.tileCode] || { \n            x: 0, y: 0, w: 16, h: 16, ox: 0, oy: 0 \n        };\n        \n        // Ensure ox and oy are numbers, not undefined\n        this.sprite = {\n            metrics: {\n                x: spriteMap.x || 0,\n                y: spriteMap.y || 0,\n                w: spriteMap.w || 16,\n                h: spriteMap.h || 16,\n                ox: spriteMap.ox || 0,\n                oy: spriteMap.oy || 0\n            },\n            image: this.imageName, \n            position: this.position, \n            screen: this.screen\n        };\n\n        if (this.tileCode == 'G-G-G-G') {\n            let variation = util.randomIntRange(0, 2);\n            const random = Math.random();\n            if (Math.random() > 0.98) variation = 8;\n            else if (Math.random() > 0.95) variation = util.randomIntRange(5, 7);\n            else if (random > 0.6) variation = util.randomIntRange(3, 4);\n            this.sprite.metrics.x += variation * this.sprite.metrics.w;\n        }\n    }\n\n}", "'use strict';\n\ninterface SpriteMetrics {\n    x: number;\n    y: number;\n    w: number;\n    h: number;\n    ox: number;\n    oy: number;\n}\n\ninterface SpriteMap {\n    [key: string]: SpriteMetrics;\n}\n\ninterface SheetMap {\n    [spriteName: string]: SpriteMap;\n}\n\nconst map: SheetMap = {\n    beacon: { \n        main: { x: 0, y: 0, w: 31, h: 56, ox: -1, oy: -1 },\n        light: { x: 31, y: 0, w: 5, h: 4, ox: 13, oy: 0 }\n    },\n    seed: {\n        plant: { x: 36, y: 0, w: 16, h: 22, ox: 2, oy: 2 },\n        orb: { x: 36, y: 22, w: 8, h: 8, ox: 8, oy: 4 }\n    }\n};\n\nexport default class Sheet {\n    map: SpriteMap;\n\n    constructor(spriteName: string) {\n        this.map = JSON.parse(JSON.stringify(map[spriteName]));\n    }\n}", "'use strict';\n\nimport WorldObject from '../engine/worldobject.js';\nimport BetterCanvas from '../common/bettercanvas.js';\nimport Sheet from './sheet.js';\n\ninterface BeaconOptions {\n    position: { x: number; y: number; z: number };\n    pixelSize: { x: number; y: number; z: number };\n    height: number;\n}\n\nexport default class Beacon extends WorldObject {\n    unWalkable: boolean = true;\n    imageName: string = 'props';\n    sheet: any;\n    pinging: number = 0;\n\n    constructor(x: number, y: number, z: number) {\n        const options: BeaconOptions = {\n            position: { x: x, y: y, z: z },\n            pixelSize: { x: 15, y: 16, z: 45 },\n            height: 2.5\n        };\n        super(options);\n        \n        this.on('draw', (canvas: any) => {\n            if (this.exists) canvas.drawEntity(this);\n        });\n        \n        // Load sheet synchronously, doing with loadSheet caused errors\n        this.sheet = new Sheet('beacon');\n        if (this.sprite && this.sheet.map) {\n            this.sprite.metrics = this.sheet.map.main;\n        }\n    }\n\n    addToGame(game: any): void {\n        super.addToGame(game);\n        game.on('update', this.onUpdate.bind(this));\n        this.drawSprite();\n    }\n\n    drawSprite(): void {\n        if (!this.sheet?.map?.main || !(this.game as any)?.renderer?.images?.[this.imageName]) {\n            return;\n        }\n\n        const canvas = new BetterCanvas(this.sheet.map.main.w, this.sheet.map.main.h);\n        canvas.drawImage(\n            (this.game as any).renderer.images[this.imageName],\n            this.sheet.map.main.x, this.sheet.map.main.y, this.sheet.map.main.w, this.sheet.map.main.h,\n            0, 0, this.sheet.map.main.w, this.sheet.map.main.h\n        );\n\n        if (this.pinging && this.sheet.map.light) {\n            canvas.drawImage(\n                (this.game as any).renderer.images[this.imageName],\n                this.sheet.map.light.x, this.sheet.map.light.y, this.sheet.map.light.w, this.sheet.map.light.h,\n                this.sheet.map.light.ox, 0, this.sheet.map.light.w, this.sheet.map.light.h, \n                this.pinging / 100\n            );\n        }\n\n        if (this.sprite) {\n            this.sprite.image = canvas.canvas;\n        }\n    }\n\n    onUpdate(): void {\n        if (this.pinging) {\n            this.pinging = Math.max(0, this.pinging - 1);\n            this.drawSprite();\n        }\n    }\n\n    ping(): void {\n        this.pinging = 100;\n    }\n}", "'use strict';\n\nimport { util } from '../common/util.js';\nimport WorldObject from '../engine/worldobject.js';\nimport BetterCanvas from '../common/bettercanvas.js';\nimport Sheet from './sheet.js';\n\ninterface SeedOptions {\n    destination: { x: number; y: number; z: number };\n    origin: { x: number; y: number; z: number };\n}\n\ninterface WorldObjectOptions {\n    position: { x: number; y: number; z: number };\n    pixelSize: { x: number; y: number; z: number };\n    height: number;\n}\n\nexport default class Seed extends WorldObject {\n    unwalkable: boolean = true;\n    origin: { x: number; y: number; z: number };\n    sheet: any;\n    boundGrow: () => void;\n    boundWither: () => void;\n    growTime: number = 80;\n    growStage: number = 0;\n    growthStage?: number;\n\n    constructor(options: SeedOptions) {\n        const worldObjectOptions: WorldObjectOptions = {\n            position: { x: options.destination.x, y: options.destination.y, z: options.destination.z },\n            pixelSize: { x: 12, y: 12, z: 16 },\n            height: 1\n        };\n        super(worldObjectOptions);\n        \n        this.origin = options.origin;\n        \n        this.on('draw', (canvas: any) => {\n            if (this.exists) canvas.drawEntity(this);\n        });\n        \n        if (this.sprite) {\n            this.sprite.image = 'props';\n        }\n        \n        this.boundGrow = this.grow.bind(this);\n        this.boundWither = this.wither.bind(this);\n        \n        // Load sheet synchronously, doing with loadSheet caused errors\n        this.sheet = new Sheet('seed');\n        if (this.sprite && this.sheet.map) {\n            this.sprite.metrics = this.sheet.map.plant;\n        }\n    }\n\n    addToGame(game: any): void {\n        super.addToGame(game);\n        this.tickDelay(this.boundGrow, this.growTime + util.randomIntRange(this.growTime / -6, this.growTime / 6));\n    }\n\n    grow(): void {\n        this.growStage++;\n        const metrics = JSON.parse(JSON.stringify(this.sheet.map.plant));\n        metrics.x += this.sprite.metrics.w * this.growStage;\n        this.sprite.metrics = metrics;\n        \n        const nextGrowth = this.growTime + util.randomIntRange(this.growTime / -6, this.growTime / 6);\n        if (this.growStage < 5) {\n            this.tickDelay(this.boundGrow, nextGrowth);\n        } else {\n            this.tickDelay(this.boundWither, Math.floor(nextGrowth / 2));\n        }\n    }\n\n    wither(): void {\n        const metrics = this.sheet.map.orb;\n        this.sprite.metrics = JSON.parse(JSON.stringify(metrics));\n        \n        this.tickRepeat((progress: any) => {\n            this.sprite.metrics.oy = Math.round(metrics.oy + progress.ticks / 2);\n            if (progress.percent >= 1) this.growthStage = 6;\n        }, 26);\n    }\n}", "'use strict';\n\nimport { gameLogger } from './gameLogger.js';\nimport Users from './script/actors/users.js';\nimport DiscordOAuth from './script/auth/discord-oauth.js';\nimport { util } from './script/common/util.js';\nimport Canvas from './script/engine/canvas.js';\nimport Game from './script/engine/game.js';\nimport Preloader from './script/engine/preloader.js';\nimport Renderer from './script/engine/renderer.js';\nimport World from './script/environment/world.js';\nimport Decorator from './script/props/decorator.js';\nimport UI from './script/ui/ui.js';\n\n// Import package.json for version information\n// @ts-ignore - esbuild will handle this\nimport packageInfo from '../package.json';\n\n// Global variables\nlet version: string;\nlet preloader: Preloader;\nlet game: Game;\nlet ws: WebSocket;\nlet discordAuth: DiscordOAuth;\n\n// Export for testing\nexport { discordAuth, game, ws };\n\nfunction initGame(images: Record<string, HTMLCanvasElement>): void {\n    // Use direct imports since these modules will be available  \n    // We'll fix these imports after converting the JS files to TS\n    gameLogger.info('Initializing game with images', { imageCount: Object.keys(images).length, imageNames: Object.keys(images) });\n    \n    game = new Game({ step: 1000 / 60 });\n    game.renderer = new Renderer({ game: game, images: images });\n    const canvas = new Canvas({ id: 'main', game: game, initialScale: 2, backgroundColor: '#181213' });\n    game.renderer.addCanvas(canvas);\n    game.bindCanvas(canvas);\n    \n    // Initialize UI (converted to TypeScript)\n    game.ui = new UI(game as any);\n    \n    //game.showGrid = true;\n    //game.timeRenders = true;\n    \n    // Initialize Discord OAuth\n    initDiscordAuth();\n    \n    // Add help button immediately after UI initialization\n    addHelpButton();\n    \n    // Ensure UI is properly sized after adding the help button\n    game.renderer.canvases[0].onResize();\n    \n    initWebsocket();\n\n    (window as any).pause = function() { game.paused = true; };\n    (window as any).unpause = function() { game.paused = false; };\n    (window as any).game = game;\n    \n    // Set up initial draw logging\n    let initialDrawLogged = false;\n    game.on('render', () => {\n        if (!initialDrawLogged) {\n            initialDrawLogged = true;\n            gameLogger.initialDraw();\n        }\n    });\n    \n    // Log game initialization complete\n    gameLogger.gameInitialized({ \n        width: canvas.width, \n        height: canvas.height, \n        version: packageInfo.version \n    });\n}\n\nfunction reinitializeDiscordAuth(newClientId: string): void {\n    gameLogger.info('Reinitializing Discord OAuth with new client ID', { newClientId });\n    \n    // Store the current state\n    const wasLoggedIn = discordAuth && discordAuth.isLoggedIn();\n    const currentUser = discordAuth ? discordAuth.getUser() : null;\n    \n    // Create new Discord OAuth instance with updated client ID\n    const redirectUri = window.location.origin + window.location.pathname.replace('index.html', '') + 'discord-callback.html';\n    \n    discordAuth = new DiscordOAuth({\n        clientId: newClientId,\n        redirectUri: redirectUri,\n        scopes: ['identify']\n    });\n    \n    // Re-add event handlers\n    setupDiscordAuthEventHandlers();\n    \n    // If user was logged in before, they might need to re-authenticate\n    // since the client ID changed, but we'll preserve the current state for now\n    if (wasLoggedIn && currentUser) {\n        gameLogger.warn('Discord OAuth client ID updated - user may need to re-authenticate', { \n            currentUser: currentUser?.username \n        });\n        // The stored access token may not work with the new client ID\n        // but we'll let the user discover this naturally rather than forcing re-auth\n    }\n    \n    gameLogger.info('Discord OAuth reinitialized successfully');\n}\n\nfunction setupDiscordAuthEventHandlers(): void {\n    // Add debug logging to the login method\n    const originalLogin = discordAuth.login;\n    discordAuth.login = function() {\n        const authUrl = this.getAuthUrl();\n        gameLogger.debug('Discord OAuth URL generated', { authUrl });\n        gameLogger.discordLoginAttempt();\n        return originalLogin.call(this);\n    };\n    \n    discordAuth.on('login-success', function(user) {\n        gameLogger.discordLoginSuccess(user.username);\n        // Store user info\n        localStorage.setItem('discord_user', JSON.stringify(user));\n        \n        // If user was trying to join a server, try again now that they're authenticated\n        if (game.pendingServerJoin) {\n            joinServer(game.pendingServerJoin);\n            delete game.pendingServerJoin;\n        }\n        \n        // Update help panel if it's open\n        if (game.helpPanel) {\n            game.helpPanel.remove();\n            delete game.helpPanel;\n            // Reopen help panel to show updated login status\n            setTimeout(function() {\n                if (game.helpButton && game.helpButton.onPress) {\n                    game.helpButton.onPress();\n                }\n            }, 100);\n        }\n    });\n    \n    discordAuth.on('login-error', function(error) {\n        gameLogger.discordLoginError(error);\n        (window as any).alert('Discord login failed: ' + error);\n    });\n    \n    discordAuth.on('login-cancelled', function() {\n        gameLogger.info('Discord login cancelled by user');\n    });\n    \n    discordAuth.on('logout', function() {\n        gameLogger.discordLogout();\n        \n        // Update help panel if it's open\n        if (game.helpPanel) {\n            game.helpPanel.remove();\n            delete game.helpPanel;\n            // Reopen help panel to show updated login status\n            setTimeout(function() {\n                if (game.helpButton && game.helpButton.onPress) {\n                    game.helpButton.onPress();\n                }\n            }, 100);\n        }\n    });\n}\n\nfunction initDiscordAuth(): void {\n    // Debug: Log the constructed redirect URI\n    const redirectUri = window.location.origin + window.location.pathname.replace('index.html', '') + 'discord-callback.html';\n    gameLogger.debug('Discord OAuth initialization', {\n        redirectUri,\n        currentLocation: window.location.href,\n        origin: window.location.origin,\n        pathname: window.location.pathname\n    });\n    \n    // Test if callback page is accessible\n    fetch(redirectUri)\n        .then(function(response) {\n            gameLogger.debug('Discord callback page test', { \n                status: response.status,\n                accessible: response.ok \n            });\n            if (response.ok) {\n                gameLogger.debug('\u2713 Discord callback page is accessible');\n            } else {\n                gameLogger.error('\u2717 Discord callback page not accessible', { status: response.status });\n            }\n        })\n        .catch(function(error) {\n            gameLogger.error('\u2717 Discord callback page test failed', { error: error.message });\n        });\n    \n    // Initialize with a placeholder - the real client ID will be set by the server\n    discordAuth = new DiscordOAuth({\n        clientId: \"506432803173433344\", // fallback client ID\n        redirectUri: redirectUri,\n        scopes: ['identify']\n    });\n    \n    // Setup event handlers for Discord OAuth\n    setupDiscordAuthEventHandlers();\n}\n\nfunction addHelpButton(): void {\n    // Help button\n    game.helpButton = game.ui.addButton({ \n        text: '?', \n        bottom: 3, \n        right: 3, \n        w: 18, \n        h: 18, \n        onPress: function() {\n            // Close server panel if it's open\n            if (game.serverListPanel) {\n                game.serverListPanel.remove();\n                delete game.serverListPanel;\n            }\n            \n            if (game.helpPanel) {\n                game.helpPanel.remove();\n                delete game.helpPanel;\n                return;\n            }\n            \n            game.helpPanel = game.ui.addPanel({ left: 'auto', top: 'auto', w: 200, h: 130 });\n            game.ui.addLabel({ text: 'D-Zone (fork) ' + (version || packageInfo.version), top: 5, left: 'auto', parent: game.helpPanel });\n            game.ui.addLabel({\n                text: packageInfo.description, \n                top: 20, \n                left: 2, \n                maxWidth: 196, \n                parent: game.helpPanel\n            });\n            game.ui.addLabel({\n                text: \"This is a fork of D-Zone (originally by Vegeta897). It follows its own versioning and is not published on npm.\", \n                top: 50, \n                left: 2, \n                maxWidth: 196, \n                parent: game.helpPanel\n            });\n            game.ui.addLabel({\n                text: ':icon-npm: View on npm', \n                hyperlink: 'https://www.npmjs.com/package/d-zone',\n                top: 90, \n                left: 8, \n                parent: game.helpPanel\n            });\n            game.ui.addLabel({\n                text: 'View original :icon-github:', \n                hyperlink: 'https://github.com/d-zone-org/d-zone',\n                top: 90, \n                right: 8, \n                parent: game.helpPanel\n            });\n            game.ui.addLabel({\n                text: 'View fork :icon-github:', \n                hyperlink: 'https://github.com/nntin/d-zone',\n                top: 110, \n                right: 8, \n                parent: game.helpPanel\n            });\n            \n            // Add Discord login section\n            const isLoggedIn = discordAuth && discordAuth.isLoggedIn();\n            const user = discordAuth && discordAuth.getUser();\n            \n            if (isLoggedIn && user) {\n                // User is logged in - show user info and logout button\n                game.ui.addLabel({\n                    text: `Logged in as: ${user.username}`,\n                    top: 130,\n                    left: 2,\n                    parent: game.helpPanel\n                });\n                \n                game.ui.addButton({\n                    text: 'Logout Discord',\n                    top: 150,\n                    left: 2,\n                    w: 80,\n                    h: 16,\n                    parent: game.helpPanel,\n                    onPress: function() {\n                        discordAuth.logout();\n                    }\n                });\n            } else {\n                // User is not logged in - show login button\n                game.ui.addButton({\n                    text: 'Login Discord',\n                    top: 130,\n                    left: 2,\n                    w: 80,\n                    h: 16,\n                    parent: game.helpPanel,\n                    onPress: function() {\n                        discordAuth.login();\n                    }\n                });\n                \n                game.ui.addLabel({\n                    text: 'Login required for private servers',\n                    top: 150,\n                    left: 2,\n                    maxWidth: 196,\n                    parent: game.helpPanel\n                });\n            }\n            \n            // Resize help panel to fit content\n            game.helpPanel.resize(200, isLoggedIn ? 170 : 170);\n        }\n    });\n}\n\nexport function initWebsocket(): void {\n    // Initialize the game components now that they're properly imported\n    let users: Users, world: World | undefined, decorator: Decorator | undefined;\n\n    // Function to clean up event listeners and prevent memory leaks\n    function cleanupEventListeners(): void {\n        if (users && users.removeAllListeners) users.removeAllListeners();\n        if (world && world.removeAllListeners) world.removeAllListeners();\n        if (decorator && decorator.removeAllListeners) decorator.removeAllListeners();\n    }\n\n    // Multiple fallback strategies for websocket connection\n    const fallbackStrategies: { url: string; description: string }[] = [];\n    \n    // Strategy 1: URL parameter\n    const urlSocketURL = util.getURLParameter('socketURL');\n    if (urlSocketURL) {\n        fallbackStrategies.push({\n            url: urlSocketURL,\n            description: 'URL parameter'\n        });\n    }\n    \n    // Strategy 2: Current hostname and pathname\n    let currentHostStrategy = 'wss://' + window.location.hostname + window.location.pathname;\n    // Remove trailing slash and add websocket path if needed\n    currentHostStrategy = currentHostStrategy.replace(/\\/$/, '') + '/ws';\n    fallbackStrategies.push({\n        url: currentHostStrategy,\n        description: 'current hostname and pathname'\n    });\n    \n    // Strategy 3: Hermes fallback\n    fallbackStrategies.push({\n        url: 'wss://hermes.nntin.xyz/dzone',\n        description: 'Hermes fallback server'\n    });\n\n    let currentStrategyIndex = 0;\n\n    function tryNextWebsocketConnection(): void {\n        if (currentStrategyIndex >= fallbackStrategies.length) {\n            gameLogger.error('All websocket connection strategies failed', {\n                totalStrategies: fallbackStrategies.length,\n                attemptedStrategies: fallbackStrategies.map(s => s.description)\n            });\n            return;\n        }\n\n        const strategy = fallbackStrategies[currentStrategyIndex];\n        gameLogger.info('Attempting websocket connection', { \n            strategyIndex: currentStrategyIndex + 1,\n            totalStrategies: fallbackStrategies.length,\n            description: strategy.description,\n            url: strategy.url\n        });\n\n        // Swap the comments on the next 3 lines to switch between your websocket server and a virtual one\n        ws = new WebSocket(strategy.url);\n        //const TestSocket = require('./script/engine/tester.js'),\n        //ws = new TestSocket(50, 3000);\n        \n        ws.addEventListener('message', async function(event) {\n            const data = JSON.parse(event.data);\n            gameLogger.websocketMessageReceived(data);\n            \n            if (decorator) decorator.beacon.ping();\n            \n            if (data.type === 'server-list') {\n                game.servers = data.data;\n                gameLogger.info('Received server list', { \n                    serverCount: game.servers ? Object.keys(game.servers).length : 0,\n                    servers: game.servers \n                });\n                \n                // Server button\n                game.ui.addButton({ \n                    text: 'Server', \n                    top: 3, \n                    right: 3, \n                    onPress: function() {\n                        // Close help panel if it's open\n                        if (game.helpPanel) {\n                            game.helpPanel.remove();\n                            delete game.helpPanel;\n                        }\n                        \n                        if (game.serverListPanel) {\n                            game.serverListPanel.remove();\n                            delete game.serverListPanel;\n                            return;\n                        }\n                        \n                        const joinThisServer = function(server: any) { \n                            return function() {\n                                // Check if Discord authentication is required only for passworded servers\n                                if (server.passworded && (!discordAuth || !discordAuth.isLoggedIn())) {\n                                    game.pendingServerJoin = server;\n                                    (window as any).alert('This server requires Discord authentication. Please login with Discord first.');\n                                    return;\n                                }\n                                \n                                const params = '?s=' + server.id;\n                                if (window.location.protocol !== 'file:') {\n                                    window.history.pushState(\n                                        {server: server.id},\n                                        server.id, window.location.pathname + params\n                                    );\n                                }\n                                joinServer(server);\n                                game.serverListPanel.remove();\n                                delete game.serverListPanel;\n                            }; \n                        };\n                        \n                        game.serverListPanel = game.ui.addPanel({\n                            left: 'auto', \n                            top: 'auto', \n                            w: 146, \n                            h: 28 + 21 * (Object.keys(game.servers || {}).length - 1)\n                        });\n                        \n                        let widestButton = 136;\n                        let serverButtonY = 0;\n                        let button: any;\n                        \n                        for (const sKey in game.servers) { \n                            if (!game.servers || !game.servers.hasOwnProperty(sKey)) continue;\n                            const server = game.servers[sKey];\n                            // Show lock icon for servers that require Discord OAuth (passworded servers)\n                            const serverLock = server.passworded ? ':icon-lock-small: ' : '';\n                            button = game.ui.addButton({\n                                text: serverLock + game.servers[sKey].name, \n                                left: 5, \n                                top: 5 + serverButtonY * 21,\n                                w: 136, \n                                h: 18, \n                                parent: game.serverListPanel, \n                                onPress: joinThisServer(server), \n                                disabled: game.server === server.id\n                            });\n                            widestButton = Math.max(widestButton, button.textCanvas.width + 2);\n                            serverButtonY++;\n                        }\n                        game.serverListPanel.resize(widestButton + 10, game.serverListPanel.h);\n                        game.serverListPanel.resizeChildren(widestButton, button.h);\n                        game.serverListPanel.reposition();\n                    } \n                });\n                \n                const startupServer = getStartupServer();\n                // Only require Discord auth for passworded servers\n                const serverData = game.servers?.[startupServer.id];\n                if (!serverData || !serverData.passworded || (discordAuth && discordAuth.isLoggedIn())) {\n                    joinServer(startupServer);\n                } else {\n                    game.pendingServerJoin = startupServer;\n                }\n            } else if (data.type === 'server-join') { // Initial server status\n                const requestServer = data.data.request.server;\n                localStorage.setItem('dzone-default-server', JSON.stringify({ id: requestServer }));\n                \n                gameLogger.serverJoined(requestServer, data.data.serverName);\n                \n                // Update Discord OAuth client ID if provided\n                if (data.data.clientId && discordAuth) {\n                    gameLogger.info('Setting Discord OAuth client ID from server-join', { clientId: data.data.clientId });\n                    reinitializeDiscordAuth(data.data.clientId);\n                }\n                \n                // Clean up existing event listeners to prevent memory leaks\n                cleanupEventListeners();\n                \n                game.reset();\n                game.renderer.clear();\n                const userList = data.data.users;\n                game.server = requestServer;\n                \n                // Initialize the game components\n                world = new World(game as any, Math.round(3.3 * Math.sqrt(Object.keys(userList).length)));\n                \n                // Wait for world initialization (dependencies loaded) before generating\n                await world.initializationPromise;\n                \n                // Generate the world (can be mocked in E2E tests)\n                world.generateWorld();\n                \n                decorator = new Decorator(game as any, world as any);\n                game.decorator = decorator;\n                users = new Users(game as any, world as any);\n                \n                const params = '?s=' + data.data.request.server;\n                if (window.location.protocol !== 'file:') {\n                    window.history.replaceState(\n                        data.data.request, requestServer, window.location.pathname + params\n                    );\n                }\n                const userCount = Object.keys(userList).length;\n                game.setMaxListeners(userCount + 100);\n                users.setMaxListeners(userCount + 50);\n                // Set max listeners for world and decorator to prevent memory leaks\n                if (world && world.setMaxListeners) world.setMaxListeners(userCount + 50);\n                if (decorator && decorator.setMaxListeners) decorator.setMaxListeners(userCount + 50);\n                \n                for (const uid in userList) { \n                    if (!userList.hasOwnProperty(uid)) continue;\n                    //if(uid != '86913608335773696') continue;\n                    //if(data.data[uid].status != 'online') continue;\n                    if (!userList[uid].username) continue;\n                    if (users) users.addActor(userList[uid]); // Fire and forget async call\n                    //break;\n                }\n                const actorCount = users ? Object.keys(users.actors).length : 0;\n                gameLogger.info('Actors initialized', { \n                    totalUsers: userCount, \n                    createdActors: actorCount,\n                    skippedUsers: userCount - actorCount\n                });\n                game.renderer.canvases[0].onResize();\n            } else if (data.type === 'presence') { // User status update\n                gameLogger.debug('Actor presence update', { uid: data.data.uid, presence: data.data.presence });\n                if (users) users.updateActor(data.data); // Fire and forget async call\n            } else if (data.type === 'message') { // Chatter\n                gameLogger.debug('Message received', { \n                    channel: data.data.channel, \n                    user: data.data.user?.username,\n                    messageLength: data.data.content?.length \n                });\n                users.queueMessage(data.data);\n            } else if (data.type === 'error') {\n                gameLogger.error('Server error received', { message: data.data.message });\n                (window as any).alert(data.data.message);\n                if (!game.world) joinServer({id: 'default'});\n            } else if (data.type === 'update-clientid') { // Client ID update\n                gameLogger.info('Received client ID update', { clientId: data.data.clientId });\n                if (data.data.clientId && discordAuth) {\n                    reinitializeDiscordAuth(data.data.clientId);\n                    // Show a notification to the user that the OAuth configuration has been updated\n                    if (game && game.ui) {\n                        // Create a temporary notification panel\n                        const notificationPanel = game.ui.addPanel({ \n                            left: 'auto', \n                            top: 50, \n                            w: 250, \n                            h: 60,\n                            backgroundColor: '#2c3e50'\n                        });\n                        game.ui.addLabel({ \n                            text: '\uD83D\uDD04 Discord OAuth Updated', \n                            top: 5, \n                            left: 'auto', \n                            parent: notificationPanel,\n                            color: '#ecf0f1'\n                        });\n                        game.ui.addLabel({ \n                            text: 'Discord login configuration has been updated.', \n                            top: 25, \n                            left: 5, \n                            maxWidth: 240, \n                            parent: notificationPanel,\n                            color: '#bdc3c7'\n                        });\n                        \n                        // Auto-remove the notification after 5 seconds\n                        setTimeout(function() {\n                            if (notificationPanel && notificationPanel.remove) {\n                                notificationPanel.remove();\n                            }\n                        }, 5000);\n                    }\n                }\n            } else {\n            }\n        });\n        \n        ws.addEventListener('open', function() { \n            gameLogger.websocketConnected(strategy.url);\n        });\n        \n        ws.addEventListener('close', function() {\n            gameLogger.websocketDisconnected(`Strategy: ${strategy.description}`);\n            cleanupEventListeners();\n            // Only try next strategy if we haven't already moved to the next one due to an error\n            if (currentStrategyIndex === fallbackStrategies.indexOf(strategy)) {\n                currentStrategyIndex++;\n                setTimeout(tryNextWebsocketConnection, 1000); // Wait 1 second before trying next strategy\n            }\n        });\n        \n        ws.addEventListener('error', function(err) {\n            gameLogger.warn('Websocket connection error', { \n                strategy: strategy.description,\n                strategyIndex: currentStrategyIndex + 1,\n                totalStrategies: fallbackStrategies.length,\n                error: err \n            });\n            // Only increment if we haven't already incremented due to close event\n            if (currentStrategyIndex === fallbackStrategies.indexOf(strategy)) {\n                currentStrategyIndex++;\n                setTimeout(tryNextWebsocketConnection, 1000); // Wait 1 second before trying next strategy\n            }\n        });\n    }\n\n    // Start with the first strategy\n    tryNextWebsocketConnection();\n}\n\n(window as any).onpopstate = function(event: PopStateEvent) {\n    const server = { id: event.state?.server };\n    joinServer(server);\n};\n\nexport function joinServer(server: { id: string }): void {\n    const connectionMessage: any = { type: 'connect', data: { server: server.id } };\n    \n    // Find the server data by looking through all servers for matching ID\n    let serverData = null;\n    if (game.servers) {\n        for (const discordId in game.servers) {\n            if (game.servers.hasOwnProperty(discordId) && game.servers[discordId].id === server.id) {\n                serverData = game.servers[discordId];\n                break;\n            }\n        }\n    }\n    \n    gameLogger.debug('Server lookup for connection', {\n        requestedServerId: server.id,\n        foundServerData: serverData ? { id: serverData.id, passworded: serverData.passworded } : null,\n        serverCount: game.servers ? Object.keys(game.servers).length : 0\n    });\n    \n    // Only send Discord OAuth token for passworded servers\n    if (serverData && serverData.passworded && discordAuth && discordAuth.isLoggedIn()) {\n        connectionMessage.data.discordToken = discordAuth.accessToken;\n        connectionMessage.data.discordUser = discordAuth.getUser();\n        gameLogger.info('Sending Discord OAuth data for passworded server', {\n            tokenLength: discordAuth.accessToken ? discordAuth.accessToken.length : 0,\n            hasUser: !!discordAuth.getUser(),\n            serverId: server.id\n        });\n    } else {\n        gameLogger.debug('Not sending Discord OAuth data', {\n            serverFound: !!serverData,\n            serverPassworded: serverData ? serverData.passworded : 'unknown',\n            discordAuthExists: !!discordAuth,\n            discordLoggedIn: discordAuth ? discordAuth.isLoggedIn() : false\n        });\n    }\n    \n    gameLogger.info('Requesting to join server', {\n        serverId: server.id,\n        hasDiscordAuth: !!connectionMessage.data.discordToken\n    });\n    ws.send(JSON.stringify(connectionMessage));\n}\n\nexport function getStartupServer(): { id: string } {\n    // Get startup server, first checking URL params, then localstorage\n    let startupServer: any = { id: util.getURLParameter('s') }; // Check URL params\n    if (!startupServer.id) {\n        const stored = localStorage.getItem('dzone-default-server'); // Check localstorage\n        if (stored) startupServer = JSON.parse(stored);\n    }\n    if (!startupServer/* || !game.servers[startupServer.id]*/) startupServer = { id: 'default' };\n    // Remove password parameter support since we use Discord OAuth\n    return startupServer;\n}\n\n//setTimeout(function() { game.paused = true; },1000);\n\n// Export util for testing\nexport { util };\n\n// Main app initialization function - call this to start the app\nexport function startApp(): void {\n    // TODO: Loading screen while preloading images, connecting to websocket, and generating world\n    gameLogger.info('Starting D-Zone application', { version: packageInfo.version });\n    version = packageInfo.version;\n    preloader = new Preloader(initGame);\n}\n\n// Auto-start the app if this module is being run in the browser (not being imported for testing)\nif (typeof window !== 'undefined' && typeof document !== 'undefined') {\n    startApp();\n    // Make joinServer available globally for E2E testing\n    (window as any).joinServer = joinServer;\n}", "'use strict';\n\nimport { EventEmitter } from 'events';\nimport { gameLogger } from '../../gameLogger.js';\n\ninterface UserData {\n    uid: string;\n    username: string;\n    status: string;\n    roleColor?: string;\n    delete?: boolean;\n}\n\ninterface MessageData {\n    uid: string;\n    message: string;\n    channel: string;\n}\n\ninterface QueuedMessage {\n    uid: string;\n    message: string;\n}\n\ninterface MessageChannel {\n    busy: boolean;\n    messages: QueuedMessage[];\n}\n\ninterface Actor {\n    uid: string;\n    position: { x: number; y: number; z: number };\n    addToGame(game: any): void;\n    updatePresence(status: string): void;\n    startTalking(message: string, channel: string, callback: () => void): void;\n    remove(): void;\n}\n\ninterface World {\n    randomEmptyGrid(): string;\n}\n\ninterface Game {\n    users?: Users;\n    once(event: string, callback: Function): void;\n}\n\nlet ActorClass: any;\nlet ActorLoadPromise: Promise<void> | null = null;\n\nexport default class Users extends EventEmitter {\n    game: Game;\n    world: World;\n    actors: Record<string, Actor> = {};\n    messageQueue: Record<string, MessageChannel> = {};\n\n    constructor(game: Game, world: World) {\n        super();\n        this.setMaxListeners(0);\n        this.game = game;\n        this.game.once('destroy', this.destroy.bind(this));\n        this.game.users = this;\n        this.world = world;\n        this.actors = {};\n        this.messageQueue = {};\n        \n        // Start loading the Actor class immediately\n        ActorLoadPromise = this.loadActor();\n    }\n\n    private async loadActor(): Promise<void> {\n        try {\n            const ActorModule = await import('./actor.js');\n            ActorClass = ActorModule.default;\n        } catch (error) {\n            gameLogger.error('Failed to load Actor class', { \n                error: error instanceof Error ? error.message : String(error) \n            });\n            throw error;\n        }\n    }\n\n    async addActor(data: UserData): Promise<void> {\n        // Wait for Actor class to load if it hasn't already\n        if (!ActorClass && ActorLoadPromise) {\n            await ActorLoadPromise;\n        }\n\n        if (!ActorClass) {\n            gameLogger.error('Actor class not loaded yet');\n            return;\n        }\n\n        const grid = this.world.randomEmptyGrid();\n        const actor = new ActorClass({\n            x: +grid.split(':')[0],\n            y: +grid.split(':')[1],\n            z: 0,\n            uid: data.uid,\n            username: data.username,\n            roleColor: data.roleColor,\n            maxListeners: this.getMaxListeners() + 3\n        }) as Actor;\n        \n        this.actors[actor.uid] = actor;\n        actor.addToGame(this.game);\n        actor.updatePresence(data.status);\n    }\n\n    async updateActor(data: UserData): Promise<void> {\n        const actor = this.actors[data.uid];\n        if(actor) {\n            if(data.delete) {\n                actor.updatePresence('offline');\n                this.removeActor(actor);\n            } else {\n                actor.updatePresence(data.status);\n            }\n        } else {\n            await this.addActor(data);\n        }\n    }\n\n    removeActor(actor: Actor): void {\n        delete this.actors[actor.uid];\n        actor.remove();\n    }\n\n    queueMessage(data: MessageData): void {\n        if(!data.message || !this.actors[data.uid]) return;\n        if(!this.messageQueue[data.channel]) {\n            this.messageQueue[data.channel] = { busy: false, messages: [] };\n        }\n        this.messageQueue[data.channel].messages.push({\n            uid: data.uid,\n            message: data.message\n        });\n        this.onMessageAdded(data.channel);\n    }\n\n    onMessageAdded(channel: string): void {\n        const queue = this.messageQueue[channel];\n        if(queue.busy || queue.messages.length < 1) return;\n        \n        queue.busy = true;\n        const message = queue.messages[0];\n        const self = this;\n        \n        this.actors[message.uid].startTalking(message.message, channel, function() {\n            self.messageQueue[channel].messages.shift();\n            self.messageQueue[channel].busy = false;\n            self.onMessageAdded(channel);\n        });\n        \n        this.emit('message', { user: this.actors[message.uid], channel: channel });\n    }\n\n    getActorAtPosition(x: number, y: number, z: number): Actor | undefined { // For debugging\n        for(const aKey in this.actors) {\n            if(!this.actors.hasOwnProperty(aKey)) continue;\n            if(this.actors[aKey].position.x == x\n                && this.actors[aKey].position.y == y\n                && this.actors[aKey].position.z == z) {\n                return this.actors[aKey];\n            }\n        }\n        return undefined;\n    }\n\n    destroy(): void {\n        this.actors = {};\n        this.messageQueue = {};\n    }\n}", "'use strict';\n\nimport { EventEmitter } from 'events';\nimport { gameLogger } from '../../gameLogger.js';\n\ninterface DiscordOAuthOptions {\n    clientId: string;\n    redirectUri?: string;\n    scopes?: string[];\n}\n\ninterface DiscordUser {\n    id: string;\n    username: string;\n    discriminator: string;\n    avatar?: string;\n    [key: string]: any;\n}\n\ninterface TokenData {\n    access_token: string;\n    expires_in?: number;\n}\n\ninterface AuthSuccessMessage {\n    type: 'discord-auth-success';\n    accessToken: string;\n    state: string;\n    expiresIn?: number;\n}\n\ninterface AuthErrorMessage {\n    type: 'discord-auth-error';\n    error: string;\n}\n\nexport class DiscordOAuth extends EventEmitter {\n    clientId: string;\n    redirectUri: string;\n    scopes: string[];\n    state: string;\n    accessToken: string | null = null;\n    user: DiscordUser | null = null;\n\n    constructor(options: DiscordOAuthOptions) {\n        super();\n        this.clientId = options.clientId;\n        this.redirectUri = options.redirectUri || window.location.origin + '/discord-callback.html';\n        this.scopes = options.scopes || ['identify'];\n        this.state = this.generateState();\n        \n        // Check for existing token in localStorage\n        this.loadStoredAuth();\n    }\n\n    generateState(): string {\n        return Math.random().toString(36).substring(2, 15) + Math.random().toString(36).substring(2, 15);\n    }\n\n    getAuthUrl(): string {\n        const params = new URLSearchParams({\n            client_id: this.clientId,\n            redirect_uri: this.redirectUri,\n            response_type: 'token', // Use implicit flow instead of authorization code\n            scope: this.scopes.join(' '),\n            state: this.state\n        });\n        \n        return 'https://discord.com/api/oauth2/authorize?' + params.toString();\n    }\n\n    login(): void {\n        const authUrl = this.getAuthUrl();\n        gameLogger.info('Starting Discord OAuth login', { authUrl });\n        \n        // Store state for verification\n        localStorage.setItem('discord_oauth_state', this.state);\n        \n        // Open Discord OAuth in a popup window\n        const popup = window.open(authUrl, 'discord_oauth', 'width=500,height=700,scrollbars=yes');\n        \n        if (!popup) {\n            gameLogger.error('Discord OAuth popup was blocked by browser');\n            this.emit('login-error', 'Popup was blocked by browser. Please allow popups for this site.');\n            return;\n        }\n        \n        gameLogger.debug('Discord OAuth popup opened successfully');\n        \n        const self = this;\n        \n        // Listen for messages from the popup\n        const messageHandler = (event: MessageEvent) => {\n            gameLogger.debug('Received message from Discord OAuth popup', { \n                type: event.data?.type, \n                origin: event.origin \n            });\n            \n            if (event.origin !== window.location.origin) {\n                gameLogger.debug('Ignoring message from different origin', { \n                    expectedOrigin: window.location.origin, \n                    receivedOrigin: event.origin \n                });\n                return;\n            }\n            \n            const data = event.data as AuthSuccessMessage | AuthErrorMessage;\n            \n            if (data.type === 'discord-auth-success') {\n                const successData = data as AuthSuccessMessage;\n                const accessToken = successData.accessToken;\n                const state = successData.state;\n                const expiresIn = successData.expiresIn;\n                \n                gameLogger.info('Discord OAuth success received', { \n                    accessTokenLength: accessToken ? accessToken.length : 0,\n                    state: state\n                });\n                \n                window.removeEventListener('message', messageHandler);\n                \n                if (state !== self.state) {\n                    gameLogger.error('Discord OAuth state mismatch', { \n                        expected: self.state, \n                        received: state \n                    });\n                    self.emit('login-error', 'Invalid state parameter');\n                    return;\n                }\n                \n                if (accessToken) {\n                    self.accessToken = accessToken;\n                    self.storeAuth({ access_token: accessToken, expires_in: expiresIn });\n                    self.fetchUserInfo();\n                } else {\n                    gameLogger.error('No access token in Discord OAuth success message');\n                    self.emit('login-error', 'No access token received');\n                }\n            } else if (data.type === 'discord-auth-error') {\n                const errorData = data as AuthErrorMessage;\n                gameLogger.error('Discord OAuth error received', { error: errorData.error });\n                window.removeEventListener('message', messageHandler);\n                self.emit('login-error', errorData.error);\n            }\n        };\n        \n        window.addEventListener('message', messageHandler);\n        \n        // Fallback: Check if popup was closed\n        const pollTimer = setInterval(() => {\n            if (popup.closed) {\n                gameLogger.info('Discord OAuth popup was closed by user');\n                clearInterval(pollTimer);\n                window.removeEventListener('message', messageHandler);\n                self.emit('login-cancelled');\n            }\n        }, 1000);\n    }\n\n    fetchUserInfo(): void {\n        const self = this;\n        \n        fetch('https://discord.com/api/users/@me', {\n            headers: {\n                'Authorization': 'Bearer ' + this.accessToken\n            }\n        })\n        .then(response => response.json())\n        .then((user: DiscordUser) => {\n            self.user = user;\n            // Store user info in localStorage\n            localStorage.setItem('discord_user', JSON.stringify(user));\n            self.emit('login-success', user);\n        })\n        .catch((error: Error) => {\n            self.emit('login-error', error.message);\n        });\n    }\n\n    logout(): void {\n        this.accessToken = null;\n        this.user = null;\n        localStorage.removeItem('discord_auth_token');\n        localStorage.removeItem('discord_auth_expires');\n        localStorage.removeItem('discord_user');\n        this.emit('logout');\n    }\n\n    storeAuth(tokenData: TokenData): void {\n        localStorage.setItem('discord_auth_token', tokenData.access_token);\n        if (tokenData.expires_in) {\n            const expiresAt = Date.now() + (tokenData.expires_in * 1000);\n            localStorage.setItem('discord_auth_expires', expiresAt.toString());\n        }\n    }\n\n    loadStoredAuth(): void {\n        const token = localStorage.getItem('discord_auth_token');\n        const expiresAt = localStorage.getItem('discord_auth_expires');\n        const userData = localStorage.getItem('discord_user');\n        \n        if (token && (!expiresAt || Date.now() < parseInt(expiresAt))) {\n            this.accessToken = token;\n            if (userData) {\n                try {\n                    this.user = JSON.parse(userData);\n                } catch (e) {\n                    // Invalid user data, ignore\n                }\n            }\n            \n            // Verify token is still valid by fetching user info\n            if (this.accessToken && !this.user) {\n                this.fetchUserInfo();\n            }\n        } else {\n            // Token expired or doesn't exist\n            this.logout();\n        }\n    }\n\n    isLoggedIn(): boolean {\n        return !!(this.accessToken && this.user);\n    }\n\n    getUser(): DiscordUser | null {\n        return this.user;\n    }\n\n    getAvatarUrl(size: number = 128): string | null {\n        if (!this.user || !this.user.avatar) return null;\n        return `https://cdn.discordapp.com/avatars/${this.user.id}/${this.user.avatar}.png?size=${size}`;\n    }\n}\n\nexport default DiscordOAuth;", "'use strict';\n\nimport util from '../common/util.js';\nimport { EventEmitter } from 'events';\nimport BetterCanvas from '../common/bettercanvas.js';\nimport { gameLogger } from '../../gameLogger.js';\n\ninterface CanvasOptions {\n    id: string;\n    game: any; // Will be properly typed later\n    backgroundColor: string;\n    initialScale: number;\n}\n\ninterface PanningState {\n    buttons: string[];\n    origin: { x: number; y: number };\n    panned: { x: number; y: number };\n}\n\ninterface MouseEvent {\n    button: string;\n    x: number;\n    y: number;\n}\n\ninterface WheelEvent {\n    direction: 'up' | 'down';\n}\n\ninterface ResizeEvent {\n    scale: number;\n    width: number;\n    height: number;\n}\n\ninterface BGCanvas {\n    x: number;\n    y: number;\n    image: HTMLCanvasElement;\n}\n\ninterface Sprite {\n    image?: string | string[] | HTMLCanvasElement;\n    hidden?: boolean;\n    position?: { z: number };\n    screen: { x: number; y: number };\n    metrics: {\n        ox?: number;\n        oy?: number;\n        w: number;\n        h: number;\n        x: number;\n        y: number;\n    };\n    keepOnScreen?: boolean;\n    stay?: boolean;\n    parent?: any;\n    grid?: string;\n}\n\nexport class Canvas extends EventEmitter {\n    id: string;\n    game: any;\n    backgroundColor: string;\n    scale: number;\n    canvases: BetterCanvas[] = [];\n    canvas!: BetterCanvas;\n    context!: CanvasRenderingContext2D;\n    width!: number;\n    height!: number;\n    halfWidth!: number;\n    halfHeight!: number;\n    panning: PanningState;\n    images?: Record<string, HTMLCanvasElement | Record<string, HTMLCanvasElement>>;\n\n    constructor(options: CanvasOptions) {\n        super();\n        this.id = options.id;\n        this.game = options.game;\n        this.backgroundColor = options.backgroundColor;\n        this.scale = options.initialScale;\n        \n        for (let s = 1; s < 5; s++) {\n            const newCanvas = new BetterCanvas(1, 1);\n            newCanvas.canvas.id = this.id + s;\n            document.body.appendChild(newCanvas.canvas);\n            newCanvas.canvas.style.transform = `scale(${s}, ${s})`;\n            const context = newCanvas.context as any;\n            if (context.mozImageSmoothingEnabled !== undefined) {\n                context.mozImageSmoothingEnabled = false;\n            }\n            context.imageSmoothingEnabled = false;\n            newCanvas.canvas.addEventListener(\"contextmenu\", (e) => {\n                e.preventDefault();\n            });\n            this.canvases.push(newCanvas);\n        }\n        \n        this.onZoom();\n        this.onResize();\n        window.addEventListener('resize', this.onResize.bind(this));\n        \n        this.panning = {\n            buttons: [],\n            origin: { x: 0, y: 0 },\n            panned: { x: 0, y: 32 }\n        };\n\n        const self = this;\n        \n        this.game.on('mousedown', (mouseEvent: MouseEvent) => {\n            if (self.game.ui.mouseOnElement) return;\n            if (self.panning.buttons.length === 0) {\n                self.panning.origin.x = mouseEvent.x;\n                self.panning.origin.y = mouseEvent.y;\n            }\n            self.panning.buttons.push(mouseEvent.button);\n        });\n        \n        this.game.on('mouseup', (mouseEvent: MouseEvent) => {\n            util.findAndRemove(mouseEvent.button, self.panning.buttons);\n        });\n        \n        this.game.on('mousemove', (mouseEvent: MouseEvent) => {\n            const dx = mouseEvent.x - self.panning.origin.x;\n            const dy = mouseEvent.y - self.panning.origin.y;\n            if (self.panning.buttons.length > 0) {\n                self.panning.panned.x += dx;\n                self.panning.panned.y += dy;\n            }\n            self.panning.origin.x = mouseEvent.x;\n            self.panning.origin.y = mouseEvent.y;\n        });\n\n        // Touch handling\n        this.game.on('touchstart', (mouseEvent: MouseEvent) => {\n            if (self.game.ui.mouseOnElement) return;\n            if (self.panning.buttons.length === 0) {\n                self.panning.origin.x = mouseEvent.x;\n                self.panning.origin.y = mouseEvent.y;\n            }\n            self.panning.buttons.push(mouseEvent.button);\n        });\n\n        this.game.on('touchend', (mouseEvent: MouseEvent) => {\n            util.findAndRemove(mouseEvent.button, self.panning.buttons);\n        });\n\n        this.game.on('touchmove', (mouseEvent: MouseEvent) => {\n            const dx = mouseEvent.x - self.panning.origin.x;\n            const dy = mouseEvent.y - self.panning.origin.y;\n            if (self.panning.buttons.length > 0) {\n                self.panning.panned.x += dx;\n                self.panning.panned.y += dy;\n            }\n            self.panning.origin.x = mouseEvent.x;\n            self.panning.origin.y = mouseEvent.y;\n        });\n\n        this.game.on('mouseout', (mouseEvent: MouseEvent) => {\n            // Handle mouseout if needed\n        });\n        \n        this.game.on('mouseover', (mouseEvent: MouseEvent) => {\n            self.panning.origin.x = mouseEvent.x;\n            self.panning.origin.y = mouseEvent.y;\n            if (!mouseEvent.button) self.panning.buttons = [];\n        });\n        \n        this.game.on('mousewheel', (mouseEvent: WheelEvent) => {\n            const newScale = util.clamp(self.scale + (mouseEvent.direction === 'up' ? 1 : -1), 1, 4);\n            if (newScale === self.scale) return;\n            self.scale = newScale;\n            self.onZoom();\n            self.onResize();\n        });\n    }\n\n    setRenderer(renderer: any): void {\n        this.images = renderer.images;\n    }\n\n    onResize(): void {\n        this.width = this.canvas.canvas.width = Math.ceil(window.innerWidth / this.scale);\n        this.height = this.canvas.canvas.height = Math.ceil(window.innerHeight / this.scale);\n        this.halfWidth = Math.round(this.width / 2);\n        this.halfHeight = Math.round(this.height / 2);\n        this.emit('resize', { scale: this.scale, width: this.width, height: this.height });\n    }\n\n    onZoom(): void {\n        for (let s = 0; s < this.canvases.length; s++) {\n            if (s + 1 === this.scale) {\n                this.canvases[s].canvas.style.zIndex = '5';\n                this.canvas = this.canvases[s];\n                this.context = this.canvas.context;\n            } else {\n                this.canvases[s].canvas.style.zIndex = '1';\n            }\n        }\n    }\n\n    draw(): void {\n        // This method is now simplified - actual rendering logic moved to renderer\n        // Kept for compatibility but actual rendering now happens in renderer.ts\n    }\n\n    drawStatic(staticCanvas: HTMLCanvasElement): void {\n        this.context.drawImage(staticCanvas, 0, 0);\n    }\n\n    drawBG(bgCanvas: BGCanvas): void {\n        if (!bgCanvas || !bgCanvas.image) {\n            gameLogger.error('Canvas drawBG: No bgCanvas or bgCanvas.image');\n            return;\n        }\n        \n        const x = bgCanvas.x + this.halfWidth + this.panning.panned.x;\n        const y = bgCanvas.y + this.halfHeight + this.panning.panned.y;\n\n        if (x >= this.width || y >= this.height\n            || x * -1 >= bgCanvas.image.width || y * -1 >= bgCanvas.image.height) {\n            return; // BG canvas is out of frame\n        }\n        \n        const canvasStart = {\n            x: Math.max(0, x), \n            y: Math.max(0, y)\n        };\n        \n        const canvasClipped = {\n            w: Math.min(bgCanvas.image.width, this.width, this.width - x),\n            h: Math.min(bgCanvas.image.height, this.height, this.height - y)\n        };\n        \n        const bgStart = {\n            x: Math.max(0, x * -1), \n            y: Math.max(0, y * -1)\n        };\n        \n        const bgEnd = {\n            x: Math.min(bgCanvas.image.width, bgStart.x + canvasClipped.w),\n            y: Math.min(bgCanvas.image.height, bgStart.y + canvasClipped.h)\n        };\n        \n        const clipped = {\n            x: bgEnd.x - bgStart.x, \n            y: bgEnd.y - bgStart.y\n        };\n        \n        this.context.drawImage(\n            bgCanvas.image, bgStart.x, bgStart.y, clipped.x, clipped.y,\n            canvasStart.x, canvasStart.y, clipped.x, clipped.y\n        );\n    }\n\n    drawEntity(sprite: Sprite): void {\n        if (!sprite || !sprite.image || sprite.hidden) return;\n        if (sprite.position && sprite.position.z > this.game.hideZ) return;\n                \n        const screen = {\n            x: sprite.screen.x + this.halfWidth + this.panning.panned.x + (sprite.metrics.ox || 0),\n            y: sprite.screen.y + this.halfHeight + this.panning.panned.y + (sprite.metrics.oy || 0)\n        };\n        \n        if (sprite.keepOnScreen) {\n            screen.x = Math.min(this.width - sprite.metrics.w, Math.max(0, screen.x));\n            screen.y = Math.min(this.height - sprite.metrics.h, Math.max(0, screen.y));\n        }\n        \n        if (screen.x >= this.width || screen.y >= this.height\n            || screen.x + sprite.metrics.w <= 0 || screen.y + sprite.metrics.h <= 0) return;\n\n        let image: HTMLCanvasElement;\n        if (Array.isArray(sprite.image)) {\n            const colorCollection = this.images![sprite.image[0]] as Record<string, HTMLCanvasElement>;\n            if (!colorCollection) {\n                gameLogger.error('Canvas drawEntity: Color collection not found', {\n                    requestedCollection: sprite.image[0],\n                    availableImages: Object.keys(this.images!)\n                });\n                return;\n            }\n            image = colorCollection[sprite.image[1]];\n            if (!image) {\n                gameLogger.error('Canvas drawEntity: Colored sprite not found', {\n                    requestedSprite: sprite.image,\n                    availableInCollection: Object.keys(colorCollection)\n                });\n                return;\n            }\n        } else if (typeof sprite.image === 'string') {\n            image = this.images![sprite.image] as HTMLCanvasElement;\n            if (!image) {\n                gameLogger.error('Canvas drawEntity: Image not found', {\n                    requestedImage: sprite.image,\n                    availableImages: Object.keys(this.images!)\n                });\n                return;\n            }\n        } else {\n            image = sprite.image;\n        }\n        \n        const highlight = sprite === this.game.mouseOver?.sprite;\n        if (highlight) {\n            this.context.save();\n            this.context.shadowColor = 'rgba(255,255,255,1)';\n            this.context.shadowBlur = 3;\n        }\n        \n        if (!sprite.stay && sprite.parent && this.game.mouseOver !== sprite.parent) return;\n        \n        // Debug: Check for NaN values before drawing\n        const hasNaNValues = !isFinite(screen.x) || !isFinite(screen.y) || \n                            !isFinite(sprite.metrics.x) || !isFinite(sprite.metrics.y) || \n                            !isFinite(sprite.metrics.w) || !isFinite(sprite.metrics.h);\n        \n        if (hasNaNValues) {\n            gameLogger.error('Canvas drawEntity: NaN detected in coordinates', {\n                spriteType: sprite.constructor?.name || 'unknown',\n                spriteParent: sprite.parent?.constructor?.name || 'no parent',\n                spriteParentUsername: sprite.parent?.username || 'no username',\n                spriteParentPosition: sprite.parent?.position || 'no position',\n                spriteImage: typeof sprite.image === 'string' ? sprite.image : 'canvas object',\n                screen: { x: screen.x, y: screen.y },\n                metrics: sprite.metrics,\n                drawImageParams: [\n                    sprite.metrics.x, sprite.metrics.y, sprite.metrics.w, sprite.metrics.h,\n                    Math.round(screen.x), Math.round(screen.y), sprite.metrics.w, sprite.metrics.h\n                ]\n            });\n            // Skip rendering this sprite to prevent crashes\n            return;\n        }\n        \n        this.canvas.drawImage(\n            image, sprite.metrics.x, sprite.metrics.y, sprite.metrics.w, sprite.metrics.h,\n            Math.round(screen.x), Math.round(screen.y), sprite.metrics.w, sprite.metrics.h\n        );\n        \n        if (highlight) {\n            this.context.restore();\n        }\n        \n        if (this.game.showGrid && sprite.grid) { // Show tile grid\n            this.context.fillStyle = '#bbbbbb';\n            this.context.font = '9px Arial';\n            this.context.fillText(sprite.grid, Math.round(screen.x) + 5, Math.round(screen.y) + 9);\n        }\n    }\n}\n\nexport default Canvas;", "import { EventEmitter } from 'events';\nimport { gameLogger } from '../../gameLogger.js';\nimport util from '../common/util.js';\nimport { Input } from './input.js';\n\ninterface GameOptions {\n    step?: number;\n}\n\ninterface Task {\n    type: 'repeat' | 'once' | 'deleted';\n    start?: number;\n    count?: number;\n    cb: (data?: any) => void;\n    afterCB?: () => void;\n    tick?: number;\n}\n\ninterface MouseEvent {\n    button: string;\n    x: number;\n    y: number;\n    centerMouseX?: number;\n    centerMouseY?: number;\n}\n\ninterface KeyEvent {\n    key: string;\n}\n\ninterface ResizeEvent {\n    width: number;\n    height: number;\n    scale: number;\n}\n\ninterface GameCanvas {\n    canvas: {\n        canvas: HTMLCanvasElement;\n    };\n    scale: number;\n    width: number;\n    height: number;\n    on(event: string, callback: (data: any) => void): void;\n}\n\n// Performance timing function\nconst now = (() => {\n    if (typeof performance !== 'undefined' && performance.now) {\n        return () => performance.now();\n    }\n    return () => Date.now();\n})();\n\nexport class Game extends EventEmitter {\n    step: number;\n    lastUpdate: number = 0;\n    dt: number = 0;\n    ticks: number = 0;\n    crashed?: boolean;\n    paused?: boolean;\n    \n    input: Input;\n    mouseButtons: string[] = [];\n    centerMouseX: number = -999;\n    centerMouseY: number = -999;\n    mouseX?: number;\n    mouseY?: number;\n    mouseOut?: boolean;\n    mouseOver?: any;\n    \n    entities: any[] = [];\n    schedule: Task[] = [];\n    \n    viewWidth?: number;\n    viewHeight?: number;\n    \n    interval: NodeJS.Timeout;\n    \n    // Optional properties that may be set externally\n    renderer?: any;\n    ui?: any;\n    users?: any;\n    servers?: Record<string, any>;\n    server?: string;\n    world?: any;\n    timeUpdates?: boolean;\n    timeRenders?: boolean;\n    showGrid?: boolean;\n    helpPanel?: any;\n    helpButton?: any;\n    serverListPanel?: any;\n    pendingServerJoin?: any;\n    decorator?: any;\n    hideZ?: number;\n\n    constructor(options: GameOptions = {}) {\n        super();\n        this.setMaxListeners(0);\n        this.step = options.step || 1000 / 60;\n\n        this.input = new Input();\n        this.input.on('keydown', this.keydown.bind(this));\n        this.input.on('keyup', this.keyup.bind(this));\n\n        const self = this;\n        this.interval = setInterval(function() {\n            if (self.crashed) return;\n            const rightNow = now();\n            self.dt += rightNow - self.lastUpdate;\n            if (self.lastUpdate > 0 && self.dt > 60000) {\n                gameLogger.error('Game engine: Too many updates missed, crashing', {\n                    deltaTime: self.dt,\n                    lastUpdate: self.lastUpdate,\n                    currentTime: rightNow\n                });\n                self.crashed = true; \n                self.paused = true;\n            }\n            if (self.dt > self.step) {\n                while (self.dt >= self.step) {\n                    self.dt -= self.step;\n                    if (self.paused) continue;\n                    self.ticks++;\n                    self.update();\n                }\n            }\n            self.lastUpdate = now();\n        }, this.step);\n    }\n\n    update(): void {\n        const timeThis = this.timeUpdates && (this.ticks & 255) === 0;\n        if (timeThis) console.time('update');\n        \n        this.emit('update');\n        \n        // TODO: Move scheduling to entity?\n        for (let i = 0; i < this.schedule.length; i++) {\n            const task = this.schedule[i];\n            let endTick: number | undefined;\n            \n            if (task.type === 'repeat') {\n                endTick = task.start! + task.count!;\n                if (task.start! <= this.ticks) {\n                    const ticks = this.ticks - task.start!;\n                    const percent = task.count! > 0 ? ticks / task.count! : 1; // Prevent division by zero\n                    \n                    // Additional safety check\n                    if (!isFinite(percent)) {\n                        gameLogger.error('Game update: Invalid progress calculation', {\n                            ticks,\n                            taskCount: task.count,\n                            taskStart: task.start,\n                            gameTicks: this.ticks,\n                            percent\n                        });\n                        // Mark task for deletion to prevent further issues\n                        task.type = 'deleted';\n                        continue;\n                    }\n                    \n                    task.cb({ ticks: ticks, percent: percent });\n                }\n            } else if (task.type === 'once') {\n                endTick = task.tick;\n            }\n            \n            if (task.type === 'deleted' || (endTick !== undefined && endTick <= this.ticks)) {\n                if (task.type === 'once') task.cb();\n                else if (task.type === 'repeat' && task.afterCB) task.afterCB();\n                this.schedule.splice(i, 1);\n                i--;\n            }\n        }\n        \n        this.emit('render');\n        if (timeThis) console.timeEnd('update');\n    }\n\n    bindCanvas(canvas: GameCanvas): void {\n        this.input.bindCanvas(canvas);\n        this.viewWidth = canvas.width;\n        this.viewHeight = canvas.height;\n        this.input.on('mousemove', this.mousemove.bind(this));\n        this.input.on('mousedown', this.mousedown.bind(this));\n        this.input.on('mouseup', this.mouseup.bind(this));\n        this.input.on('mouseout', this.mouseout.bind(this));\n        this.input.on('mouseover', this.mouseover.bind(this));\n        this.input.on('mousewheel', this.mousewheel.bind(this));\n\n        this.input.on('touchmove', this.touchmove.bind(this));\n        this.input.on('touchstart', this.touchstart.bind(this));\n        this.input.on('touchend', this.touchend.bind(this));\n        this.input.on('touchcancel', this.touchcancel.bind(this));\n        canvas.on('resize', this.viewResize.bind(this));\n    }\n\n    viewResize(resize: ResizeEvent): void {\n        this.viewWidth = resize.width;\n        this.viewHeight = resize.height;\n        this.input.mouseScale = resize.scale;\n        \n        // Log canvas resize event for E2E testing\n        gameLogger.canvasResize(resize.width, resize.height);\n        \n        this.emit('resize', resize);\n    }\n\n    mousemove(mouseEvent: MouseEvent): void {\n        if (this.mouseOut) return;\n        this.mouseX = mouseEvent.x;\n        this.mouseY = mouseEvent.y;\n        this.centerMouseX = Math.floor(mouseEvent.x - (this.viewWidth || 0) / 2);\n        this.centerMouseY = Math.floor(mouseEvent.y - (this.viewHeight || 0) / 2);\n        mouseEvent.centerMouseX = this.centerMouseX;\n        mouseEvent.centerMouseY = this.centerMouseY;\n        this.emit('mousemove', mouseEvent);\n    }\n\n    mousedown(mouseEvent: MouseEvent): void {\n        if (this.mouseOver) {\n            gameLogger.debug('Game mousedown: Target selected', {\n                target: this.mouseOver.constructor?.name || 'unknown',\n                position: this.mouseOver.position || null\n            });\n            (window as any).actor = this.mouseOver;\n        }\n        this.mouseButtons.push(mouseEvent.button);\n        this.emit('mousedown', mouseEvent);\n    }\n\n    touchend(mouseEvent: MouseEvent): void {\n        util.findAndRemove(mouseEvent.button, this.mouseButtons);\n        this.emit('touchend', mouseEvent);\n    }\n\n    touchmove(mouseEvent: MouseEvent): void {\n        if (this.mouseOut) return;\n        this.mouseOut = false;\n        this.mouseX = mouseEvent.x;\n        this.mouseY = mouseEvent.y;\n        this.centerMouseX = Math.floor(mouseEvent.x - (this.viewWidth || 0) / 2);\n        this.centerMouseY = Math.floor(mouseEvent.y - (this.viewHeight || 0) / 2);\n        mouseEvent.centerMouseX = this.centerMouseX;\n        mouseEvent.centerMouseY = this.centerMouseY;\n        this.emit('touchmove', mouseEvent);\n    }\n\n    touchcancel(mouseEvent: MouseEvent): void {\n        this.mouseOut = true;\n        this.mouseOver = false;\n        this.emit('touchcancel', mouseEvent);\n    }\n\n    touchstart(mouseEvent: MouseEvent): void {\n        if (this.mouseOver) {\n            gameLogger.debug('Game touchstart: Target selected', {\n                target: this.mouseOver.constructor?.name || 'unknown',\n                position: this.mouseOver.position || null\n            });\n            (window as any).actor = this.mouseOver;\n        }\n        this.mouseButtons.push(mouseEvent.button);\n        this.emit('touchstart', mouseEvent);\n    }\n\n    mouseup(mouseEvent: MouseEvent): void {\n        util.findAndRemove(mouseEvent.button, this.mouseButtons);\n        this.emit('mouseup', mouseEvent);\n    }\n\n    mouseout(mouseEvent: MouseEvent): void {\n        this.mouseOut = true;\n        this.mouseOver = false;\n        this.emit('mouseout', mouseEvent);\n    }\n\n    mouseover(mouseEvent: MouseEvent): void {\n        this.mouseOut = false;\n        this.emit('mouseover', mouseEvent);\n    }\n\n    mousewheel(mouseEvent: any): void {\n        this.emit('mousewheel', mouseEvent);\n    }\n\n    keydown(keyEvent: KeyEvent): void {\n        this.emit('keydown', keyEvent);\n    }\n\n    keyup(keyEvent: KeyEvent): void {\n        this.emit('keyup', keyEvent);\n    }\n\n    reset(): void {\n        this.emit('destroy');\n        this.removeAllListeners('update');\n        this.schedule = [];\n        while (this.entities.length > 0) {\n            if (this.entities[0].remove) {\n                this.entities[0].remove();\n            } else {\n                this.entities.splice(0, 1);\n            }\n        }\n    }\n}\n\nexport default Game;", "'use strict';\n\nimport { EventEmitter } from 'events';\n\ninterface MouseEvent {\n    button: string;\n    x: number;\n    y: number;\n}\n\ninterface KeyEvent {\n    key: string;\n}\n\ninterface Canvas {\n    canvas: {\n        canvas: HTMLCanvasElement;\n    };\n    scale: number;\n}\n\nexport class Input extends EventEmitter {\n    mouseX: number = 0;\n    mouseY: number = 0;\n    mouseLeft: boolean = false;\n    mouseRight: boolean = false;\n    mouseOut: boolean = false;\n    keys: Record<string, boolean> = {};\n    canvas: HTMLCanvasElement | null = null;\n    mouseScale: number = 1;\n\n    constructor() {\n        super();\n        this.setMaxListeners(0);\n        document.addEventListener('keydown', this.keydown.bind(this));\n        document.addEventListener('keyup', this.keyup.bind(this));\n    }\n\n    bindCanvas(canvas: Canvas): void {\n        this.canvas = canvas.canvas.canvas; // Canvas element\n        this.mouseScale = canvas.scale;\n        window.addEventListener('mousemove', this.mousemove.bind(this));\n        window.addEventListener('mousedown', this.mousedown.bind(this));\n        window.addEventListener('mouseup', this.mouseup.bind(this));\n\n        window.addEventListener('touchmove', this.touchmove.bind(this));\n        window.addEventListener('touchstart', this.touchstart.bind(this));\n        window.addEventListener('touchend', this.touchend.bind(this));\n        window.addEventListener('touchcancel', this.touchend.bind(this)); // this is when someone cuts off your finger midtouch\n\n        document.addEventListener('mouseout', this.mouseout.bind(this));\n        document.addEventListener('mouseover', this.mouseover.bind(this));\n        const wheelSupport = 'onwheel' in document.createElement('div') ? 'wheel' : 'mousewheel';\n        window.addEventListener(wheelSupport, this.mousewheel.bind(this));\n    }\n\n    mousemove(e: Event): void {\n        const mouseEvent = e as globalThis.MouseEvent;\n        if (this.mouseOut) return;\n        this.mouseX = Math.floor(mouseEvent.pageX / this.mouseScale);\n        this.mouseY = Math.floor(mouseEvent.pageY / this.mouseScale);\n        this.emit('mousemove', { x: this.mouseX, y: this.mouseY });\n    }\n\n    touchstart(e: TouchEvent): void {\n        const touch = e.changedTouches[0];\n        this.mouseX = Math.floor(touch.pageX / this.mouseScale);\n        this.mouseY = Math.floor(touch.pageY / this.mouseScale);\n        this.emit('touchstart', { button: 'touch', x: this.mouseX, y: this.mouseY });\n    }\n\n    touchend(e: TouchEvent): void {\n        const touch = e.changedTouches[0];\n        this.emit('touchend', { button: 'touch', x: touch.pageX, y: touch.pageY });\n    }\n\n    touchmove(e: TouchEvent): void {\n        const touch = e.changedTouches[0];\n        this.mouseX = Math.floor(touch.pageX / this.mouseScale);\n        this.mouseY = Math.floor(touch.pageY / this.mouseScale);\n        this.emit('touchmove', { button: 'touch', x: this.mouseX, y: this.mouseY });\n    }\n\n    mousedown(e: Event): void {\n        const mouseEvent = e as globalThis.MouseEvent;\n        const button = buttons[mouseEvent.button];\n        switch (button) {\n            case 'left': \n                this.mouseLeft = true; \n                break;\n            case 'right': \n                this.mouseRight = true; \n                break;\n        }\n        this.emit('mousedown', { button: button, x: this.mouseX, y: this.mouseY });\n    }\n\n    mouseup(e: Event): void {\n        const mouseEvent = e as globalThis.MouseEvent;\n        const button = buttons[mouseEvent.button];\n        switch (button) {\n            case 'left': \n                this.mouseLeft = false; \n                break;\n            case 'right': \n                this.mouseRight = false; \n                break;\n        }\n        this.emit('mouseup', { button: button, x: this.mouseX, y: this.mouseY });\n    }\n\n    mouseout(e: Event): void {\n        const mouseEvent = e as globalThis.MouseEvent;\n        const button = buttons[mouseEvent.button];\n        this.mouseOut = true;\n        this.mouseX = Math.floor(mouseEvent.pageX / this.mouseScale);\n        this.mouseY = Math.floor(mouseEvent.pageY / this.mouseScale);\n        this.emit('mouseout', { x: this.mouseX, y: this.mouseY, button: button });\n    }\n\n    mouseover(e: Event): void {\n        const mouseEvent = e as globalThis.MouseEvent;\n        const buttonNumber = mouseEvent.buttons & 1 ? 1 : mouseEvent.buttons & 2 ? 2 : mouseEvent.buttons & 4 ? 3 : 0;\n        const button = buttons[buttonNumber - 1];\n        this.mouseOut = false;\n        this.mouseX = Math.floor(mouseEvent.pageX / this.mouseScale);\n        this.mouseY = Math.floor(mouseEvent.pageY / this.mouseScale);\n        this.emit('mouseover', { x: this.mouseX, y: this.mouseY, button: button });\n    }\n\n    mousewheel(e: Event): void {\n        const wheelEvent = e as WheelEvent;\n        if (!wheelEvent.deltaY) return;\n        const direction = wheelEvent.deltaY > 0 ? 'down' : 'up';\n        this.emit('mousewheel', { direction: direction, x: this.mouseX, y: this.mouseY });\n    }\n\n    keydown(e: Event): void {\n        const keyEvent = e as KeyboardEvent;\n        const key = keyEvent.keyCode >= 48 && keyEvent.keyCode <= 90 ?\n            String.fromCharCode(keyEvent.keyCode).toLowerCase() : keyCodes[keyEvent.keyCode];\n        if (key === 'backspace') keyEvent.preventDefault();\n        if (this.keys[key]) return; // Ignore if key already held\n        this.keys[key] = true;\n        this.emit('keydown', { key: key });\n    }\n\n    keyup(e: Event): void {\n        const keyEvent = e as KeyboardEvent;\n        const key = keyEvent.keyCode >= 48 && keyEvent.keyCode <= 90 ?\n            String.fromCharCode(keyEvent.keyCode).toLowerCase() : keyCodes[keyEvent.keyCode];\n        if (!this.keys[key]) return; // Ignore if key already up\n        this.keys[key] = false;\n        this.emit('keyup', { key: key });\n    }\n}\n\nconst buttons = ['left', 'middle', 'right'];\n\nconst keyCodes: Record<number, string> = {\n    37: \"left\",\n    38: \"up\",\n    39: \"right\",\n    40: \"down\",\n    45: \"insert\",\n    46: \"delete\",\n    8: \"backspace\",\n    9: \"tab\",\n    13: \"enter\",\n    16: \"shift\",\n    17: \"ctrl\",\n    18: \"alt\",\n    19: \"pause\",\n    20: \"capslock\",\n    27: \"escape\",\n    32: \"space\",\n    33: \"pageup\",\n    34: \"pagedown\",\n    35: \"end\",\n    36: \"home\",\n    112: \"f1\",\n    113: \"f2\",\n    114: \"f3\",\n    115: \"f4\",\n    116: \"f5\",\n    117: \"f6\",\n    118: \"f7\",\n    119: \"f8\",\n    120: \"f9\",\n    121: \"f10\",\n    122: \"f11\",\n    123: \"f12\",\n    144: \"numlock\",\n    145: \"scrolllock\",\n    186: \"semicolon\",\n    187: \"equal\",\n    188: \"comma\",\n    189: \"dash\",\n    190: \"period\",\n    191: \"slash\",\n    192: \"graveaccent\",\n    219: \"openbracket\",\n    220: \"backslash\",\n    221: \"closebraket\",\n    222: \"singlequote\"\n};\n\nexport default Input;", "'use strict';\n\nimport BetterCanvas from '../common/bettercanvas.js';\n\nconst imageList = ['actors', 'environment', 'static-tiles', 'props', 'font'];\n\nexport class Preloader {\n    images: Record<string, HTMLCanvasElement> = {};\n    imagesLoaded: number = 0;\n    onComplete: (images: Record<string, HTMLCanvasElement>) => void;\n\n    constructor(onComplete: (images: Record<string, HTMLCanvasElement>) => void) {\n        this.onComplete = onComplete;\n        for (let i = 0; i < imageList.length; i++) {\n            const imageName = imageList[i];\n            const fileName = imageName + '.png';\n            const image = new Image();\n            image.addEventListener('load', () => this.onImageLoad(image, imageName));\n            image.src = './img/' + fileName;\n        }\n    }\n\n    onImageLoad(image: HTMLImageElement, imageName: string): void {\n        const canvas = new BetterCanvas(image.width, image.height);\n        this.images[imageName] = canvas.canvas;\n        canvas.drawImage(image, 0, 0, image.width, image.height, 0, 0, image.width, image.height);\n        this.imagesLoaded++;\n        if (this.imagesLoaded === imageList.length) {\n            this.onComplete(this.images);\n        }\n    }\n}\n\nexport default Preloader;", "'use strict';\n\nimport { EventEmitter } from 'events';\nimport { ColorUtil } from '../common/colorutil.js';\nimport { gameLogger } from '../../gameLogger.js';\n\ninterface RendererOptions {\n    game: any;\n    images: Record<string, HTMLCanvasElement>;\n}\n\ninterface Sprite {\n    position?: {\n        z: number;\n        fakeZ: number;\n    };\n}\n\nexport class Renderer extends EventEmitter {\n    game: any;\n    images: Record<string, any>;\n    updateDrawn: boolean = false;\n    zBuffer: Record<string, Sprite[]> = {};\n    zBufferKeys: string[] = [];\n    overlay: any[] = [];\n    frames: number = 0;\n    canvases?: any[];\n    bgCanvas?: any;\n\n    constructor(options: RendererOptions) {\n        super();\n        this.game = options.game;\n        this.images = options.images;\n\n        const self = this;\n        this.game.on('render', function () {\n            self.updateDrawn = false;\n        });\n\n        const draw = () => {\n            if (self.updateDrawn === false) {\n                if (self.canvases) {\n                    const timeThis = self.game.timeRenders && (self.game.ticks & 511) === 0;\n                    if (timeThis) console.time('render');\n                    \n                    for (let c = 0; c < self.canvases.length; c++) {\n                        const canvas = self.canvases[c];\n                        // Clear canvas first\n                        canvas.canvas.fill(canvas.backgroundColor);\n                        \n                        // Draw background tiles before entities\n                        if (self.bgCanvas) {\n                            canvas.drawBG(self.bgCanvas);\n                        }\n                        \n                        // Draw connecting message if no servers\n                        if (!self.game.servers) {\n                            canvas.context.fillStyle = '#d4cfb6';\n                            canvas.context.font = '14px Arial';\n                            canvas.context.textAlign = 'center';\n                            canvas.context.fillText('connecting...', Math.round(canvas.width / 2), Math.round(canvas.height / 2 - 4));\n                        }\n                        \n                        // Draw entities\n                        let entityCount = 0;\n                        for (let z = 0; z < self.zBufferKeys.length; z++) {\n                            const zBufferDepth = self.zBuffer[self.zBufferKeys[z]];\n                            for (let zz = 0; zz < zBufferDepth.length; zz++) {\n                                canvas.drawEntity(zBufferDepth[zz]);\n                                entityCount++;\n                            }\n                        }\n                        for (let o = 0; o < self.overlay.length; o++) {\n                            canvas.drawEntity(self.overlay[o]);\n                            entityCount++;\n                        }\n                        \n                        if (self.game.ui) self.game.ui.emit('draw', canvas);\n                    }\n                    if (timeThis) console.timeEnd('render');\n                }\n                self.updateDrawn = true;\n            }\n            requestAnimationFrame(draw);\n        };\n        requestAnimationFrame(draw);\n    }\n\n    addCanvas(canvas: any): void {\n        canvas.setRenderer(this);\n        if (!this.canvases) this.canvases = [];\n        this.canvases.push(canvas);\n    }\n\n    addToZBuffer(sprite: Sprite, newZDepth: string): void {\n        const zBufferDepth = this.zBuffer[newZDepth];\n        if (zBufferDepth) {\n            zBufferDepth.push(sprite);\n            zBufferDepth.sort((a, b) => {\n                const aZ = (a.position?.z || 0) + (a.position?.fakeZ || 0);\n                const bZ = (b.position?.z || 0) + (b.position?.fakeZ || 0);\n                return aZ - bZ;\n            });\n        } else {\n            this.zBuffer[newZDepth] = [sprite];\n        }\n        this.zBufferKeys = Object.keys(this.zBuffer);\n        this.zBufferKeys.sort((a, b) => parseInt(a) - parseInt(b));\n    }\n\n    updateZBuffer(oldZDepth: string, obj: Sprite, newZDepth: string): void {\n        this.removeFromZBuffer(obj, oldZDepth);\n        this.addToZBuffer(obj, newZDepth);\n    }\n\n    removeFromZBuffer(obj: Sprite, zDepth: string): void {\n        const zBufferDepth = this.zBuffer[zDepth];\n        if (zBufferDepth) {\n            for (let i = 0; i < zBufferDepth.length; i++) {\n                if (zBufferDepth[i] === obj) {\n                    zBufferDepth.splice(i, 1);\n                    break;\n                }\n            }\n        }\n    }\n\n    addColorSheet(options: any): void {\n        if (!this.images[options.color]) this.images[options.color] = {};\n        if (this.images[options.color][options.sheet]) {\n            return;\n        }\n        options.image = this.images[options.sheet];\n        \n        if (!options.image) {\n            gameLogger.error('Renderer addColorSheet: Base image not found', {\n                requestedSheet: options.sheet,\n                availableImages: Object.keys(this.images)\n            });\n            return;\n        }\n        \n        this.images[options.color][options.sheet] = ColorUtil.colorize(options);\n    }\n\n    clear(): void {\n        this.zBuffer = {};\n        this.zBufferKeys = [];\n        this.overlay = [];\n    }\n}\n\nexport default Renderer;", "'use strict';\n\ninterface ColorizeOptions {\n    image: HTMLCanvasElement | HTMLImageElement;\n    color: string;\n    alpha: number;\n    regions?: Array<{\n        x: number;\n        y: number;\n        w: number;\n        h: number;\n        color?: string;\n        alpha?: number;\n    }>;\n}\n\nfunction applyAlpha(source: HTMLCanvasElement | HTMLImageElement, target: HTMLCanvasElement): void {\n    // Always create a temporary canvas with willReadFrequently for reading image data\n    // This is necessary because existing canvas contexts can't have their options changed\n    const sourceCanvas = document.createElement('canvas');\n    sourceCanvas.width = source.width;\n    sourceCanvas.height = source.height;\n    const sourceCtx = sourceCanvas.getContext('2d', { willReadFrequently: true })!;\n    sourceCtx.drawImage(source, 0, 0);\n    \n    const sourceData = sourceCtx.getImageData(0, 0, sourceCanvas.width, sourceCanvas.height);\n    const targetCtx = target.getContext('2d', { willReadFrequently: true })!;\n    const targetData = targetCtx.getImageData(0, 0, target.width, target.height);\n    \n    for(let p = 3; p < targetData.data.length; p += 4) {\n        targetData.data[p] = sourceData.data[p];\n    }\n    targetCtx.putImageData(targetData, 0, 0);\n}\n\nexport const ColorUtil = {\n    colorize: function(options: ColorizeOptions): HTMLCanvasElement {\n        const canvas = document.createElement('canvas');\n        canvas.width = options.image.width;\n        canvas.height = options.image.height;\n        const context = canvas.getContext('2d', { willReadFrequently: true })!;\n        context.drawImage(options.image, 0, 0, options.image.width, options.image.height,\n            0, 0, options.image.width, options.image.height);\n        context.globalCompositeOperation = 'color';\n        \n        const colorCanvas = document.createElement('canvas');\n        colorCanvas.width = options.image.width;\n        colorCanvas.height = options.image.height;\n        const colorContext = colorCanvas.getContext('2d')!;;\n        colorContext.fillStyle = options.color;\n        colorContext.globalAlpha = options.alpha;\n        colorContext.fillRect(0, 0, options.image.width, options.image.height);\n        \n        if(options.regions) { // Paint custom regions if specified\n            for(let i = 0; i < options.regions.length; i++) {\n                const reg = options.regions[i];\n                colorContext.clearRect(reg.x, reg.y, reg.w, reg.h);\n                colorContext.fillStyle = reg.color ? reg.color : options.color;\n                colorContext.globalAlpha = reg.alpha ? reg.alpha : options.alpha;\n                colorContext.fillRect(reg.x, reg.y, reg.w, reg.h);\n            }\n        }\n        context.drawImage(colorCanvas, 0, 0);\n        applyAlpha(options.image, canvas); // Restore original alpha channel\n        return canvas;\n    },\n    interpolateRGBA: function(RGBA1: string, RGBA2: string, amount: number): string {\n        const RGBA1Split = RGBA1.substring(5, RGBA1.length-2).split(',');\n        const r1 = +RGBA1Split[0], g1 = +RGBA1Split[1], b1 = +RGBA1Split[2], a1 = +RGBA1Split[3];\n        const RGBA2Split = RGBA2.substring(5, RGBA2.length-2).split(',');\n        const r2 = +RGBA2Split[0], g2 = +RGBA2Split[1], b2 = +RGBA2Split[2], a2 = +RGBA2Split[3];\n        const interpolated = [\n            Math.round((r1+(r2-r1)*amount)),\n            Math.round((g1+(g2-g1)*amount)),\n            Math.round((b1+(b2-b1)*amount)),\n            (a1+(a2-a1)*amount)\n        ];\n        return 'rgba(' + interpolated.join(',') + ')';\n    }\n};", "'use strict';\n\nimport { EventEmitter } from 'events';\nimport { gameLogger } from '../../gameLogger.js';\nimport BetterCanvas from '../common/bettercanvas.js';\nimport { geometry } from '../common/geometry.js';\nimport { util } from '../common/util.js';\n\n// We'll need to convert these dependencies or use dynamic imports\ninterface Slab {\n    grid: string;\n    position: { x: number; y: number; z: number };\n    style: string;\n    border?: boolean;\n    height: number;\n    addToGame(game: any): void;\n    remove(): void;\n}\n\ninterface Tile {\n    screen: { x: number; y: number };\n    sprite: {\n        image: string;\n        metrics: {\n            x: number;\n            y: number;\n            w: number;\n            h: number;\n            ox?: number;\n            oy?: number;\n        };\n    };\n    zDepth: number;\n}\n\ninterface WorldObject {\n    position: { x: number; y: number; z: number };\n    height: number;\n    unWalkable?: boolean;\n}\n\ninterface Game {\n    world?: World;\n    renderer: {\n        images: Record<string, HTMLCanvasElement | HTMLImageElement>;\n        bgCanvas?: {\n            x: number;\n            y: number;\n            image: HTMLCanvasElement;\n        };\n    };\n    setMaxListeners?(count: number): void;\n}\n\nlet SlabClass: any;\nlet TileClass: any;\nlet TileSheetClass: any;\nlet PathfinderClass: any;\n\nconst testCanvas = new BetterCanvas(200, 100);\nlet unoccupiedGrids: string[];\n\nexport default class World extends EventEmitter {\n    game: Game;\n    worldSize: number;\n    worldRadius: number;\n    objects: Record<number, Record<number, Record<number, WorldObject>>> = {};\n    map: Record<string, Slab> = {};\n    walkable: Record<string, number> = {};\n    mapBounds = { xl: 0, yl: 0, xh: 0, yh: 0 };\n    staticMap: Tile[] = [];\n    islands: Slab[][] = [];\n    mainIsland: number = 0;\n    tileMap: Record<string, Tile> = {};\n    initializationPromise: Promise<void>;\n    private debugOverlayRefreshScheduled: boolean = false;\n\n    constructor(game: Game, worldSize: number) {\n        super();\n        this.game = game;\n        this.game.world = this;\n        this.worldSize = Math.max(24, Math.floor(worldSize / 2) * 2); // Must be an even number >= 24\n        this.worldRadius = Math.floor(this.worldSize / 2);\n        \n        this.initializationPromise = this.init();\n    }\n\n    private async init(): Promise<void> {        \n        // Load dependencies dynamically\n        try {\n            \n            const [SlabModule, TileModule, TileSheetModule, PathfinderModule] = await Promise.all([\n                import('./slab.js'),\n                import('./tile.js'),\n                import('./sheet2.js'),\n                import('../actors/pathfinder.js')\n            ]);\n\n            SlabClass = SlabModule.default;\n            TileClass = TileModule.default;\n            TileSheetClass = TileSheetModule.default;\n            PathfinderClass = PathfinderModule.default;\n            \n            // Expose classes for E2E testing\n            if (typeof window !== 'undefined' && (window as any).__E2E_TEST_MODE) {\n                (window as any).__WorldDependencies = {\n                    Slab: SlabClass,\n                    Tile: TileClass,\n                    TileSheet: TileSheetClass,\n                    Pathfinder: PathfinderClass,\n                    geometry: geometry\n                };\n                console.log('\u2705 [E2E] World dependencies exposed');\n            }\n            \n            // Note: generateWorld() is now called explicitly from main.ts after init completes\n        } catch (error) {\n            gameLogger.error('World: Failed to load world dependencies', {\n                error: error instanceof Error ? error.message : String(error),\n                stack: error instanceof Error ? error.stack : undefined\n            });\n            // Fall back to simpler world generation or throw error\n            throw error;\n        }\n    }\n\n    generateWorld(): void {\n        geometry.generateClosestGrids(this.worldSize);\n        \n        testCanvas.clear();\n        \n        const noiseBig = geometry.buildNoiseMap(this.worldRadius / 3 + 1, this.worldRadius / 3 + 1);\n        const noiseSmall = geometry.buildNoiseMap(this.worldRadius / 1.5 + 1, this.worldRadius / 1.5 + 1);\n        \n        const bigBlur = (noiseBig.length - 1) / this.worldSize;\n        const smallBlur = (noiseSmall.length - 1) / this.worldSize;\n        \n        this.mapBounds = { xl: 0, yl: 0, xh: 0, yh: 0 };\n        \n        for(let tx = 0; tx < this.worldSize; tx++) {\n            for(let ty = 0; ty < this.worldSize; ty++) {\n                const bigNoiseValue = geometry.getNoiseMapPoint(noiseBig, tx * bigBlur, ty * bigBlur);\n                const smallNoiseValue = geometry.getNoiseMapPoint(noiseSmall, tx * smallBlur, ty * smallBlur);\n                const noiseValue = (bigNoiseValue + smallNoiseValue * 2) / 3;\n                \n                const x = (tx - this.worldRadius);\n                const y = (ty - this.worldRadius);\n                const farness = (this.worldRadius - (Math.abs(x) + Math.abs(y)) / 2) / this.worldRadius;\n                \n                if(noiseValue / 1.1 < farness) {\n                    this.mapBounds.xl = Math.min(x, this.mapBounds.xl);\n                    this.mapBounds.yl = Math.min(y, this.mapBounds.yl);\n                    this.mapBounds.xh = Math.max(x, this.mapBounds.xh);\n                    this.mapBounds.yh = Math.max(y, this.mapBounds.yh);\n                    \n                    const grid = new SlabClass('grass', x, y, -0.5) as Slab;\n                    grid.grid = x + ':' + y;\n                    this.map[x + ':' + y] = grid;\n                    grid.addToGame(this.game);\n                }\n            }\n        }\n        \n        gameLogger.info('World: Generated slab tiles', { \n            tileCount: Object.keys(this.map).length \n        });\n        this.staticMap = [];\n        this.crawlMap(); // Examine map to determine islands, borders, etc\n        this.createTiles(); // Create map tiles from grid intersections\n        \n        this.createBackground();\n        \n        // Add debug overlay if debug mode is enabled\n        if (gameLogger.isDebugMode()) {\n            this.createDebugOverlay();\n        }\n        \n        PathfinderClass.loadMap(this.walkable);\n        unoccupiedGrids = Object.keys(this.map);\n        const beaconIndex = unoccupiedGrids.indexOf('0:0');\n        if (beaconIndex > -1) {\n            unoccupiedGrids.splice(beaconIndex, 1); // 0,0 is taken by beacon\n        }\n        \n        // Log world generation completion with spawn positions\n        gameLogger.worldGenerated({ \n            totalTiles: Object.keys(this.map).length,\n            spawnablePositions: unoccupiedGrids.length,\n            worldSize: this.worldSize,\n            worldRadius: this.worldRadius,\n            mapBounds: this.mapBounds,\n            mainIslandSize: this.islands[this.mainIsland]?.length || 0,\n            totalIslands: this.islands.length,\n            spawnPositions: unoccupiedGrids.slice(0, 10) // Log first 10 spawn positions as sample\n        });\n        \n        gameLogger.info('World: Created world', { \n            tileCount: Object.keys(this.map).length \n        });\n    }\n\n    private createBackground(): void {\n        gameLogger.debug('World: Creating background', { \n            staticMapCount: this.staticMap.length \n        });\n        \n        let lowestScreenX = 0, lowestScreenY = 0, highestScreenX = 0, highestScreenY = 0;\n        \n        for(let i = 0; i < this.staticMap.length; i++) {\n            const preTile = this.staticMap[i];\n            const preScreen = { x: preTile.screen.x, y: preTile.screen.y };\n            preScreen.x += preTile.sprite.metrics.ox || 0;\n            preScreen.y += preTile.sprite.metrics.oy || 0;\n            lowestScreenX = lowestScreenX < preScreen.x ? lowestScreenX : preScreen.x;\n            lowestScreenY = lowestScreenY < preScreen.y ? lowestScreenY : preScreen.y;\n            highestScreenX = highestScreenX > preScreen.x ? highestScreenX : preScreen.x;\n            highestScreenY = highestScreenY > preScreen.y ? highestScreenY : preScreen.y;\n        }\n        \n        gameLogger.debug('World: Calculated screen bounds', {\n            lowestScreenX, lowestScreenY, highestScreenX, highestScreenY\n        });\n        \n        const bgCanvas = new BetterCanvas(\n            (highestScreenX - lowestScreenX) + 32 + 1,\n            (highestScreenY - lowestScreenY) + 32 + 9\n        );\n        \n        let tilesDrawn = 0;\n        for(let j = 0; j < this.staticMap.length; j++) {\n            const tile = this.staticMap[j];\n            const screen = { x: tile.screen.x, y: tile.screen.y };\n            \n            // Debug: Log tile data for the first few tiles or any with NaN values\n            const hasNaN = !isFinite(tile.screen.x) || !isFinite(tile.screen.y) || \n                          !isFinite(tile.sprite.metrics.ox || 0) || !isFinite(tile.sprite.metrics.oy || 0);\n            \n            if (j < 3 || hasNaN) {\n                gameLogger.debug('World: Background tile data', {\n                    tileIndex: j,\n                    tileScreen: tile.screen,\n                    spriteMetrics: tile.sprite.metrics,\n                    screenBeforeOffset: { x: screen.x, y: screen.y },\n                    hasNaN: hasNaN\n                });\n            }\n            \n            screen.x += tile.sprite.metrics.ox || 0;\n            screen.y += tile.sprite.metrics.oy || 0;\n            screen.x -= lowestScreenX;\n            screen.y -= lowestScreenY;\n            \n            // Check for NaN after calculations\n            if (!isFinite(screen.x) || !isFinite(screen.y)) {\n                gameLogger.error('World: NaN detected in background tile', {\n                    tileIndex: j,\n                    originalScreen: { x: tile.screen.x, y: tile.screen.y },\n                    spriteOffsetX: tile.sprite.metrics.ox,\n                    spriteOffsetY: tile.sprite.metrics.oy,\n                    lowestScreenX: lowestScreenX,\n                    lowestScreenY: lowestScreenY,\n                    finalScreen: screen\n                });\n                continue; // Skip this tile\n            }\n            \n            const tileImage = this.game.renderer.images[tile.sprite.image];\n            if (!tileImage) {\n                gameLogger.error('World: Missing image for background tile', {\n                    tileImage: tile.sprite.image,\n                    tileIndex: j\n                });\n                continue;\n            }\n            \n            bgCanvas.drawImage(\n                tileImage,\n                tile.sprite.metrics.x, tile.sprite.metrics.y,\n                tile.sprite.metrics.w, tile.sprite.metrics.h,\n                Math.round(screen.x), Math.round(screen.y),\n                tile.sprite.metrics.w, tile.sprite.metrics.h\n            );\n            tilesDrawn++;\n            \n            if (j < 5) { // Log first few tiles for debugging\n                gameLogger.debug('World: Drew background tile', {\n                    tileIndex: j,\n                    image: tile.sprite.image,\n                    sourceRect: `${tile.sprite.metrics.x},${tile.sprite.metrics.y} ${tile.sprite.metrics.w}x${tile.sprite.metrics.h}`,\n                    destPos: `${Math.round(screen.x)},${Math.round(screen.y)}`\n                });\n            }\n        }\n        \n        this.game.renderer.bgCanvas = {\n            x: lowestScreenX, y: lowestScreenY, image: bgCanvas.canvas\n        };\n    }\n\n    // Debounced refresh to avoid double-drawing during move (remove + add)\n    private scheduleDebugOverlayRefresh(): void {\n        if (!gameLogger.isDebugMode()) return;\n        if (this.debugOverlayRefreshScheduled) return;\n        this.debugOverlayRefreshScheduled = true;\n        const run = () => {\n            try {\n                // Rebuild background, then paint overlay on top\n                this.createBackground();\n                this.createDebugOverlay();\n            } catch (e) {\n                gameLogger.warn('Debug: Overlay refresh failed', { error: (e as Error)?.message });\n            } finally {\n                this.debugOverlayRefreshScheduled = false;\n            }\n        };\n        if (typeof window !== 'undefined' && typeof window.requestAnimationFrame === 'function') {\n            window.requestAnimationFrame(run);\n        } else {\n            setTimeout(run, 0);\n        }\n    }\n\n    private createDebugOverlay(): void {\n        if (!this.game.renderer.bgCanvas) {\n            gameLogger.warn('Debug: Cannot create debug overlay - no background canvas available');\n            return;\n        }\n\n        gameLogger.info('Debug: Creating walkable tile overlay');\n        \n        // Get the existing background canvas\n        const bgCanvas = this.game.renderer.bgCanvas;\n        const canvas = bgCanvas.image;\n        const ctx = canvas.getContext('2d');\n        \n        if (!ctx) {\n            gameLogger.error('Debug: Cannot get canvas context for debug overlay');\n            return;\n        }\n\n        // Set drawing style for debug markers\n        ctx.strokeStyle = '#FF0000'; // Red color for walkable tiles\n        ctx.lineWidth = 2;\n        ctx.globalAlpha = 0.8;\n\n        let walkableCount = 0;\n        let actorCount = 0; \n        let totalTiles = 0;\n\n        // Iterate through all map positions and draw X marks on walkable tiles\n        for (const gridKey in this.map) {\n            if (!this.map.hasOwnProperty(gridKey)) continue;\n            \n            const slab = this.map[gridKey];\n            const x = slab.position.x;\n            const y = slab.position.y;\n            totalTiles++;\n            \n            // Determine if this tile is occupied by an Actor\n            let actorHere = false;\n            const yObjects = this.objects[x]?.[y];\n            if (yObjects) {\n                for (const zKey in yObjects) {\n                    if (!yObjects.hasOwnProperty(zKey)) continue;\n                    const obj: any = yObjects[zKey];\n                    if (obj && obj.constructor && obj.constructor.name === 'Actor') {\n                        actorHere = true;\n                        break;\n                    }\n                }\n            }\n\n            // Convert world coordinates to screen coordinates (tile center)\n            // Use the same isometric transform as actors, then adjust by bgCanvas origin\n            const z = slab.position.z;\n            const eastShift = 8; // slight eastward pixel tweak for alignment\n            const centerX = ((x - y) * 16 - 8 + eastShift) - bgCanvas.x;\n            const centerY = ((x + y) * 8 - (z) * 16 - 8) - bgCanvas.y;\n            const size = 4; // Size of the X mark\n\n            if (actorHere) {\n                // Draw blue marker for actor-occupied tiles (even if temporarily unwalkable)\n                actorCount++;\n                ctx.strokeStyle = '#007BFF';\n                ctx.beginPath();\n                ctx.moveTo(centerX - size, centerY - size);\n                ctx.lineTo(centerX + size, centerY + size);\n                ctx.moveTo(centerX + size, centerY - size);\n                ctx.lineTo(centerX - size, centerY + size);\n                ctx.stroke();\n                // Restore default red for subsequent tiles\n                ctx.strokeStyle = '#FF0000';\n            } else if (this.canWalk(x, y)) {\n                // Draw red marker for walkable tiles without actors\n                walkableCount++;\n                ctx.beginPath();\n                ctx.moveTo(centerX - size, centerY - size);\n                ctx.lineTo(centerX + size, centerY + size);\n                ctx.moveTo(centerX + size, centerY - size);\n                ctx.lineTo(centerX - size, centerY + size);\n                ctx.stroke();\n            }\n        }\n\n        // Draw isometric compass (N/E/S/W) to indicate world directions on screen\n        // In isometric projection used here:\n        //  - North (0,-1) maps to roughly up-right (dx=+16, dy=-8)\n        //  - East  (+1,0) maps to down-right (dx=+16, dy=+8)\n        //  - South (0,+1) maps to down-left (dx=-16, dy=+8)\n        //  - West  (-1,0) maps to up-left (dx=-16, dy=-8)\n        try {\n            const originX = 40;\n            const originY = 40;\n            const scale = 3; // enlarge the directional vectors for visibility\n\n            // Save state for compass styling\n            ctx.save();\n            ctx.globalAlpha = 0.95;\n            ctx.lineWidth = 2;\n            ctx.strokeStyle = '#00AAFF';\n            ctx.fillStyle = '#00AAFF';\n            ctx.font = '12px sans-serif';\n\n            // Helper to draw an arrow from (x1,y1) to (x2,y2)\n            const drawArrow = (x1: number, y1: number, x2: number, y2: number) => {\n                ctx.beginPath();\n                ctx.moveTo(x1, y1);\n                ctx.lineTo(x2, y2);\n                ctx.stroke();\n                // Arrow head\n                const angle = Math.atan2(y2 - y1, x2 - x1);\n                const headLen = 6;\n                ctx.beginPath();\n                ctx.moveTo(x2, y2);\n                ctx.lineTo(x2 - headLen * Math.cos(angle - Math.PI / 6), y2 - headLen * Math.sin(angle - Math.PI / 6));\n                ctx.lineTo(x2 - headLen * Math.cos(angle + Math.PI / 6), y2 - headLen * Math.sin(angle + Math.PI / 6));\n                ctx.lineTo(x2, y2);\n                ctx.fill();\n            };\n\n            // Direction vectors (screen deltas per grid step)\n            const dirs = {\n                N: { dx: 16, dy: -8 },\n                E: { dx: 16, dy: 8 },\n                S: { dx: -16, dy: 8 },\n                W: { dx: -16, dy: -8 }\n            } as const;\n\n            // Draw crosshair at origin\n            ctx.beginPath();\n            ctx.arc(originX, originY, 2, 0, Math.PI * 2);\n            ctx.fill();\n\n            // Draw arrows and labels\n            const endN = { x: originX + dirs.N.dx * scale, y: originY + dirs.N.dy * scale };\n            const endE = { x: originX + dirs.E.dx * scale, y: originY + dirs.E.dy * scale };\n            const endS = { x: originX + dirs.S.dx * scale, y: originY + dirs.S.dy * scale };\n            const endW = { x: originX + dirs.W.dx * scale, y: originY + dirs.W.dy * scale };\n            drawArrow(originX, originY, endN.x, endN.y);\n            drawArrow(originX, originY, endE.x, endE.y);\n            drawArrow(originX, originY, endS.x, endS.y);\n            drawArrow(originX, originY, endW.x, endW.y);\n\n            // Labels slightly past arrow tips\n            ctx.fillText('N', endN.x + 6, endN.y - 2);\n            ctx.fillText('E', endE.x + 6, endE.y + 12);\n            ctx.fillText('S', endS.x - 14, endS.y + 12);\n            ctx.fillText('W', endW.x - 14, endW.y - 2);\n\n            // Restore context state after compass\n            ctx.restore();\n        } catch (e) {\n            gameLogger.warn('Debug: Failed to draw compass overlay', { error: (e as Error)?.message });\n        }\n\n        // Reset alpha\n        ctx.globalAlpha = 1.0;\n\n        gameLogger.info('Debug: Walkable tile overlay complete', {\n            totalTiles: totalTiles,\n            walkableTiles: walkableCount,\n            unwalkableTiles: totalTiles - walkableCount,\n            actorTiles: actorCount\n        });\n    }\n\n    crawlMap(): void {\n        this.islands = [];\n        const crawled: Record<string, Slab> = {};\n        let thisIsland = 0;\n        \n        for(let x = this.mapBounds.xl; x <= this.mapBounds.xh; x++) {\n            for(let y = this.mapBounds.yl; y <= this.mapBounds.yh; y++) {\n                let currentTile = this.map[x + ':' + y];\n                if(!currentTile) continue;\n                if(crawled[currentTile.grid]) continue; // Skip already-crawled tiles\n                \n                const neighborsToCrawl: Slab[] = [];\n                while(true) { // Keep crawling outward until no neighbors are left\n                    crawled[currentTile.grid] = currentTile;\n                    if(this.islands[thisIsland]) {\n                        this.islands[thisIsland].push(currentTile);\n                    } else {\n                        this.islands.push([currentTile]);\n                    }\n                    \n                    const currentNeighbors = geometry.getNeighbors(currentTile.grid);\n                    for(const iKey in currentNeighbors) {\n                        if (!currentNeighbors.hasOwnProperty(iKey)) continue;\n                        const neighbor = this.map[currentNeighbors[iKey as keyof typeof currentNeighbors]];\n                        if(!neighbor) {\n                            currentTile.border = true;\n                            continue;\n                        }\n                        if(!crawled[neighbor.grid]) neighborsToCrawl.push(neighbor);\n                    }\n                    \n                    if(neighborsToCrawl.length > 0) {\n                        currentTile = neighborsToCrawl.pop()!;\n                    } else {\n                        thisIsland++;\n                        break; // No more neighbors, this island is done\n                    }\n                }\n            }\n        }\n        \n        this.mainIsland = 0;\n        for(let i = 1; i < this.islands.length; i++) {\n            this.mainIsland = this.islands[i].length > this.islands[this.mainIsland].length ?\n                i : this.mainIsland;\n        }\n        \n        for(let i2 = 0; i2 < this.islands.length; i2++) {\n            if(i2 == this.mainIsland) continue;\n            for(let it = 0; it < this.islands[i2].length; it++) {\n                delete this.map[this.islands[i2][it].grid];\n                this.islands[i2][it].remove();\n            }\n        }\n        \n        // Set border tiles to slab\n        for(const gKey in this.map) {\n            if(!this.map.hasOwnProperty(gKey)) continue;\n            const finalTile = this.map[gKey];\n            if(finalTile.border) {\n                finalTile.style = 'plain';\n            } else {\n                const finalNeighbors = geometry.get8Neighbors(finalTile.grid);\n                for(const nKey in finalNeighbors) {\n                    if (!finalNeighbors.hasOwnProperty(nKey)) continue;\n                    if(!this.map[finalNeighbors[nKey as keyof typeof finalNeighbors]]) {\n                        finalTile.style = 'plain';\n                        break;\n                    }\n                }\n            }\n        }\n        \n        // Slab around beacon\n        if (this.map['0:0']) this.map['0:0'].style = 'plain';\n        if (this.map['1:0']) this.map['1:0'].style = 'plain';\n        if (this.map['-1:0']) this.map['-1:0'].style = 'plain';\n        if (this.map['0:1']) this.map['0:1'].style = 'plain';\n        if (this.map['0:-1']) this.map['0:-1'].style = 'plain';\n        \n        this.createFlowerPatches();\n    }\n\n    private createFlowerPatches(): void {\n        // Create flower patches\n        for(let fp = 0; fp < Math.ceil(Math.pow(this.worldRadius, 2) / 80); fp++) {\n            let safety = 0;\n            let grid: Slab;\n            let valid: boolean;\n            \n            do {\n                valid = true;\n                grid = this.map[util.pickInObject(this.map)];\n                if (!grid) continue;\n                \n                const flowerNeighbors = geometry.get8Neighbors(grid.grid);\n                for(const fKey in flowerNeighbors) {\n                    if (!flowerNeighbors.hasOwnProperty(fKey)) continue;\n                    const fNeighbor = this.map[flowerNeighbors[fKey as keyof typeof flowerNeighbors]];\n                    if(!fNeighbor || fNeighbor.style != 'grass') {\n                        valid = false;\n                        break;\n                    }\n                }\n                safety++;\n            } while(safety < 1000 && (grid.style != 'grass' || !valid));\n            \n            if(safety == 1000) continue;\n            grid.style = 'flowers';\n            \n            const spread = util.randomIntRange(1, 4);\n            for(let s = 0; s < spread; s++) {\n                let canSpread = true;\n                const spreadX = grid.position.x + util.randomIntRange(-1, 1);\n                const spreadY = grid.position.y + util.randomIntRange(-1, 1);\n                const spreadGrid = this.map[spreadX + ':' + spreadY];\n                \n                if (!spreadGrid) continue;\n                \n                const spreadNeighbors = geometry.get8Neighbors(spreadGrid.grid);\n                for(const sKey in spreadNeighbors) {\n                    if (!spreadNeighbors.hasOwnProperty(sKey)) continue;\n                    const sNeighbor = this.map[spreadNeighbors[sKey as keyof typeof spreadNeighbors]];\n                    if(!sNeighbor || (sNeighbor.style != 'grass' && sNeighbor.style != 'flowers')) {\n                        canSpread = false;\n                        break;\n                    }\n                }\n                if(canSpread) spreadGrid.style = 'flowers';\n            }\n        }\n    }\n\n    createTiles(): void {\n        // Tile types:\n        //   Grass     G\n        //   Slab      S\n        //   Flowers   F\n        //   Empty     E\n        // Tile code constructed as NW-NE-SE-SW (eg. \"S-X-X-B\")\n\n        this.tileMap = {};\n        const self = this;\n        \n        function tileType(grid: string): string {\n            return self.map[grid].style[0].replace(/p/, 's').toUpperCase();\n        }\n        \n        function getTileCode(oGrid: string, nGrid: string): string {\n            if(oGrid == nGrid) return tileType(oGrid);\n            const neighbor = self.map[nGrid];\n            if(!neighbor) return 'E';\n            return tileType(nGrid);\n        }\n        \n        function generateTile(oGrid: string, tile: any, grid: string, game: Game): any {\n            const nGrids = tile.grids;\n            const tileCode = getTileCode(oGrid, nGrids[0]) + '-' + getTileCode(oGrid, nGrids[1])\n                + '-' + getTileCode(oGrid, nGrids[2]) + '-' + getTileCode(oGrid, nGrids[3]);\n            const tileSprite = (new TileSheetClass('tile')).map[tileCode];\n            if(!tileSprite) {\n                gameLogger.error('World: Unknown tile code', {\n                    tileCode: tileCode,\n                    neighborGrids: nGrids,\n                    originalGrid: oGrid\n                });\n            }\n            return {\n                tileCode: tileCode, position: tile, grid: grid, game: game\n            };\n        }\n        \n        for(const key in this.map) {\n            if(!this.map.hasOwnProperty(key)) continue;\n            const x = +key.split(':')[0];\n            const y = +key.split(':')[1];\n            const z = this.map[key].position.z;\n            const neighbors = geometry.get8Neighbors(key);\n            \n            const nw = { x: x - 0.5, y: y - 0.5, z: z, grids: [neighbors.nw, neighbors.n, key, neighbors.w] };\n            const ne = { x: x + 0.5, y: y - 0.5, z: z, grids: [neighbors.n, neighbors.ne, neighbors.e, key] };\n            const se = { x: x + 0.5, y: y + 0.5, z: z, grids: [key, neighbors.e, neighbors.se, neighbors.s] };\n            const sw = { x: x - 0.5, y: y + 0.5, z: z, grids: [neighbors.w, key, neighbors.s, neighbors.sw] };\n            const tiles = [nw, ne, se, sw];\n            \n            for(let i = 0; i < tiles.length; i++) {\n                const tileGrid = z + ':' + tiles[i].x + ':' + tiles[i].y;\n                if(this.tileMap[tileGrid]) continue;\n                this.tileMap[tileGrid] = new TileClass(generateTile(key, tiles[i], tileGrid, this.game)) as Tile;\n                this.staticMap.push(this.tileMap[tileGrid]);\n            }\n        }\n        this.staticMap.sort(function(a, b) { return a.zDepth - b.zDepth; });\n        \n        // Log tile map for E2E testing\n        this.logTileMap();\n        \n        // Log valid spawn positions for E2E testing\n        this.logValidSpawnPositions();\n    }\n\n    private logTileMap(): void {\n        // Create complete tile map data for E2E testing\n        const completeTileMap: Record<string, { \n            tileCode: string; \n            x: number; \n            y: number; \n            z: number;\n            grid: string;\n        }> = {};\n        \n        const tileCodeCounts: Record<string, number> = {};\n        \n        for (const tileGrid in this.tileMap) {\n            if (!this.tileMap.hasOwnProperty(tileGrid)) continue;\n            \n            const tile = this.tileMap[tileGrid] as any; // Access the generated tile data\n            const tileCode = tile.tileCode || 'UNKNOWN';\n            const position = tile.position;\n            \n            // Store complete tile information\n            completeTileMap[tileGrid] = {\n                tileCode: tileCode,\n                x: position.x,\n                y: position.y,\n                z: position.z,\n                grid: tileGrid\n            };\n            \n            // Count tile codes for summary\n            tileCodeCounts[tileCode] = (tileCodeCounts[tileCode] || 0) + 1;\n        }\n        \n        // Also create a simple grid-based representation showing what tile type is at each coordinate\n        const gridTileTypes: Record<string, string> = {};\n        for (const gridKey in this.map) {\n            if (!this.map.hasOwnProperty(gridKey)) continue;\n            const slab = this.map[gridKey];\n            gridTileTypes[gridKey] = slab.style; // grass, plain, or flowers\n        }\n        \n        gameLogger.worldTileMap({\n            totalTiles: Object.keys(this.tileMap).length,\n            uniqueTileCodes: Object.keys(tileCodeCounts).length,\n            tilesByCode: tileCodeCounts,\n            gridTileTypes: gridTileTypes, // Map of \"x:y\" -> \"grass\"|\"plain\"|\"flowers\"\n            tileMap: completeTileMap // Complete tile map: \"z:x:y\" -> { tileCode, x, y, z, grid }\n        });\n    }\n\n    private logValidSpawnPositions(): void {\n        const validSpawnPositions: string[] = [];\n        const invalidSpawnPositions: string[] = [];\n        \n        // Check each grid position to see if actors can spawn there\n        for (const gridKey in this.map) {\n            if (!this.map.hasOwnProperty(gridKey)) continue;\n            \n            const slab = this.map[gridKey];\n            const x = slab.position.x;\n            const y = slab.position.y;\n            \n            // Skip beacon position (0,0) as it's reserved\n            if (x === 0 && y === 0) {\n                invalidSpawnPositions.push(`${x}:${y} (beacon)`);\n                continue;\n            }\n            \n            // Actors can spawn on grass, slab (plain), or flowers\n            // They cannot spawn on empty tiles\n            const canSpawn = slab.style === 'grass' || slab.style === 'plain' || slab.style === 'flowers';\n            \n            if (canSpawn) {\n                validSpawnPositions.push(`${x}:${y}`);\n            } else {\n                invalidSpawnPositions.push(`${x}:${y} (${slab.style})`);\n            }\n        }\n        \n        gameLogger.worldSpawnAnalysis({\n            totalPositions: Object.keys(this.map).length,\n            validSpawnPositions: validSpawnPositions.length,\n            invalidSpawnPositions: invalidSpawnPositions.length,\n            validPositions: validSpawnPositions, // Log ALL valid positions\n            invalidPositions: invalidSpawnPositions // Log ALL invalid positions\n        });\n    }\n\n    addToWorld(obj: WorldObject): boolean {\n        if(this.objects[obj.position.x]) {\n            if(this.objects[obj.position.x][obj.position.y]) {\n                if(this.objects[obj.position.x][obj.position.y][obj.position.z]) {\n                    gameLogger.error('World: Position occupied', {\n                        position: obj.position,\n                        newObject: obj.constructor?.name || 'unknown',\n                        existingObject: this.objects[obj.position.x][obj.position.y][obj.position.z].constructor?.name || 'unknown'\n                    });\n                    return false;\n                }\n            } else {\n                this.objects[obj.position.x][obj.position.y] = {};\n            }\n        } else {\n            this.objects[obj.position.x] = {};\n            this.objects[obj.position.x][obj.position.y] = {};\n        }\n        this.objects[obj.position.x][obj.position.y][obj.position.z] = obj;\n        this.updateWalkable(obj.position.x, obj.position.y);\n        // If an Actor is added, refresh debug overlay (in debug mode)\n        if ((obj as any)?.constructor?.name === 'Actor') {\n            this.scheduleDebugOverlayRefresh();\n        }\n        return true;\n    }\n\n    removeFromWorld(obj: WorldObject): void {\n        if (this.objects[obj.position.x]?.[obj.position.y]?.[obj.position.z]) {\n            delete this.objects[obj.position.x][obj.position.y][obj.position.z];\n            this.updateWalkable(obj.position.x, obj.position.y);\n            // If an Actor is removed, refresh debug overlay (in debug mode)\n            if ((obj as any)?.constructor?.name === 'Actor') {\n                this.scheduleDebugOverlayRefresh();\n            }\n        }\n    }\n\n    moveObject(obj: WorldObject, x: number, y: number, z: number): void {\n        this.removeFromWorld(obj);\n        obj.position.x = x;\n        obj.position.y = y;\n        obj.position.z = z;\n        this.addToWorld(obj);\n        // Do not trigger here to avoid double refresh; add/remove already schedule a refresh\n    }\n\n    updateWalkable(x: number, y: number): void {\n        const objects = this.objects[x]?.[y];\n        if(!objects || Object.keys(objects).length == 0) {\n            delete this.walkable[x + ':' + y];\n            return;\n        }\n        const zKeys = Object.keys(objects).sort(function(a, b) { return +a - +b; });\n        const topObject = objects[+zKeys[zKeys.length - 1]];\n        if(topObject.unWalkable) {\n            delete this.walkable[x + ':' + y];\n        } else {\n            const walkableHeight = topObject.position.z + topObject.height;\n            this.walkable[x + ':' + y] = walkableHeight;\n        }\n    }\n\n    canWalk(x: number, y: number): boolean {\n        // Check if the grid exists in the world map (is there a slab here?)\n        const slab = this.map[x + ':' + y];\n        if (!slab) {\n            return false;\n        }\n        \n        // Check the walkable status\n        const walkableHeight = this.walkable[x + ':' + y];\n        \n        // If no entry in walkable, it's an empty slab - walkable at slab height\n        // If entry exists, there are objects and the top one is walkable\n        // If entry was deleted due to unWalkable objects, walkableHeight would be undefined\n        // but we still need to check the actual objects to be sure\n        \n        const objects = this.objects[x]?.[y];\n        if (!objects || Object.keys(objects).length === 0) {\n            // Empty slab - always walkable\n            return true;\n        }\n        \n        // Has objects - check if top object is walkable\n        const zKeys = Object.keys(objects).sort((a, b) => +a - +b);\n        const topObject = objects[+zKeys[zKeys.length - 1]];\n        const canWalk = !topObject.unWalkable;\n        return canWalk;\n    }\n\n    getHeight(x: number, y: number): number {\n        // Return the walkable height at this position\n        const walkableHeight = this.walkable[x + ':' + y];\n        if (walkableHeight !== undefined) {\n            return walkableHeight;\n        }\n        \n        // If no walkable height (empty slab), return the slab height + slab's height value\n        const slab = this.map[x + ':' + y];\n        if (slab) {\n            const slabTop = slab.position.z + slab.height;\n            return slabTop;\n        }\n        return -0.5;\n    }\n\n    randomEmptyGrid(): string {\n        return unoccupiedGrids.splice(util.randomIntRange(0, unoccupiedGrids.length - 1), 1)[0];\n    }\n\n    objectAtXYZ(x: number, y: number, z: number): WorldObject | null {\n        return this.objects[x]?.[y]?.[z] || null;\n    }\n\n    objectUnderXYZ(x: number, y: number, z: number): WorldObject | null {\n        const yObjects = this.objects[x]?.[y];\n        if(!yObjects) return null;\n        \n        let highest = -1000;\n        for(const zKey in yObjects) {\n            if(!yObjects.hasOwnProperty(zKey)) continue;\n            if(+zKey > z) continue;\n            highest = +zKey > highest ? +zKey : highest;\n        }\n        return yObjects[highest] || null;\n    }\n\n    findObject(obj: WorldObject): [string, string, string] | null { // For debugging\n        for(const xKey in this.objects) {\n            if (!this.objects.hasOwnProperty(xKey)) continue;\n            const xObjects = this.objects[xKey];\n            for(const yKey in xObjects) {\n                if (!xObjects.hasOwnProperty(yKey)) continue;\n                const yObjects = xObjects[yKey];\n                for(const zKey in yObjects) {\n                    if (!yObjects.hasOwnProperty(zKey)) continue;\n                    if(obj === yObjects[zKey]) return [xKey, yKey, zKey];\n                }\n            }\n        }\n        return null;\n    }\n}\n\n// Expose World class for E2E testing as soon as it's defined\nif (typeof window !== 'undefined' && (window as any).__E2E_TEST_MODE) {\n    (window as any).__WorldClass = World;\n    \n    // Expose unoccupiedGrids for testing and mocking\n    (window as any).__unoccupiedGrids = () => unoccupiedGrids;\n    (window as any).__setUnoccupiedGrids = (grids: string[]) => { unoccupiedGrids = grids; };\n    \n    console.log('\u2705 [E2E] World class exposed on window.__WorldClass');\n    \n    // Dispatch event so mocks can patch immediately (synchronously)\n    if (typeof window !== 'undefined') {\n        window.dispatchEvent(new CustomEvent('__worldClassReady', { detail: { World } }));\n    }\n}", "'use strict';\n\nimport { EventEmitter } from 'events';\nimport { gameLogger } from '../../gameLogger.js';\n\nimport { geometry } from '../common/geometry.js';\n\ninterface SewSeedOptions {\n    origin: { x: number; y: number; z: number };\n}\n\ninterface World {\n    map: Record<string, {\n        position: { x: number; y: number; z: number };\n        style: string;\n        height: number;\n    }>;\n    objectAtXYZ(x: number, y: number, z: number): any;\n}\n\ninterface Game {\n    decorator?: Decorator;\n}\n\ninterface Beacon {\n    addToGame(game: Game): void;\n    ping(): void;\n}\n\ninterface Seed {\n    addToGame(game: Game): void;\n}\n\nlet BeaconClass: any;\nlet SeedClass: any;\n\nexport default class Decorator extends EventEmitter {\n    game: Game;\n    world: World;\n    beacon!: Beacon;\n\n    constructor(game: Game, world: World) {\n        super();\n        this.game = game;\n        this.world = world;\n        this.game.decorator = this;\n        this.init();\n    }\n\n    private async init(): Promise<void> {\n        try {\n            const [BeaconModule, SeedModule] = await Promise.all([\n                import('./beacon.js'),\n                import('./seed.js')\n            ]);\n\n            BeaconClass = BeaconModule.default;\n            SeedClass = SeedModule.default;\n\n            this.createBeacon();\n        } catch (error) {\n            gameLogger.error('Decorator: Failed to load dependencies', {\n                error: error instanceof Error ? error.message : String(error)\n            });\n            throw error;\n        }\n    }\n\n    sewSeed(options: SewSeedOptions): void {\n        if (!SeedClass) {\n            gameLogger.error('Decorator: Seed class not loaded yet');\n            return;\n        }\n\n        let destination: { x: number; y: number; z: number } | undefined;\n        \n        for(let i = 0; i < geometry.closestGrids.length; i++) {\n            const close = geometry.closestGrids[i];\n            const grid = this.world.map[(options.origin.x + close[0]) + ':' + (options.origin.y + close[1])];\n            if(!grid || grid.style == 'plain') continue;\n            if(this.world.objectAtXYZ(grid.position.x, grid.position.y, grid.position.z + grid.height)) continue;\n            destination = grid.position;\n            break;\n        }\n        \n        if(!destination) return;\n        \n        const talkSeed = new SeedClass({\n            origin: options.origin,\n            destination: { x: destination.x, y: destination.y, z: destination.z + 0.5 }\n        }) as Seed;\n        \n        talkSeed.addToGame(this.game);\n    }\n\n    private createBeacon(): void {\n        if (!BeaconClass) {\n            gameLogger.error('Decorator: Beacon class not loaded yet');\n            return;\n        }\n\n        // Commented out original beacon location logic for simplicity\n        // The beacon is now always placed at 0,0,0\n        this.beacon = new BeaconClass(0, 0, 0) as Beacon;\n        this.beacon.addToGame(this.game);\n    }\n}", "'use strict';\n\nimport { EventEmitter } from 'events';\nimport BetterCanvas from '../common/bettercanvas.js';\nimport { TextBlotter } from '../common/textblotter.js';\nimport Button from './button.js';\nimport Panel from './panel.js';\nimport Input from './input.js';\nimport Label from './label.js';\nimport UIElement from './uielement.js';\n\ninterface UIOptions {\n    [key: string]: any;\n}\n\ninterface MouseEvent {\n    x: number;\n    y: number;\n    [key: string]: any;\n}\n\ninterface KeyEvent {\n    [key: string]: any;\n}\n\ninterface Game {\n    renderer?: {\n        images: {\n            font: HTMLImageElement | HTMLCanvasElement;\n        };\n    };\n    mouseButtons: any[];\n    mouseOver: boolean;\n    on(event: string, callback: Function): void;\n}\n\ninterface Resize {\n    width: number;\n    height: number;\n}\n\nexport default class UI extends EventEmitter {\n    game: Game;\n    elements: UIElement[] = [];\n    x: number = 0;\n    y: number = 0;\n    w?: number;\n    h?: number;\n    canvas: BetterCanvas;\n    mouseOnElement: UIElement | false = false;\n    boundRedraw: () => void;\n    boundOnMouseOnElement: (elem: UIElement) => void;\n    boundOnMouseOffElement: (elem: UIElement) => void;\n\n    constructor(game: Game) {\n        super();\n        this.game = game;\n        if (this.game.renderer?.images?.font) {\n            TextBlotter.loadImage(this.game.renderer.images.font);\n        }\n        this.game.on('resize', this.onResize.bind(this));\n        this.game.on('mousemove', this.onMouseMove.bind(this));\n        this.game.on('mousedown', this.onMouseDown.bind(this));\n        this.game.on('mouseup', this.onMouseUp.bind(this));\n        this.game.on('keydown', this.onKeyDown.bind(this));\n        this.game.on('keyup', this.onKeyUp.bind(this));\n        this.elements = [];\n        this.x = 0; \n        this.y = 0;\n        this.w = 1;  // Initialize with default dimensions\n        this.h = 1;  // These will be updated by the first onResize event\n        this.canvas = new BetterCanvas(1, 1);\n        const self = this;\n        this.on('draw', function(canvas: any) { \n            canvas.drawStatic(self.canvas.canvas); \n        });\n        this.boundRedraw = this.redraw.bind(this);\n        this.boundOnMouseOnElement = this.onMouseOnElement.bind(this);\n        this.boundOnMouseOffElement = this.onMouseOffElement.bind(this);\n    }\n\n    // TODO: Abstract these different add methods into one\n    addButton(options: UIOptions): Button {\n        if(!options.parent) options.parent = this;\n        options.ui = this;\n        const newButton = new Button(options as any);\n        options.parent.elements.push(newButton);\n        if(options.parent !== this) this.elements.push(newButton);\n        newButton.on('redraw', this.boundRedraw);\n        newButton.on('mouse-on-element', this.boundOnMouseOnElement);\n        newButton.on('mouse-off-element', this.boundOnMouseOffElement);\n        return newButton;\n    }\n\n    addPanel(options: UIOptions): Panel {\n        if(!options.parent) options.parent = this;\n        options.ui = this;\n        const newPanel = new Panel(options as any);\n        options.parent.elements.push(newPanel);\n        if(options.parent !== this) this.elements.push(newPanel);\n        newPanel.on('redraw', this.boundRedraw);\n        return newPanel;\n    }\n\n    addInput(options: UIOptions): Input {\n        if(!options.parent) options.parent = this;\n        options.ui = this;\n        const newInput = new Input(options as any);\n        options.parent.elements.push(newInput);\n        if(options.parent !== this) this.elements.push(newInput);\n        newInput.on('redraw', this.boundRedraw);\n        newInput.on('mouse-on-element', this.boundOnMouseOnElement);\n        newInput.on('mouse-off-element', this.boundOnMouseOffElement);\n        return newInput;\n    }\n\n    addLabel(options: UIOptions): Label {\n        if(!options.parent) options.parent = this;\n        options.ui = this;\n        const newLabel = new Label(options as any);\n        options.parent.elements.push(newLabel);\n        if(options.parent !== this) this.elements.push(newLabel);\n        newLabel.on('redraw', this.boundRedraw);\n        newLabel.on('mouse-on-element', this.boundOnMouseOnElement);\n        newLabel.on('mouse-off-element', this.boundOnMouseOffElement);\n        return newLabel;\n    }\n\n    redraw(): void {\n        this.canvas.clear();\n        for(let i = 0; i < this.elements.length; i++) {\n            this.elements[i].redraw(this.canvas);\n        }\n    }\n\n    onMouseMove(mouseEvent: MouseEvent): void {\n        if(this.game.mouseButtons.length > 0) return;\n        for(let i = 0; i < this.elements.length; i++) {\n            const elem = this.elements[i];\n            if(mouseEvent.x >= elem.x && mouseEvent.x < elem.x + elem.w\n                && mouseEvent.y >= elem.y && mouseEvent.y < elem.y + elem.h) {\n                elem.emit('mouse-on', mouseEvent);\n            } else {\n                elem.emit('mouse-off', mouseEvent);\n            }\n        }\n    }\n\n    onMouseDown(mouseEvent: MouseEvent): void {\n        for(let i = 0; i < this.elements.length; i++) {\n            this.elements[i].emit('mouse-down', mouseEvent);\n        }\n    }\n\n    onMouseUp(mouseEvent: MouseEvent): void {\n        for(let i = 0; i < this.elements.length; i++) {\n            this.elements[i].emit('mouse-up', mouseEvent);\n        }\n    }\n\n    onKeyDown(keyEvent: KeyEvent): void {\n        for(let i = 0; i < this.elements.length; i++) {\n            this.elements[i].emit('key-down', keyEvent);\n        }\n    }\n\n    onKeyUp(keyEvent: KeyEvent): void {\n        for(let i = 0; i < this.elements.length; i++) {\n            this.elements[i].emit('key-up', keyEvent);\n        }\n    }\n\n    onMouseOnElement(elem: UIElement): void {\n        this.mouseOnElement = elem;\n        this.game.mouseOver = false;\n    }\n\n    onMouseOffElement(elem: UIElement): void {\n        this.mouseOnElement = this.mouseOnElement === elem ? false : this.mouseOnElement;\n    }\n\n    onResize(resize: Resize): void {\n        this.w = resize.width; \n        this.h = resize.height;\n        this.canvas.canvas.width = this.w;\n        this.canvas.canvas.height = this.h;\n        for(let i = 0; i < this.elements.length; i++) {\n            this.elements[i].reposition();\n        }\n        this.redraw();\n    }\n}", "'use strict';\n\nimport { EventEmitter } from 'events';\nimport BetterCanvas from '../common/bettercanvas.js';\nimport { util } from '../common/util.js';\n\ninterface UIElementOptions {\n    ui: any;\n    parent: any;\n    w?: number;\n    h?: number;\n    top?: number | 'auto';\n    bottom?: number;\n    left?: number | 'auto';\n    right?: number;\n}\n\nexport default class UIElement extends EventEmitter {\n    ui: any;\n    parent: any;\n    elements: UIElement[];\n    w: number;\n    h: number;\n    autosize?: boolean;\n    top?: number | 'auto';\n    bottom?: number;\n    left?: number | 'auto';\n    right?: number;\n    x: number = 0;\n    y: number = 0;\n    canvas: BetterCanvas;\n\n    constructor(options: UIElementOptions) {\n        super();\n        this.ui = options.ui;\n        this.parent = options.parent;\n        this.elements = [];\n        this.w = 1; \n        this.h = 1;\n        if(options.w !== undefined) this.w = options.w; else this.autosize = true;\n        if(options.h !== undefined) this.h = options.h; else this.autosize = true;\n        if(options.top !== undefined) this.top = options.top;\n        if(options.bottom !== undefined) this.bottom = options.bottom;\n        if(options.left !== undefined) this.left = options.left;\n        if(options.right !== undefined) this.right = options.right;\n        this.canvas = new BetterCanvas(this.w || 1, this.h || 1);\n        this.reposition();\n    }\n\n    reposition(): void {\n        // Ensure parent has valid dimensions before positioning\n        if (!this.parent || typeof this.parent.x !== 'number' || typeof this.parent.y !== 'number' ||\n            typeof this.parent.w !== 'number' || typeof this.parent.h !== 'number') {\n            return; // Skip positioning if parent dimensions aren't ready\n        }\n\n        if(this.top !== undefined) {\n            if(this.top == 'auto') {\n                this.y = Math.round(this.parent.y + this.parent.h/2 - this.h/2);\n            } else {\n                this.y = this.parent.y + (this.top as number);\n            }\n        }\n        if(this.bottom !== undefined) this.y = this.parent.y + this.parent.h - this.h - this.bottom;\n        if(this.left !== undefined) {\n            if(this.left == 'auto') {\n                this.x = Math.round(this.parent.x + this.parent.w/2 - this.w/2);\n            } else {\n                this.x = this.parent.x + (this.left as number);\n            }\n        }\n        if(this.right !== undefined) this.x = this.parent.x + this.parent.w - this.w - this.right;\n        if(this.elements) {\n            for(let i = 0; i < this.elements.length; i++) {\n                this.elements[i].reposition();\n            }\n        }\n    }\n\n    redraw(canvas: any): void {\n        canvas.drawImage(this.canvas.canvas || this.canvas, 0, 0, this.w, this.h, this.x, this.y, this.w, this.h);\n    }\n\n    remove(): void {\n        if(this.ui.mouseOnElement === this) this.ui.mouseOnElement = false;\n        this.removeAllListeners('redraw');\n        this.removeAllListeners('mouse-on-element');\n        this.removeAllListeners('mouse-off-element');\n        util.findAndRemove(this, this.ui.elements);\n        if(this.elements) {\n            for(let i = 0; i < this.elements.length; i++) {\n                this.elements[i].remove();\n            }\n        }\n        this.ui.redraw();\n    }\n\n    resize(width: number, height: number): void {\n        this.w = this.canvas.canvas.width = width;\n        this.h = this.canvas.canvas.height = height;\n        if((this as any).draw) (this as any).draw();\n    }\n\n    resizeChildren(width: number, height: number): void {\n        if(this.elements) {\n            for(let i = 0; i < this.elements.length; i++) {\n                this.elements[i].resize(width, height);\n            }\n        }\n    }\n}", "'use strict';\n\nimport UIElement from './uielement.js';\nimport { TextBlotter } from '../common/textblotter.js';\n\ninterface ButtonOptions {\n    ui: any;\n    parent: any;\n    w?: number;\n    h?: number;\n    top?: number | 'auto';\n    bottom?: number;\n    left?: number | 'auto';\n    right?: number;\n    text?: string;\n    onPress?: () => void;\n    disabled?: boolean;\n}\n\ninterface MouseEvent {\n    [key: string]: any;\n}\n\nexport default class Button extends UIElement {\n    text?: string;\n    textCanvas?: HTMLCanvasElement;\n    onPress?: () => void;\n    disabled?: boolean;\n    mouseOn?: boolean;\n    pressed?: boolean;\n    onMouseOnBound: (event: MouseEvent) => void;\n    onMouseOffBound: (event: MouseEvent) => void;\n    onMouseDownBound: (event: MouseEvent) => void;\n    onMouseUpBound: (event: MouseEvent) => void;\n\n    constructor(options: ButtonOptions) {\n        super(options);\n        if(options.text) this.changeText(options.text);\n        if(options.onPress) this.onPress = options.onPress;\n        if(options.disabled) this.disabled = true;\n        this.onMouseOnBound = this.onMouseOn.bind(this);\n        this.on('mouse-on', this.onMouseOnBound);\n        this.onMouseOffBound = this.onMouseOff.bind(this);\n        this.on('mouse-off', this.onMouseOffBound);\n        this.onMouseDownBound = this.onMouseDown.bind(this);\n        this.on('mouse-down', this.onMouseDownBound);\n        this.onMouseUpBound = this.onMouseUp.bind(this);\n        this.on('mouse-up', this.onMouseUpBound);\n    }\n\n    changeText(text: string): void {\n        this.text = text;\n        this.textCanvas = TextBlotter.blot({ text: this.text });\n        if(this.autosize) {\n            this.w = this.canvas.canvas.width = this.textCanvas.width + 2;\n            this.h = this.canvas.canvas.height = this.textCanvas.height + 2;\n        }\n        this.draw();\n    }\n\n    draw(): void {\n        this.canvas.clear();\n        this.canvas.fillRect('rgba(255,255,255,0.8)', 0, 0, this.w, this.h);\n        this.canvas.clearRect(1, 1, this.w - 2, this.h - 2);\n        const buttonColor = 'rgba(' + (this.mouseOn ? '77,102,184,0.9)' : this.disabled ? '245,240,213,0.3)' : '0,0,0,0.8)');\n        this.canvas.fillRect(buttonColor, 1, 1, this.w - 2, this.h - 2);\n        if (this.textCanvas) {\n            const textOffset = Math.floor((this.canvas.canvas.width - this.textCanvas.width) / 2);\n            this.canvas.drawImage(this.textCanvas, 0, 0, this.textCanvas.width, this.textCanvas.height,\n                textOffset, 1, this.textCanvas.width, this.textCanvas.height);\n        }\n        this.emit('redraw');\n    }\n\n    onMouseOn(mouseEvent: MouseEvent): void {\n        if(this.disabled || this.mouseOn) return;\n        this.mouseOn = true;\n        this.emit('mouse-on-element', this);\n        this.draw();\n    }\n\n    onMouseOff(mouseEvent: MouseEvent): void {\n        if(this.disabled || !this.mouseOn) return;\n        this.mouseOn = false;\n        this.pressed = false;\n        this.emit('mouse-off-element', this);\n        this.draw();\n    }\n\n    onMouseDown(mouseEvent: MouseEvent): void {\n        if(this.disabled || !this.mouseOn) return;\n        this.pressed = true;\n        this.draw();\n    }\n\n    onMouseUp(mouseEvent: MouseEvent): void {\n        if(this.disabled || !this.mouseOn) return;\n        this.pressed = false;\n        if(this.onPress) this.onPress();\n        this.draw();\n    }\n}", "'use strict';\n\nimport UIElement from './uielement.js';\n\ninterface PanelOptions {\n    ui: any;\n    parent: any;\n    w?: number;\n    h?: number;\n    top?: number | 'auto';\n    bottom?: number;\n    left?: number | 'auto';\n    right?: number;\n}\n\nexport default class Panel extends UIElement {\n    constructor(options: PanelOptions) {\n        super(options);\n        this.draw();\n    }\n\n    draw(): void {\n        this.canvas.clear();\n        this.canvas.fillRect('rgba(255,255,255,0.8)', 0, 0, this.w, this.h);\n        this.canvas.clearRect(1, 1, this.w - 2, this.h - 2);\n        this.canvas.fillRect('rgba(0,0,0,0.8)', 1, 1, this.w - 2, this.h - 2);\n        this.emit('redraw');\n    }\n}", "'use strict';\n\nimport UIElement from './uielement.js';\nimport { TextBlotter } from '../common/textblotter.js';\nimport { util } from '../common/util.js';\n\ninterface InputOptions {\n    ui: any;\n    parent: any;\n    w?: number;\n    h?: number;\n    top?: number | 'auto';\n    bottom?: number;\n    left?: number | 'auto';\n    right?: number;\n    text?: string;\n    onSubmit?: (text: string) => void;\n}\n\ninterface MouseEvent {\n    [key: string]: any;\n}\n\ninterface KeyEvent {\n    key: string;\n    [key: string]: any;\n}\n\nexport default class Input extends UIElement {\n    text: string = '';\n    textCanvas?: HTMLCanvasElement;\n    onSubmit?: (text: string) => void;\n    focused?: boolean;\n    mouseOn?: boolean;\n    onMouseOnBound: (event: MouseEvent) => void;\n    onMouseOffBound: (event: MouseEvent) => void;\n    onMouseDownBound: (event: MouseEvent) => void;\n    onMouseUpBound: (event: MouseEvent) => void;\n    onKeyDownBound: (event: KeyEvent) => void;\n\n    constructor(options: InputOptions) {\n        super(options);\n        this.changeText(options.text || '');\n        if(options.onSubmit) this.onSubmit = options.onSubmit;\n        this.onMouseOnBound = this.onMouseOn.bind(this);\n        this.on('mouse-on', this.onMouseOnBound);\n        this.onMouseOffBound = this.onMouseOff.bind(this);\n        this.on('mouse-off', this.onMouseOffBound);\n        this.onMouseDownBound = this.onMouseDown.bind(this);\n        this.on('mouse-down', this.onMouseDownBound);\n        this.onMouseUpBound = this.onMouseUp.bind(this);\n        this.on('mouse-up', this.onMouseUpBound);\n        this.onKeyDownBound = this.onKeyDown.bind(this);\n        this.on('key-down', this.onKeyDownBound);\n    }\n\n    changeText(text: string): void {\n        this.text = text;\n        const showText = text + (this.focused ? '_' : '');\n        this.textCanvas = TextBlotter.blot({ text: showText });\n        if(this.autosize) {\n            this.w = this.canvas.canvas.width = this.textCanvas.width + 2;\n            this.h = this.canvas.canvas.height = this.textCanvas.height + 2;\n        }\n        this.draw();\n    }\n\n    draw(): void {\n        this.canvas.clear();\n        let borderColor = this.mouseOn ? 'rgba(220,220,220,0.8)' : 'rgba(255,255,255,0.8)';\n        borderColor = this.focused ? 'rgba(115,138,215,0.8)' : borderColor;\n        this.canvas.fillRect(borderColor, 0, 0, this.w, this.h);\n        this.canvas.clearRect(1, 1, this.w - 2, this.h - 2);\n        this.canvas.fillRect('rgba(0,0,0,0.8)', 1, 1, this.w - 2, this.h - 2);\n        if (this.textCanvas) {\n            this.canvas.drawImage(this.textCanvas, 0, 0, this.textCanvas.width, this.textCanvas.height,\n                1, 1, this.textCanvas.width, this.textCanvas.height);\n        }\n        this.emit('redraw');\n    }\n\n    focus(setTo?: boolean): void {\n        this.focused = setTo !== false;\n        this.changeText(this.text);\n    }\n\n    submit(): void {\n        if (this.onSubmit) {\n            this.onSubmit(this.text);\n        }\n    }\n\n    onMouseOn(mouseEvent: MouseEvent): void {\n        if(this.mouseOn) return;\n        this.mouseOn = true;\n        this.emit('mouse-on-element', this);\n        this.draw();\n    }\n\n    onMouseOff(mouseEvent: MouseEvent): void {\n        if(!this.mouseOn) return;\n        this.mouseOn = false;\n        this.emit('mouse-off-element', this);\n        this.draw();\n    }\n\n    onMouseDown(mouseEvent: MouseEvent): void {\n        if(!this.mouseOn) this.focus(false);\n    }\n\n    onMouseUp(mouseEvent: MouseEvent): void {\n        if(this.mouseOn) this.focus();\n    }\n\n    onKeyDown(keyEvent: KeyEvent): void {\n        if(!this.focused) return;\n        if(keyEvent.key == 'enter') this.submit();\n        // TODO: Move this stuff into a typing event in engine/input.js\n        let typed = keyEvent.key;\n        if(keyEvent.key == 'backspace') {\n            this.changeText(this.text.substring(0, Math.max(0, this.text.length - 1)));\n        } else {\n            if(keyEvent.key == 'period') typed = '.';\n            if(keyEvent.key == 'dash') typed = '-';\n            if(typed != '.' && typed != '-' \n                && (util.alphabet as readonly string[]).indexOf(typed) < 0 && (util.hex as readonly string[]).indexOf(typed) < 0) return;\n            this.changeText(this.text + ((this.ui.game.input.keys.shift) ? typed.toUpperCase() : typed));\n        }\n    }\n}", "'use strict';\n\nimport UIElement from './uielement.js';\nimport { TextBlotter } from '../common/textblotter.js';\n\ninterface LabelOptions {\n    ui: any;\n    parent: any;\n    w?: number;\n    h?: number;\n    top?: number | 'auto';\n    bottom?: number;\n    left?: number | 'auto';\n    right?: number;\n    text?: string;\n    onPress?: () => void;\n    hyperlink?: string;\n    maxWidth?: number;\n}\n\ninterface MouseEvent {\n    [key: string]: any;\n}\n\nexport default class Label extends UIElement {\n    text?: string;\n    textCanvas?: HTMLCanvasElement;\n    onPress?: () => void;\n    hyperlink?: string;\n    maxWidth?: number;\n    mouseOn?: boolean;\n    pressed?: boolean;\n    onMouseOnBound: (event: MouseEvent) => void;\n    onMouseOffBound: (event: MouseEvent) => void;\n    onMouseDownBound: (event: MouseEvent) => void;\n    onMouseUpBound: (event: MouseEvent) => void;\n\n    constructor(options: LabelOptions) {\n        super(options);\n        if(options.onPress) this.onPress = options.onPress;\n        if(options.hyperlink) this.hyperlink = options.hyperlink;\n        if(options.maxWidth) this.maxWidth = options.maxWidth;\n        if(options.text) this.changeText(options.text);\n        this.onMouseOnBound = this.onMouseOn.bind(this);\n        this.on('mouse-on', this.onMouseOnBound);\n        this.onMouseOffBound = this.onMouseOff.bind(this);\n        this.on('mouse-off', this.onMouseOffBound);\n        this.onMouseDownBound = this.onMouseDown.bind(this);\n        this.on('mouse-down', this.onMouseDownBound);\n        this.onMouseUpBound = this.onMouseUp.bind(this);\n        this.on('mouse-up', this.onMouseUpBound);\n    }\n\n    changeText(text: string): void {\n        this.text = text;\n        this.textCanvas = TextBlotter.blot({ text: this.text, maxWidth: this.maxWidth });\n        if(this.autosize) {\n            this.w = this.canvas.canvas.width = this.textCanvas.width;\n            this.h = this.canvas.canvas.height = this.textCanvas.height;\n        }\n        this.reposition();\n        this.draw();\n    }\n\n    draw(): void {\n        this.canvas.clear();\n        if (this.textCanvas) {\n            this.canvas.drawImage(this.textCanvas, 0, 0, this.textCanvas.width, this.textCanvas.height,\n                0, 0, this.textCanvas.width, this.textCanvas.height);\n        }\n        this.emit('redraw');\n    }\n\n    onMouseOn(mouseEvent: MouseEvent): void {\n        if(this.mouseOn) return;\n        this.mouseOn = true;\n        if(this.hyperlink) document.body.style.cursor = 'pointer';\n        this.emit('mouse-on-element', this);\n        this.draw();\n    }\n\n    onMouseOff(mouseEvent: MouseEvent): void {\n        if(!this.mouseOn) return;\n        this.mouseOn = false;\n        if(this.hyperlink) document.body.style.cursor = 'default';\n        this.pressed = false;\n        this.emit('mouse-off-element', this);\n        this.draw();\n    }\n\n    onMouseDown(mouseEvent: MouseEvent): void {\n        if(!this.mouseOn) return;\n        this.pressed = true;\n        this.draw();\n    }\n\n    onMouseUp(mouseEvent: MouseEvent): void {\n        if(!this.mouseOn) return;\n        this.pressed = false;\n        if(this.onPress) this.onPress();\n        // Only open hyperlink if it's not a placeholder value\n        if(this.hyperlink && this.hyperlink !== '#' && this.hyperlink !== 'javascript:void(0)') {\n            window.open(this.hyperlink);\n        }\n        this.draw();\n    }\n}", "{\n  \"name\": \"d-zone\",\n  \"version\": \"0.1.2\",\n  \"description\": \"An ambient life simulation driven by the user activity within a Discord server\",\n  \"type\": \"module\",\n  \"main\": \"index.ts\",\n  \"exports\": {\n    \".\": \"./index.ts\"\n  },\n  \"dependencies\": {\n    \"express\": \"^5.1.0\",\n    \"inherits\": \"^2.0.4\",\n    \"pino\": \"^10.0.0\",\n    \"raf\": \"^3.4.1\",\n    \"ws\": \"^8.13.0\"\n  },\n  \"devDependencies\": {\n    \"@playwright/test\": \"^1.40.0\",\n    \"@types/express\": \"^4.17.23\",\n    \"@types/node\": \"^20.19.17\",\n    \"@types/pino\": \"^7.0.4\",\n    \"@types/ws\": \"^8.18.1\",\n    \"@vitest/ui\": \"^1.6.0\",\n    \"allure-commandline\": \"^2.24.1\",\n    \"allure-playwright\": \"^2.9.2\",\n    \"allure-vitest\": \"^2.15.1\",\n    \"concurrently\": \"^9.2.1\",\n    \"esbuild\": \"^0.25.10\",\n    \"events\": \"^3.3.0\",\n    \"jsdom\": \"^24.0.0\",\n    \"msw\": \"^2.0.0\",\n    \"ts-node\": \"^10.9.2\",\n    \"typescript\": \"^5.9.2\",\n    \"vitest\": \"^1.6.0\"\n  },\n  \"scripts\": {\n    \"build:dev\": \"node esbuild.config.mjs\",\n    \"build:prod\": \"NODE_ENV=production node esbuild.config.mjs\",\n    \"dev\": \"concurrently \\\"npm run watch\\\" \\\"npm start\\\"\",\n    \"prestart\": \"npm run build:dev\",\n    \"start\": \"node server.mjs\",\n    \"start:ts\": \"ts-node --esm index.ts\",\n    \"test\": \"vitest run && playwright test\",\n    \"test:unit\": \"vitest run\",\n    \"test:unit:watch\": \"vitest\",\n    \"test:unit:ui\": \"vitest --ui\",\n    \"test:e2e\": \"playwright test\",\n    \"test:e2e:headed\": \"playwright test --headed\",\n    \"test:e2e:debug\": \"playwright test --debug\",\n    \"test:ci\": \"npm run test -- --project=ci\",\n    \"test:report\": \"allure generate --clean && allure open\",\n    \"test:report:generate\": \"allure generate --clean\",\n    \"type-check\": \"tsc --noEmit\",\n    \"watch\": \"node esbuild.config.mjs --watch\"\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com/NNTin/d-zone.git\"\n  },\n  \"keywords\": [\n    \"discord\",\n    \"Discord\",\n    \"isometric\",\n    \"canvas\"\n  ],\n  \"author\": \"Tin Nguyen\",\n  \"contributors\": [\n    \"Devin Spikowski (https://github.com/vegeta897)\"\n  ],\n  \"license\": \"ISC\",\n  \"bugs\": {\n    \"url\": \"https://github.com/NNTin/d-zone/issues\"\n  },\n  \"homepage\": \"https://nntin.github.io/d-zone\"\n}\n"],
  "mappings": "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,UAAW,CAAE,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACvD,UAAW,CAAE,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACvD,UAAW,CAAE,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACvD,UAAW,CAAE,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACvD,UAAW,CAAE,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EAExD,UAAW,CAAE,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACzD,UAAW,CAAE,EAAG,EAAG,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACzD,UAAW,CAAE,EAAG,EAAG,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,EAAG,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,EAAG,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,EAAG,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACzD,UAAW,CAAE,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACzD,UAAW,CAAE,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACzD,UAAW,CAAE,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACzD,UAAW,CAAE,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACzD,UAAW,CAAE,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACzD,UAAW,CAAE,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACzD,UAAW,CAAE,EAAG,GAAI,EAAG,IAAK,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EAEzD,UAAW,CAAE,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,GAAI,GAAI,EAAG,EACxD,UAAW,CAAE,EAAG,IAAK,EAAG,EAAG,EAAG,GAAI,EAA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",
  "names": ["require_quick_format_unescaped", "__commonJSMin", "exports", "module", "tryStringify", "o", "format", "f", "args", "opts", "ss", "offset", "len", "objects", "index", "argLen", "str", "a", "lastPos", "flen", "i", "type", "require_browser", "__commonJSMin", "exports", "module", "format", "pino", "_console", "pfGlobalThisOrFallback", "stdSerializers", "mock", "passthrough", "asErrValue", "levelToValue", "level", "logger", "baseLogFunctionSymbol", "hierarchySymbol", "logFallbackMap", "appendChildLogger", "parentLogger", "childLogger", "newEntry", "setupBaseLogFunctions", "levels", "proto", "logFunctions", "noop", "shouldSerialize", "serialize", "serializers", "k", "opts", "transmit", "stdErrSerialize", "customLevels", "getLevelVal", "getLevel", "setLevel", "setOpts", "getTimeFunction", "getLevels", "args", "child", "createLogEventShape", "set", "bindings", "childOptions", "childOptionsSerializers", "childSerializers", "childSerialize", "applySerializers", "Child", "parent", "newLogger", "values", "labels", "invertObject", "obj", "inverted", "key", "nullTime", "epochTime", "unixTime", "isoTime", "getBindingChain", "hierarchy", "self", "rootLogger", "transmitLevel", "transmitValue", "createWrap", "prependBindingsInArguments", "logFunc", "write", "ts", "i", "argsIsSerialized", "asObject", "methodValue", "levelFormatter", "logObjectFormatter", "argsCloned", "msg", "logObject", "lvl", "formattedLevel", "send", "methodLevel", "val", "arg", "err", "a", "defd", "o", "import_pino", "isProduction", "isTesting", "isE2ETesting", "isDebugMode", "logger", "GameLogger", "gameLogger", "init_gameLogger", "__esmMin", "pino", "level", "logEvent", "label", "baseLogger", "__publicField", "enabled", "data", "actorUid", "username", "visibleActorUid", "hiddenActorUids", "url", "reason", "serverId", "serverName", "panelType", "buttonType", "buttonText", "x", "y", "width", "height", "error", "metric", "value", "unit", "fps", "message", "require_events", "__commonJSMin", "exports", "module", "R", "ReflectApply", "target", "receiver", "args", "ReflectOwnKeys", "ProcessEmitWarning", "warning", "NumberIsNaN", "value", "EventEmitter", "once", "defaultMaxListeners", "checkListener", "listener", "arg", "n", "_getMaxListeners", "that", "type", "i", "doError", "events", "er", "err", "handler", "len", "listeners", "arrayClone", "_addListener", "prepend", "m", "existing", "w", "onceWrapper", "_onceWrap", "state", "wrapped", "list", "position", "originalListener", "spliceOne", "keys", "key", "_listeners", "unwrap", "evlistener", "unwrapListeners", "emitter", "listenerCount", "arr", "copy", "index", "ret", "name", "resolve", "reject", "errorListener", "resolver", "eventTargetAgnosticAddListener", "addErrorHandlerIfEventEmitter", "flags", "wrapListener", "util", "util_default", "init_util", "__esmMin", "min", "max", "arr", "obj", "elem", "i", "text", "length", "val", "wrap", "index", "floorX", "lower", "upper", "fraction", "name", "blacklist", "split", "alpha", "result", "w", "l", "variation", "closestGrids", "geometry", "init_geometry", "__esmMin", "init_util", "size", "sx", "sy", "a", "b", "util", "grid", "x", "y", "a1", "a2", "b1", "b2", "width", "height", "map", "floorX", "lowerXArray", "ceilX", "upperXArray", "floorY", "lowerXY", "upperXY", "import_events", "Entity", "init_entity", "__esmMin", "init_util", "init_gameLogger", "__publicField", "game", "util", "cb", "ticks", "afterCB", "gameLogger", "i", "isNumeric", "n", "BetterCanvas", "bettercanvas_default", "init_bettercanvas", "__esmMin", "init_gameLogger", "width", "height", "__publicField", "gameLogger", "context", "img", "sx", "sy", "sw", "sh", "dx", "dy", "dw", "dh", "opacity", "color", "x", "y", "w", "h", "charSets", "fontMap", "padding", "vertOffset", "image", "TextBlotter", "init_textblotter", "__esmMin", "init_bettercanvas", "csKey", "charSet", "rx", "c", "char", "width", "img", "options", "x", "y", "metrics", "lineStart", "lineCount", "canvas", "bettercanvas_default", "charCount", "maxChars", "fillWidth", "fillHeight", "text", "lines", "words", "space", "lineWidth", "lineChars", "maxLineWidth", "w", "word", "wordWidth", "wordChars", "a", "ltr", "b", "ltrB", "trimWidth", "calcScrollSpeed", "text", "speed", "i", "TEXTBOX_SCROLL_SPEEDS", "TEXTBOX_MAX_WIDTH", "TEXTBOX_LINES_PER_PAGE", "TEXTBOX_PAGE_DELAY", "TEXTBOX_FINAL_DELAY", "TEXTBOX_OPEN_TIME", "TEXTBOX_CLOSE_TIME", "TEXTBOX_BG_COLOR", "TextBox", "init_textbox", "__esmMin", "init_gameLogger", "init_entity", "init_textblotter", "Entity", "parent", "stay", "__publicField", "gameLogger", "parentX", "parentY", "options", "TextBlotter", "cb", "self", "complete", "scrollSpeed", "lineNumber", "lineChar", "lineChars", "nl", "nextLine", "addLetter", "progress", "task", "WorldObject", "init_worldobject", "__esmMin", "init_entity", "Entity", "options", "__publicField", "x", "y", "z", "newX", "newY", "newZ", "newZDepth", "pathfinder_exports", "__export", "pathfinder_default", "map", "calcH", "getBest", "constructPath", "init_pathfinder", "__esmMin", "a", "b", "x", "y", "list", "best", "key", "start", "current", "closed", "path", "cur", "m", "options", "end", "startH", "startIsCurrent", "openCount", "open", "xDir", "yDir", "neighborX", "neighborY", "neighborGrid", "moveCost", "neighborG", "existing", "neighbor", "nextCurrent", "GoTo", "init_goto", "__esmMin", "init_gameLogger", "init_geometry", "init_util", "init_pathfinder", "actor", "target", "__publicField", "util", "gameLogger", "geometry", "adjacent", "destDelta", "moveDir", "absX", "absY", "moveAttempt", "pathfinder_default", "pathDelta", "finalDestination", "Wander", "init_wander", "__esmMin", "init_gameLogger", "init_geometry", "init_util", "actor", "__publicField", "direction", "util", "geometry", "moveXY", "canMove", "gameLogger", "Placeholder", "init_placeholder", "__esmMin", "init_worldobject", "WorldObject", "parent", "options", "worldObjectOptions", "__publicField", "map", "Sheet", "init_sheet", "__esmMin", "spriteName", "__publicField", "actor_exports", "__export", "Actor", "init_actor", "__esmMin", "init_gameLogger", "init_geometry", "init_textbox", "init_util", "init_worldobject", "init_goto", "init_wander", "init_placeholder", "init_sheet", "WorldObject", "options", "gameLogger", "worldObjectOptions", "__publicField", "TextBox", "Sheet", "util", "geometry", "game", "mouse", "metrics", "Wander", "presence", "i", "hasWander", "behavior", "xDelta", "yDelta", "zDelta", "tick", "totalTicks", "progress", "deltaScreen", "screen", "facing", "state", "baseMetrics", "baseX", "baseY", "animation", "zDiff", "finalImage", "x", "y", "destination", "walkable", "Placeholder", "halfZDepth", "newFrame", "newZDepth", "z", "absolute", "previousPosition", "message", "channel", "onStop", "self", "lastMessage", "readyToMove", "GoTo", "target", "gotoBehavior", "error", "slab_exports", "__export", "Slab", "init_slab", "__esmMin", "init_worldobject", "WorldObject", "style", "x", "y", "z", "__publicField", "sheet2_exports", "__export", "Sheet", "map", "init_sheet2", "__esmMin", "spriteName", "__publicField", "tile_exports", "__export", "Tile", "init_tile", "__esmMin", "init_util", "init_sheet2", "options", "__publicField", "Sheet", "spriteMap", "variation", "util", "random", "map", "Sheet", "init_sheet", "__esmMin", "spriteName", "__publicField", "beacon_exports", "__export", "Beacon", "init_beacon", "__esmMin", "init_worldobject", "init_bettercanvas", "init_sheet", "WorldObject", "x", "y", "z", "__publicField", "canvas", "Sheet", "game", "bettercanvas_default", "seed_exports", "__export", "Seed", "init_seed", "__esmMin", "init_util", "init_worldobject", "init_sheet", "WorldObject", "options", "worldObjectOptions", "__publicField", "canvas", "Sheet", "game", "util", "metrics", "nextGrowth", "progress", "init_gameLogger", "import_events", "init_gameLogger", "ActorClass", "ActorLoadPromise", "Users", "game", "world", "__publicField", "error", "gameLogger", "data", "grid", "actor", "channel", "queue", "message", "self", "x", "y", "z", "aKey", "import_events", "init_gameLogger", "DiscordOAuth", "options", "__publicField", "authUrl", "gameLogger", "popup", "self", "messageHandler", "event", "data", "successData", "accessToken", "state", "expiresIn", "errorData", "pollTimer", "response", "user", "error", "tokenData", "expiresAt", "token", "userData", "size", "discord_oauth_default", "init_util", "init_util", "import_events", "init_bettercanvas", "init_gameLogger", "Canvas", "options", "__publicField", "s", "newCanvas", "bettercanvas_default", "context", "e", "self", "mouseEvent", "util_default", "dx", "dy", "newScale", "renderer", "staticCanvas", "bgCanvas", "gameLogger", "x", "y", "canvasStart", "canvasClipped", "bgStart", "bgEnd", "clipped", "sprite", "screen", "image", "colorCollection", "highlight", "canvas_default", "import_events", "init_gameLogger", "init_util", "import_events", "Input", "__publicField", "canvas", "wheelSupport", "mouseEvent", "touch", "button", "buttons", "buttonNumber", "wheelEvent", "direction", "keyEvent", "key", "keyCodes", "now", "Game", "options", "__publicField", "Input", "self", "rightNow", "gameLogger", "timeThis", "i", "task", "endTick", "ticks", "percent", "canvas", "resize", "mouseEvent", "util_default", "keyEvent", "game_default", "init_bettercanvas", "imageList", "Preloader", "onComplete", "__publicField", "i", "imageName", "fileName", "image", "canvas", "bettercanvas_default", "preloader_default", "import_events", "applyAlpha", "source", "target", "sourceCanvas", "sourceCtx", "sourceData", "targetCtx", "targetData", "p", "ColorUtil", "options", "canvas", "context", "colorCanvas", "colorContext", "i", "reg", "RGBA1", "RGBA2", "amount", "RGBA1Split", "r1", "g1", "b1", "a1", "RGBA2Split", "r2", "g2", "b2", "a2", "init_gameLogger", "Renderer", "options", "__publicField", "self", "draw", "timeThis", "c", "canvas", "entityCount", "z", "zBufferDepth", "zz", "o", "sprite", "newZDepth", "a", "b", "aZ", "bZ", "oldZDepth", "obj", "zDepth", "i", "gameLogger", "ColorUtil", "renderer_default", "import_events", "init_gameLogger", "init_bettercanvas", "init_geometry", "init_util", "SlabClass", "TileClass", "TileSheetClass", "PathfinderClass", "testCanvas", "bettercanvas_default", "unoccupiedGrids", "World", "game", "worldSize", "__publicField", "SlabModule", "TileModule", "TileSheetModule", "PathfinderModule", "geometry", "error", "gameLogger", "noiseBig", "noiseSmall", "bigBlur", "smallBlur", "tx", "ty", "bigNoiseValue", "smallNoiseValue", "noiseValue", "x", "y", "farness", "grid", "beaconIndex", "lowestScreenX", "lowestScreenY", "highestScreenX", "highestScreenY", "i", "preTile", "preScreen", "bgCanvas", "tilesDrawn", "j", "tile", "screen", "hasNaN", "tileImage", "run", "e", "ctx", "walkableCount", "actorCount", "totalTiles", "gridKey", "slab", "actorHere", "yObjects", "zKey", "obj", "z", "centerX", "centerY", "size", "drawArrow", "x1", "y1", "x2", "y2", "angle", "headLen", "dirs", "endN", "endE", "endS", "endW", "crawled", "thisIsland", "currentTile", "neighborsToCrawl", "currentNeighbors", "iKey", "neighbor", "i2", "it", "gKey", "finalTile", "finalNeighbors", "nKey", "fp", "safety", "valid", "util", "flowerNeighbors", "fKey", "fNeighbor", "spread", "s", "canSpread", "spreadX", "spreadY", "spreadGrid", "spreadNeighbors", "sKey", "sNeighbor", "self", "tileType", "getTileCode", "oGrid", "nGrid", "generateTile", "nGrids", "tileCode", "key", "neighbors", "nw", "ne", "se", "sw", "tiles", "tileGrid", "a", "b", "completeTileMap", "tileCodeCounts", "position", "gridTileTypes", "validSpawnPositions", "invalidSpawnPositions", "objects", "zKeys", "topObject", "walkableHeight", "highest", "xKey", "xObjects", "yKey", "grids", "import_events", "init_gameLogger", "init_geometry", "BeaconClass", "SeedClass", "Decorator", "game", "world", "__publicField", "BeaconModule", "SeedModule", "error", "gameLogger", "options", "destination", "i", "geometry", "close", "grid", "import_events", "init_bettercanvas", "init_textblotter", "import_events", "init_bettercanvas", "init_util", "UIElement", "options", "__publicField", "bettercanvas_default", "i", "canvas", "util", "width", "height", "init_textblotter", "Button", "UIElement", "options", "__publicField", "text", "TextBlotter", "buttonColor", "textOffset", "mouseEvent", "Panel", "UIElement", "options", "init_textblotter", "init_util", "Input", "UIElement", "options", "__publicField", "text", "showText", "TextBlotter", "borderColor", "setTo", "mouseEvent", "keyEvent", "typed", "util", "init_textblotter", "Label", "UIElement", "options", "__publicField", "text", "TextBlotter", "mouseEvent", "UI", "game", "__publicField", "TextBlotter", "bettercanvas_default", "self", "canvas", "options", "newButton", "Button", "newPanel", "Panel", "newInput", "Input", "newLabel", "Label", "i", "mouseEvent", "elem", "keyEvent", "resize", "package_default", "version", "preloader", "game", "ws", "discordAuth", "initGame", "images", "gameLogger", "game", "game_default", "renderer_default", "canvas", "canvas_default", "UI", "initDiscordAuth", "addHelpButton", "initWebsocket", "initialDrawLogged", "package_default", "reinitializeDiscordAuth", "newClientId", "wasLoggedIn", "discordAuth", "currentUser", "redirectUri", "discord_oauth_default", "setupDiscordAuthEventHandlers", "originalLogin", "authUrl", "user", "joinServer", "error", "response", "version", "isLoggedIn", "users", "world", "decorator", "cleanupEventListeners", "fallbackStrategies", "urlSocketURL", "util", "currentHostStrategy", "currentStrategyIndex", "tryNextWebsocketConnection", "s", "strategy", "ws", "event", "data", "joinThisServer", "server", "params", "widestButton", "serverButtonY", "button", "sKey", "serverLock", "startupServer", "getStartupServer", "serverData", "requestServer", "userList", "World", "Decorator", "Users", "userCount", "uid", "actorCount", "notificationPanel", "err", "connectionMessage", "discordId", "stored", "startApp", "gameLogger", "package_default", "version", "preloader", "preloader_default", "initGame", "joinServer"]
}
